Densetsu Engine Reference Sheet 
(v1.0)
System Dependencies, Hierarchies, and Integration Points
  
________________

Index and Work Steps
1. Overview
Purpose and scope; how this sheet complements the Implementation Strategy.
2. Core Runtime
* Scene control
* Time management
* World streaming
* Save/load
* Data persistence
3. Actor System
* Actor structure (base class + typed subclasses)
* Four States Rule
* Actor lifecycle
* Core variables and attributes
* Dependencies: FSM, Combat, World
4. FSM System
* State logic and transition flow
* Group priorities and tags
* Integration with animation, physics, and AI
* Dependencies: Actor, Combat, Input
5. Combat System
* Architecture and data model
* Damage calculation flow
* Elemental and tag interactions
* Dependencies: FSM, Actor, Stats
6. Stat & Skill Framework
* Attribute definitions
* Skill templates and scaling
* Data persistence
* Dependencies: Actor, Combat
7. Chronogardening & Gadgets
* Integration with world and anomalies
* Gadget subclasses (Detection, Restoration, Utility)
* Dependencies: Actor, World, Temporal Layer

8. Temporal & Anomaly Systems
   * Anomaly detection, interaction, and resolution
   * Timeflow simulation
   * Dependencies: Gadgets, World, Narrative
9. Narrative Systems
   * Quest & dialogue node structure (planned)
   * Hooks to actor and world states
   * Dependencies: Actor, Temporal
10. System Dependency Map
   * Flow diagrams showing hierarchical and lateral links
   * Notes on circular dependency prevention

11. Data & File Architecture
      * Data layout conventions
      * Naming schemes for scripts and scenes
      * Save file and configuration structure
________________


System Dependencies, Hierarchies, Integration Points
________________


1 – Overview
Purpose
The Densetsu Engine Reference Sheet defines the internal logic, dependencies, and operational flow of the systems that make up the Densetsu Engine. It serves as a technical translation layer between creative design and code, ensuring all components remain interoperable, modular, and traceable from concept to implementation.
This document complements the Implementation Strategy Document, expanding its structural overview into direct relationships and data flow logic between systems. It is intended to help both human developers and AI-assisted agents understand exactly how to build, expand, and maintain each system without creative ambiguity.
Scope
This reference focuses exclusively on runtime systems and their integration hierarchy. It does not cover art pipelines, content creation, or narrative writing, except where those elements directly interact with core systems (for example, dialogue or quest triggers linked to Actors).
Every entry describes:
      * The system’s role in the Densetsu Engine.

      * Its hierarchy position (parent, child, or peer system).

      * Dependencies and required data.

      * Potential connections to other systems.

      * Implementation intent and constraints.

________________
Framework Design Principles
The Densetsu Engine is structured around four guiding principles:
         1. Modularity – Every system exists as an independent component with minimal hard dependencies. Features can be added or removed without global refactoring.

         2. Clarity – Each system has a singular, well-defined purpose. No hidden behaviors or ambiguous code paths.

         3. Traceability – Every data element and function can be traced to its source document (GDD or Universe Document). This ensures narrative and design consistency.

         4. Adaptability – Systems can evolve over time, scaling with content scope or technical constraints without breaking earlier functionality.

Architectural Hierarchy
The Densetsu Engine is divided into three primary tiers of responsibility:
            * Foundation Tier: Core Runtime, Actor System, FSM System.

            * Gameplay Tier: Combat, Stats, Chronogardening, Gadgets, Anomalies.

            * Narrative Tier: Quests, Dialogue, and Temporal Story Triggers.

Data flows downward (narrative defines purpose, gameplay interprets, foundation executes) and feedback flows upward (runtime events inform gameplay and narrative systems). This bidirectional design maintains systemic integrity while allowing creative flexibility.
Intended Use
This document should be referenced before any major feature is implemented or modified. Developers and AI agents must cross-check new systems or changes against this reference to maintain coherence and prevent circular dependencies.
The sheet also acts as a diagnostic guide, making it possible to identify the origin of gameplay or systemic issues by tracing their relationships across systems.
________________
________________


2 – Core Runtime
Purpose
The Core Runtime is the lowest foundational layer of the Densetsu Engine. It governs the flow of time, scene management, persistence, and overall world state. Its primary goal is to ensure that all gameplay systems can function consistently within a unified temporal and spatial framework.
Responsibilities
               * Scene Management: Handles scene transitions, map streaming, and object instancing. Maintains the global reference to active and queued scenes.
               * Time Management: Maintains game time, real-time cycles, and temporal flow states used by the Chronogardening and Anomaly systems.
               * Persistence: Manages save/load operations and data caching for actors, quests, and world states.
               * Event Handling: Provides a centralized event bus for communication between systems without creating direct dependencies.
               * System Initialization: Bootstraps critical subsystems (Actor, FSM, Input, UI, Audio) during startup.
Integration Points
               * Actor System: Receives initialization and cleanup signals from Core Runtime.
               * FSM: Accesses global time and pause states through Core Runtime services.
               * World System: Relies on runtime for map and resource management.
               * Chronogardening: Reads timeflow data from Core Runtime to assess anomaly distortions.
Implementation Intent
The Core Runtime must be engine-agnostic within Godot 4.2+, allowing future reuse in other projects or derivatives of the Densetsu Engine. It prioritizes predictability, ensuring stable update order and avoiding race conditions.
The design discourages direct cross-calls between unrelated systems. Instead, systems communicate through runtime-level events or service interfaces.
Constraints
               * The Core Runtime must never contain gameplay logic. It exists solely to provide structure and control.
               * Time manipulation and pause functionality must remain globally consistent across systems.
               * Data persistence should follow a lightweight serialization standard to minimize dependency on external databases.
3 – Actor System
Purpose
The Actor System forms the central backbone of the Densetsu Engine. Every in-world entity—whether living, mechanical, or environmental—is treated as an Actor. This unified framework enables consistent interaction, state control, and systemic behavior across all gameplay elements.
Actors represent anything that can exist, move, react, or be affected by the world. Their modular design allows complete feature independence: any Actor can possess combat ability, dialogue capacity, temporal reactions, or environmental influence depending on the attached components and state definitions.
________________


Core Structure
Each Actor is an instance of a base Actor class, extended by specific typed subclasses that define category and behavior specialization:
               * Character: Sentient or semi-sentient beings (player, NPCs, enemies).

               * Creature: Instinct-driven entities forming part of the natural ecosystem.

               * Utility: Functional, interactive world objects (levers, switches, mechanisms).

               * Item: Collectible, usable, or equipable objects.

               * Destructible: Breakable world elements (crates, barriers, structures).

               * Trap: Stationary hazards triggered by proximity or time.

               * Projectile: Objects with movement physics and interaction effects.

Each subclass inherits the same foundational attributes and life-cycle rules, enabling predictable interaction without requiring redundant code or special-case logic.
________________


________________
Core Principles
                  1. Unified Data Model: Every Actor holds a consistent data schema including identifiers, position, physics state, activity state, and system tags.

                  2. Life-Cycle Management: The Four States Rule governs activation priority:

                     * Active: Fully simulated and updated each frame.

                     * Semi-Active: Reduced update frequency, partial AI or animation processing.

                     * Passive: Dormant, visual representation only.

                     * Dormant: Unloaded or frozen, placeholder data only.

                        3. Self-Containment: Each Actor is autonomous. System dependencies are injected through service references (e.g., Runtime, FSM, Combat System) rather than hard-coded links.

________________


Integration Points
                           * Core Runtime: Handles actor initialization, destruction, and persistence.

                           * FSM System: Defines actor behavior, animations, and state transitions.

                           * Combat System: Interfaces for hit detection, damage processing, and stat adjustments.

                           * Chronogardening Layer: Actors can react to anomalies and temporal distortions.

                           * Quest & Dialogue Systems: Actors serve as interaction anchors for narrative triggers.

________________


________________
Data Model Overview
Essential data stored in each Actor includes:
                              * Identifiers: Unique ID, Type, Group Tags, State Flags.

                              * Core Attributes: Position, Velocity, Facing Direction, Time Anchor.

                              * System Flags: Determines subsystem participation (e.g., Combatant, NPC, Interactive).

                              * Stat Container: Linked structure holding numerical attributes and affinities.

                              * State Context: Active FSM state, queued transitions, and event references.

________________


Implementation Intent
Actors must be designed for extreme modularity—new behaviors or attributes are attached through FSM states, data modules, or external scripts rather than subclass explosion.
Actors must communicate only through runtime events or localized signals, not direct global calls. This maintains separation between logic and presentation, facilitating AI- or tool-driven generation of Actor definitions.
All Actor subclasses must remain interoperable with shared systems. For example, a Creature can engage in combat using the same interfaces as a Character, while a Gadget (as an Actor subclass) can interact with anomalies via Chronogardening without unique case handling.
________________


Constraints
                                 * The Actor System must never assume narrative role or alignment. Behavior emerges from FSM and data flags.

                                 * Actors must remain deterministic under identical inputs unless explicitly marked as chaotic or random by design.

                                 * No Actor may directly alter global systems; all requests pass through the Runtime or service interfaces.

                                 * Subclass definitions must remain simple—no nested inheritance beyond one level from the base Actor class.

4 – Finite State Machine (FSM) System
Purpose
The FSM System provides the behavioral layer for all Actors. It encapsulates decision-making, animation control, input handling, and contextual responses. The FSM is modular and data-driven: states are small, testable units that can be combined or swapped without changing Actor core code.
________________


Core Concepts
                                    * State Unit: A discrete script or data object that defines behavior for a single condition (e.g., Idle, Walk, Attack, Stagger, Repair).

                                    * State Machine Container: Each Actor holds a state machine instance responsible for loading, queuing, and transitioning between State Units.

                                    * Tags & Groups: States and Actors use tags to filter applicable inputs, animation layers, and collision rules.

                                    * Events & Frame Hooks: States expose hooks for frame events, enter/exit logic, and timed callbacks.

________________


Key Features
                                       1. Priority Groups: States are organized into priority groups (e.g., Movement, Combat, Interaction). Higher priority groups can interrupt lower ones when conditions are met.

                                       2. Context Flags: Global or Actor-level flags influence state availability (e.g., IsGrounded, IsSwimming, IsCorrupted).

                                       3. Transition Conditions: Declarative conditions (expressed as simple boolean expressions or named checks) determine when transitions occur.

                                       4. Queued Transitions: States can enqueue successor states to maintain fluid animation and logic flow.

                                       5. Reusable State Modules: Common behaviors (timed stun, knockback reaction) are implemented as reusable modules.

                                       6. Animation Integration: States reference animation clips and define frame events to synchronize hitboxes and effects.

API & Integration Points (Descriptive)
                                          * State Registration: Developers register State Units with descriptive metadata (tags, priority, input bindings). AI or tools can generate these registrations from data sheets.

                                          * State Invocation: The Actor requests transitions via the state machine API (e.g., RequestState("Attack", {target: enemy})).

                                          * Event Broadcasting: State changes emit events on the runtime event bus (e.g., OnStateEnter, OnStateExit, OnFrameEvent).

                                          * Query Interface: Other systems can query an Actor's current state, available transitions, and cooldowns.
________________


Behavior Authoring Guidelines
                                             * Single Responsibility: Each State Unit should handle one behavioural concern only.

                                             * Data Driven: Where possible, expose configuration parameters (timings, strengths, tags) as editable data, not hard-coded values.

                                             * Deterministic Transitions: Given the same inputs and flags, state transitions must behave identically to permit debugging and replay.

                                             * Graceful Fallbacks: States must provide safe fallback behavior in case required resources (e.g., animation clip) are missing.
________________


Interaction with Other Systems
                                                * Combat: States trigger hitbox creation, apply damage through Combat API, and read stat values from the Actor.

                                                * Input: Player input is pre-processed and fed as high-level intents to the state machine (e.g., IntentJump, IntentAttack).

                                                * AI: AI logic schedules state requests based on perception systems and decision trees; the FSM executes them.

                                                * World & Physics: States may request physics queries or apply motion via movement controllers but never directly mutate world systems.

                                                * Gadgets & Temporal Layer: States can query temporal context (is area distorted?) and adjust behavior accordingly.

Implementation Intent
The FSM system must be lightweight and performant. States should load on demand and be shareable across Actor types. An editor tool should allow designers to assemble state graphs visually, but the runtime must rely on plain data structures for portability and AI generation.
________________


Constraints
                                                   * Avoid deep nesting of states; prefer flat prioritized groups with queued transitions.

                                                   * State execution time must be bounded to prevent long-frame stalls.

                                                   * States must not perform heavy computations; offload to background tasks or precomputed tables when necessary.

________________


Debugging & Testing
                                                      * Expose state machine traces to logging systems for replay debugging.

                                                      * Provide deterministic test harnesses where sequences of inputs produce recorded state traces.

                                                      * Allow hot-reload of State Units during development for rapid iteration.

________________
________________


5 – Combat System
Purpose
The Combat System defines how physical and elemental interactions are resolved in the Densetsu Engine. It translates Actor intents and FSM requests into deterministic gameplay outcomes: hit detection, damage resolution, status effects, and feedback. The system is fully modular and data-driven to allow designers and AI tools to author skills, effects, and behaviors without changing engine code.
________________


Core Design Goals
                                                         1. Clarity: Combat must communicate cause and effect reliably through visual, audio, and mechanical feedback.

                                                         2. Modularity: Skills, effects, and damage types are data objects that plug into the Combat API.

                                                         3. Determinism: Given identical inputs and state, combat results are reproducible for debugging and testing.

                                                         4. Extensibility: New mechanics (stances, parries, combo chains) can be added as modules without refactoring base code.
________________


Architectural Overview
                                                            * Combat API: The central interface exposing functions such as ApplyHit, RegisterHitbox, ResolveDamage, and ApplyStatusEffect.

                                                            * Hitbox Manager: Responsible for active hitbox registration, lifetime, and overlap queries against hitboxes.

                                                            * Damage Resolver: Converts hit events into final outcomes, factoring in stats, elemental affinities, armor, and modifiers.

                                                            * Effect Engine: Applies time-based status effects (burn, freeze, bleed), and coordinates their visual and mechanical impact.

                                                            * Event Bus Integration: Combat events broadcast to the runtime event bus to trigger audio, UI, and narrative hooks.

________________


Data Model
                                                               * Skill Definition: Data container describing animation timing, hitbox frames, damage formula, FX triggers, cost, cooldown, tags, and required stance.

                                                               * Hit Record: Immutable record produced by hitbox collisions containing attacker id, defender id, timestamp, raw damage, hit location, and tags.

                                                               * Damage Profile: Encapsulates base damage, element, armor penetration, critical chance, and combo scaling.

                                                               * Status Effect Descriptor: Defines effect duration, tick rate, stacking rules, and interaction rules with other effects.

________________


Damage Resolution Flow (Descriptive)
                                                                  1. State requests attack: Actor FSM requests an Attack State with associated Skill Definition.

                                                                  2. Animation & Hitbox: During animation frame hooks, the State registers one or more hitboxes with the Hitbox Manager.

                                                                  3. Collision detection: Hitbox Manager queries overlapping hurtboxes and emits Hit Records.

                                                                  4. ResolveDamage: Damage Resolver consumes Hit Records, fetching attacker and defender stats, applying elemental interactions, crits, and armor calculations.

                                                                  5. Apply Effects: Resulting status effects are scheduled in the Effect Engine.

                                                                  6. Feedback: Event Bus notifies audio, camera, UI systems and triggers hit pause or slow-motion where configured.

________________


________________
Elemental & Tag Interactions
                                                                     * Elements (Earth, Water, Wind, Fire, Light, Dark, Thunder, Gaea, Timespace) modify damage or state application according to data-driven affinity matrices.

                                                                     * Tags (e.g., "bleedable", "flying", "armored") enable conditional logic without hardcoding type checks.

                                                                     * Designers configure interaction rules in tables that the Damage Resolver consults at runtime.

________________


Defensive Systems
                                                                        * Guard & Parry: Guard reduces incoming damage by a configuration percentage; perfectly-timed parry triggers a counter window.

                                                                        * Stamina/Momentum: Optional resource controlling the ability to chain heavy moves; managed through FSM and Combat API.

                                                                        * Hit Reaction Prioritization: Reactions (stagger, knockback) are resolved via priority rules so that multiple hits produce consistent physical outcomes.

________________


Combo & Chain Systems
                                                                           * Combo Windows: Skill Definitions can expose combo windows (frames where chained skills are accepted).

                                                                           * Chain Rules: Designers set allowed follow-ups per skill, including context-sensitive options (on-ground, air, low-health).

                                                                           * Scaling: Damage scaling rules prevent infinite combo exploitation by applying diminishing returns or scaling multipliers.

________________


________________
AI Combat Integration
                                                                              * AI requests and schedules Skill usages via the FSM; the Combat System remains authoritative for hit resolution.

                                                                              * AI perception systems feed target selection and spacing heuristics; Combat System provides hooks for planned evasive behaviors (e.g., sidestep on heavy attack detection).

________________


Gadget & Environmental Interaction
                                                                                 * Gadgets can register temporary hitboxes or environmental effects that the Hitbox Manager treats like any other attack (marked by tags such as "gadget_tech").

                                                                                 * Environmental hazards (collapsing floors, rifts) emit damage events through the Combat API to maintain consistent feedback.

________________


Multiplayer Considerations (Optional)
                                                                                    * Combat moves and hit registration are deterministic and designed to be lock-step friendly if multiplayer added later.

                                                                                    * Netcode integration point: ability to serialize Skill Definitions and Hit Records for replay or authoritative resolution on server.

________________


Balancing & Tuning
                                                                                       * All damage and effect values must be data-driven and editable in external config files or editors.

                                                                                       * Provide telemetry hooks for playtesting to record hit outcomes, damage distributions, and combo usage frequency.

________________


________________
Constraints & Best Practices
                                                                                          * Avoid complex per-hit computations; precompute lookup tables for common interactions.

                                                                                          * Limit simultaneous active hitboxes to avoid performance spikes; designers should balance visuals against system load[a].

                                                                                          * Ensure status effect stacking rules are clear to prevent unforeseen emergent behavior.

________________


Debugging & Tools
                                                                                             * Expose hitbox visualizers in-editor and at runtime for development builds.

                                                                                             * Provide a deterministic combat replay system for testing edge cases.

                                                                                             * Log detailed Hit Records to enable postmortem analysis of player-reported bugs.

________________
________________


6 – Stat & Skill Framework
Purpose
The Stat & Skill Framework governs all numerical and categorical data defining Actor capabilities, growth, and interactions. It provides the mathematical backbone for combat, progression, and system balancing. Its modular design allows easy addition, scaling, and tuning of attributes without breaking dependent systems.
________________


Core Philosophy
This framework separates data (stats) from function (systems). Stats describe potential, while systems interpret that potential through gameplay contexts. Skills, meanwhile, translate data and context into actionable outcomes.
Each value is deterministic, traceable, and sourced from data tables or scripts referenced in the Actor definition.
________________


Architecture Overview
                                                                                                * Stat Container: Each Actor holds a structured stat table with core attributes, derived stats, and modifiers.

                                                                                                * Skill Registry: Repository of reusable skill templates that define attacks, abilities, or techniques.

                                                                                                * Scaling Module: Applies formulas to derive values (e.g., attack power = Strength * Weapon Mod). These formulas can be defined externally for easy tuning.

                                                                                                * Modifier System: Buffs, debuffs, and environmental influences modify base stats dynamically.

________________


________________
Core Attributes
Core stats are consistent across all Actor types:
                                                                                                   * Level – Represents growth stage and scaling multiplier.

                                                                                                   * HP Max / MP Max – Maximum vitality and energy.

                                                                                                   * Strength / Defense / Agility / Intelligence / Luck – Core physical and mental capabilities.

                                                                                                   * XP Value – Experience yielded upon defeat (for NPCs or enemies).
Combat Skills
                                                                                                      * Unarmed / Armed / Ranged / Finesse / Stealth – Skill proficiencies affecting hit accuracy, evasion, and damage scaling.
Elemental Affinities
                                                                                                      * Earth / Water / Wind / Fire / Light / Dark / Thunder / Gaea / Timespace – Elemental modifiers affecting attack potency and resistance. These interact dynamically with the Combat System’s damage resolver.
________________


Skill Definition Model
Each Skill entry defines an ability or technique and includes:
                                                                                                      * Name & Category (e.g., Physical, Magical, Support)
                                                                                                      * Base Power (raw multiplier before scaling)
                                                                                                      * Elemental Type (affinity interaction)
                                                                                                      * Resource Cost (MP, stamina, item, cooldown)
                                                                                                      * Execution Window (startup, active, recovery frames)
                                                                                                      * Tags (metadata for conditional logic such as “projectile”, “heavy_attack”, “healing”)
                                                                                                      * Scaling Factors (e.g., Strength 80%, Intelligence 20%)
                                                                                                      * Effect Set (status applications, environmental changes, or event triggers)

All Skills are stored in structured data files and loaded dynamically during Actor initialization or area load.
________________


________________
Growth & Progression
                                                                                                         * Level-ups increase stats according to race/class growth curves defined in templates.

                                                                                                         * Curve definitions (linear, exponential, hybrid) are adjustable per Actor type.

                                                                                                         * Experience and stat progression follow reflective meditation rules from the GDD — increases occur at rest points, not instantaneously.

________________


Modifiers & Buff System
Modifiers temporarily alter stats or introduce timed effects. They are stackable, tagged, and defined by:
                                                                                                            * Modifier Source: Skill, environment, item, or anomaly.

                                                                                                            * Type: Additive, multiplicative, or replacement.

                                                                                                            * Duration: Finite (timed) or infinite (persistent until removed).

                                                                                                            * Priority: Determines which modifiers override in conflicts.

A Modifier Manager maintains the active list per Actor and applies recalculation only when necessary, optimizing performance.
________________


Integration Points
                                                                                                               * Actor System: Holds the stat container and modifier manager.

                                                                                                               * Combat System: Reads stats to resolve damage and scaling; applies modifiers upon hits or effects.

                                                                                                               * FSM System: Can query skill data to conditionally enable or disable states.

                                                                                                               * Chronogardening Layer: Time distortions can alter stat flow (e.g., slowed regen, accelerated decay).

________________


________________
Implementation Intent
The framework is data-first. Formulas and scaling factors should be defined in external data files (e.g., JSON, CSV) that both human designers and AI agents can edit safely. Any change to base stats or scaling should propagate automatically to dependent systems through runtime recalculation.
The system must allow the creation of new skills purely through data definition, without requiring script edits.
________________


Constraints
                                                                                                                  * Avoid circular references between modifiers and derived stats.

                                                                                                                  * Ensure stat recalculations are deferred until necessary to prevent frame spikes.

                                                                                                                  * Provide debugging visualization for real-time stat evaluation and modifier stacks.

________________


Balancing & Testing
                                                                                                                     * Each stat and skill interaction must be logged for playtesting.

                                                                                                                     * Designers should be able to visualize average DPS, defense efficiency, and scaling curves.

                                                                                                                     * Provide command-line or debug menu access to stat editors for rapid balancing iteration.

________________
________________


7. Inventory, Equipment & Gadgets System
Purpose & Design Philosophy
The Inventory and Equipment System serves as the organizational and interaction layer for all tangible gameplay items — weapons, armor, consumables, crafting materials, and the Sage’s Gadgets.
It is fully modular, with each item treated as a lightweight Actor subtype that can be equipped, activated, or instantiated in-world.
The design follows three guiding principles:
                                                                                                                        1. Universality – All tangible objects, whether held, worn, or deployed, inherit from the same base interface.

                                                                                                                        2. Seamless Integration – Inventory actions (equip, drop, use) must connect directly to the Actor and FSM systems.

                                                                                                                        3. Dynamic Growth – Support easy addition of new categories, behaviors, or restrictions through modular script extensions.

________________


Core Architecture[b]
Item Data Structure
Each item is represented as a Resource or lightweight data object containing:
                                                                                                                           * item_id (string) – unique identifier
                                                                                                                           * name (string)
                                                                                                                           * type (enum: weapon, armor, consumable, material, gadget, quest)
                                                                                                                           * rarity (enum: common–legendary)
                                                                                                                           * description (string)
                                                                                                                           * weight (float)
                                                                                                                           * value (int)
                                                                                                                           * stackable (bool)
                                                                                                                           * max_stack (int)
                                                                                                                           * equip_slot (enum: head, body, legs, mainhand, offhand, accessory)
                                                                                                                           * use_effect (callable or signal reference)
                                                                                                                           * requirements (struct linking to Stat Framework)
                                                                                                                           * tags (array) – for filtering or special rules (e.g., “flammable”, “bio-tech”, “temporal”)

________________


Inventory Container
Implemented as a component that can be attached to any Actor.
It manages ownership, sorting, capacity, and event hooks.
Key Functions / Signals:
                                                                                                                              * add_item(item_id, quantity=1)
                                                                                                                              * remove_item(item_id, quantity=1)
                                                                                                                              * has_item(item_id)
                                                                                                                              * get_all_items()
                                                                                                                              * on_item_added(item)
                                                                                                                              * on_item_removed(item)

Multiple inventory types are supported:
                                                                                                                                 * Player Inventory – grid-based UI container with visual sorting

                                                                                                                                 * Chest / Storage Inventory – shared or static containers

                                                                                                                                 * Quest Inventory – hidden internal pool for narrative tracking

________________


Equipment System
Equipment slots are attached to the Actor’s EquipmentComponent, which communicates with Stats and Combat Systems.
Each slot dynamically modifies the Actor’s stats when filled.
Example Flow:
                                                                                                                                    1. Player equips BronzeKatana.

                                                                                                                                    2. EquipmentComponent emits on_equipped(item).

                                                                                                                                    3. Stat Framework applies the item’s modifiers (e.g., +5 Strength, +3 Agility).

                                                                                                                                    4. FSM updates animation / combat state to reflect weapon class.

Modifiers are additive or multiplicative and stack according to defined priority groups (e.g., base → gear → buff → temporary).
________________


Gadgets as Actors
Gadgets are special Actor subclasses with dual identity:
                                                                                                                                       * Item Form – stored, equipped, or crafted.

                                                                                                                                       * Actor Form – spawned entity that interacts with world logic.
This allows the same gadget definition to behave differently depending on context:
                                                                                                                                          * Held/Activated → sends use events to FSM (“detect anomaly”, “reveal rift”).

                                                                                                                                          * Placed/Thrown → spawns a gadget Actor with its own FSM and lifetime.

Examples:
                                                                                                                                             * Gramoflower Actor listens to sound events and generates temporal data.

                                                                                                                                             * Chronobloom Actor links with environment time flow variables.
________________


Crafting & Upgrading
The Inventory System connects to a modular Crafting Manager, enabling:
                                                                                                                                                * Recipe-based combination of materials.

                                                                                                                                                * Gear enhancement via unique Sage stations.

                                                                                                                                                * Conditional upgrades based on player stats, reputation, or time phase.

Crafting recipes are also Resources referencing item IDs and requirements.
Example:
Recipe {
    output = "Chronosap_Vial"
    ingredients = ["Sap_Core", "Glass_Vial", "Temporal_Dust"]
    requirements = {"Intelligence": 5, "Timespace": 10}
}
________________


UI Integration
UI panels (Inventory Grid, Equipment Screen, Quick Bar) are separate scenes linked through signals to InventoryComponent.
                                                                                                                                                   * Supports drag-and-drop and controller input.

                                                                                                                                                   * Allows sorting and filtering by type or rarity.

                                                                                                                                                   * Real-time feedback on stat changes when equipping items.

________________


Inter-System Dependencies
Connected System
	Direction
	Description
	Actor System
	↔
	Inventory attached as component to Actors
	FSM
	→
	Handles item use events and animation transitions
	Stat Framework
	↔
	Applies equipment and buff modifiers
	Combat System
	→
	Weapon and gadget usage during attacks
	Quest System
	→
	Checks inventory conditions for progress
	UI System
	↔
	Displays items and handles input events
	________________


________________
Implementation Notes
                                                                                                                                                      * Inventory and Equipment Components should use signal-based communication to stay engine-agnostic.

                                                                                                                                                      * All items are defined via external JSON/Resource databases for easy extension.

                                                                                                                                                      * Equip/Unequip logic must be decoupled from UI to ensure scripted usage and AI compatibility.

                                                                                                                                                      * Gadgets use Actor-based FSM for custom behaviors instead of generic “item use” scripts.
________________


8. Quest & Dialogue System
Purpose & Design Philosophy
The Quest & Dialogue System is the connective tissue between Densetsu’s narrative and gameplay layers.
It governs story progression, NPC interactions, dynamic world states, and player choices — all through modular, data-driven nodes that can adapt to temporal or moral conditions.
Guiding principles:
                                                                                                                                                         1. Separation of Logic and Presentation – Quest state, dialogue flow, and cinematic presentation exist independently.
                                                                                                                                                         2. Data-Driven Modularity – Every quest and conversation is defined in external resources (JSON or TRES), readable by humans and AI tools alike.
                                                                                                                                                         3. World Reactivity – NPCs, environments, and anomalies change state based on quest variables and dialogue outcomes.
________________


________________
Core Architecture
Quest Data Structure
Each quest is defined as a self-contained resource file:
Quest {
    id = "quest_village_rescue"
    title = "The Missing Workers"
    description = "Several miners have vanished beneath Hirogawa’s cliffs."
    stages = [
        {"id": "start", "objective": "Speak to the foreman", "next": "investigate"},
        {"id": "investigate", "objective": "Search the mine entrance", "next": "rescue"},
        {"id": "rescue", "objective": "Free the trapped miners", "next": "return"},
        {"id": "return", "objective": "Report back to the foreman", "next": "complete"},
        {"id": "complete", "objective": "Quest Complete", "rewards": {"xp": 200, "item": "Ore_Shard"}}
    ]
    requirements = {"min_level": 2, "quest_flags": ["intro_complete"]}
}


Each stage is a state node, allowing the system to jump, branch, or revert based on player actions or timeline variables.
________________


________________
Quest Manager
A global QuestManager singleton handles registration, activation, and synchronization of quest data.
Core Functions:
                                                                                                                                                         * add_quest(quest_id)

                                                                                                                                                         * advance_stage(quest_id)

                                                                                                                                                         * complete_quest(quest_id)

                                                                                                                                                         * fail_quest(quest_id)

                                                                                                                                                         * get_active_quests()

                                                                                                                                                         * get_quest_stage(quest_id)

                                                                                                                                                         * Signals:

                                                                                                                                                            * on_quest_started(quest_id)

                                                                                                                                                            * on_quest_updated(quest_id, stage_id)

                                                                                                                                                            * on_quest_completed(quest_id)

Quest progression triggers can come from:
                                                                                                                                                               * NPC dialogue choices

                                                                                                                                                               * Environmental triggers or anomalies

                                                                                                                                                               * Defeating enemies / collecting items

                                                                                                                                                               * Time-based events (loop reset, world phase shift)

________________


________________
Dialogue Framework
Dialogue is built upon a Node-based structure where each node contains text, speaker, emotion, and potential actions.
Example Node:
DialogueNode {
    id = "sage_intro"
    speaker = "Bonsai Sage"
    text = "Time flows through all living things, yet none truly command it."
    choices = [
        {"text": "I seek understanding.", "next": "sage_mentor"},
        {"text": "Time should be left alone.", "next": "sage_approval"}
    ]
    triggers = ["flag_meet_sage"]
}
Dialogue files are linked to NPC Actors through metadata, allowing reuse across contexts and conditions.
________________


State Management & Conditions
Each dialogue node or quest stage can include conditional checks:
                                                                                                                                                                  * Stat thresholds (e.g., Intelligence >= 5)
                                                                                                                                                                  * Temporal states (e.g., “rift active”, “loop unresolved”)
                                                                                                                                                                  * Faction allegiance or morality
                                                                                                                                                                  * Global or local flags (QuestManager.has_flag("sage_trust"))

When conditions fail, alternate branches or fallback lines can be defined, ensuring dynamic reactivity.
________________


Integration with FSM & Actor System
NPCs are treated as Actors whose FSMs can switch between dialogue, idle, combat, or scripted behavior states.
                                                                                                                                                                     * Entering dialogue pauses active FSM states.

                                                                                                                                                                     * Exiting dialogue restores previous context (e.g., patrol, interaction).

                                                                                                                                                                     * NPCs with active quest relevance emit contextual prompts or behavior cues (icons, animations, barks).

________________


Temporal & Moral Branching
The Quest System integrates with Temporal Anomalies and Alignment Systems (future addition) by supporting:
                                                                                                                                                                        * Parallel Timelines – A quest may have alternate versions depending on world phase or loop iteration.

                                                                                                                                                                        * Moral Outcomes – Dialogue and quest actions alter morality or alignment variables.

                                                                                                                                                                        * Delayed Resolution – Some quests appear unsolved until a later time state reveals missing information (e.g., “The Sage’s Lost Apprentice”).

________________


UI & Player Feedback
Quest and dialogue information appear in layered menus:
                                                                                                                                                                           * Active Quest Log – List of current objectives, sorted by region and priority.

                                                                                                                                                                           * Dialogue Interface – Minimalist UI with portrait support and branching choice display.

                                                                                                                                                                           * Codex Integration – Completed quests and key NPCs added to Infinipedia entries.

________________


________________
Inter-System Dependencies
Connected System
	Direction
	Description
	Actor System
	↔
	NPCs act as quest/dialogue hosts
	FSM
	↔
	Transitions between dialogue and behavior states
	Inventory System
	→
	Item-based quest conditions
	Temporal System
	↔
	Manages loop-dependent or timeline-based outcomes
	UI
	↔
	Displays quest log and dialogue interfaces
	________________


Implementation Notes
                                                                                                                                                                              * Dialogue nodes and quest data are stored in external resources for collaborative editing.

                                                                                                                                                                              * Support for versioned quest files allows incremental updates without overwriting progress.

                                                                                                                                                                              * All dialogue and quest events emit signals that can trigger cutscenes, animations, or world changes.

                                                                                                                                                                              * Future expansion: voice-over integration, cinematic camera hooks, and emotion layers.
________________


9. Temporal System
Purpose & Core Philosophy
The Temporal System is the structural layer behind Densetsu’s narrative cause-and-effect — the reason anomalies, loops, and world shifts exist.
It tracks how time behaves across regions, manages rift states, and defines which version of the world or NPCs the player encounters.
Philosophically, time is not a tool — it is an ecosystem.
 The system ensures that every player action has the potential to echo across temporal layers, without granting the player omnipotent control over time.
________________


Core Components
1. Time Context Manager
A singleton that serves as the game’s temporal authority, maintaining and synchronizing all time-related states.
Primary Variables:
                                                                                                                                                                                 * world_phase → Defines the active global state (“Stable”, “Unstable”, “Collapsed”).
                                                                                                                                                                                 * local_time_state → Controls day/night and environmental modifiers.
                                                                                                                                                                                 * rift_activity → Tracks anomalies active in each region.
                                                                                                                                                                                 * loop_registry → Tracks NPCs or areas currently trapped in temporal loops.
                                                                                                                                                                                 * event_history → Stores resolved and pending events for continuity across saves.

Core Functions:
                                                                                                                                                                                    * set_world_phase(phase_name)
                                                                                                                                                                                    * get_world_phase()
                                                                                                                                                                                    * register_anomaly(id, state)
                                                                                                                                                                                    * resolve_anomaly(id)
                                                                                                                                                                                    * get_loop_state(npc_id)
                                                                                                                                                                                    * advance_time(hours)
                                                                                                                                                                                    * emit_time_signal(event_name)

________________


2. World Phase System
Each region operates under a phase model, defining environmental, narrative, and mechanical differences between versions of the same location.
Example:
Phase
	Description
	Gameplay Impact
	Stable
	Normal conditions
	Standard NPC routines, calm weather
	Unstable
	Minor anomalies present
	Time distortions, flickering lighting, altered soundscape
	Collapsed
	Fully corrupted
	Hostile environment, distorted geometry, memory echoes
	World phases are triggered by player actions, narrative events, or anomaly instability.
This system ties directly into level design and environment scripting, allowing regions to “shift” seamlessly between states.
________________


3. Rift and Echo Mechanics
Rifts are spatial-temporal tears caused by the Great Eclipse. They manifest as visual or auditory disturbances.
Rift Types:
                                                                                                                                                                                       * Micro Rift: Minor distortions, localized visual/auditory effects.

                                                                                                                                                                                       * Stable Rift: Fixed entry point to alternate versions of a room or timeline.

                                                                                                                                                                                       * Wild Rift: Random, unstable portals that spawn temporal creatures or loop resets.

                                                                                                                                                                                       * Echo Rift: One-way glimpses into past or future moments.

Each Rift entity is an Actor subclass governed by its own FSM:
                                                                                                                                                                                          * Idle → Distorted → Active → Resolved
                                                                                                                                                                                          * May emit area signals affecting other systems (weather, lighting, enemy AI, etc.)

________________


4. Temporal Flags & Conditions
The Temporal System maintains flags that define historical and conditional truths across time layers.
Examples:
                                                                                                                                                                                             * timeline_sage_alive = false

                                                                                                                                                                                             * rift_03_resolved = true

                                                                                                                                                                                             * npc_ishigane_memory_restored = true

                                                                                                                                                                                             * world_phase = "Unstable"

These flags are queried by:
                                                                                                                                                                                                * Quests and dialogues (QuestManager.has_flag("rift_03_resolved"))

                                                                                                                                                                                                * Level scripts (to swap environment states)

                                                                                                                                                                                                * AI logic (NPCs changing dialogue depending on memory restoration)

                                                                                                                                                                                                * Save system (for world continuity)

________________


5. Day/Night & Natural Cycles
The Temporal System integrates circadian cycles that influence NPC routines, lighting, music, and creature behavior.
                                                                                                                                                                                                   * Daytime: Active trade, peaceful NPCs, passive wildlife.

                                                                                                                                                                                                   * Nighttime: Different NPC and routines, changed dialogue, gadget restrictions.

                                                                                                                                                                                                   * Some gadgets (like Chronobloom or Gramoflower) only function under certain light or energy conditions.

The cycle operates through a configurable timer that triggers global light transitions and calls environmental scripts on thresholds (sunrise, noon, sunset, midnight).
________________


6. Loop Subsystem
This component governs personal time loops (e.g., Varthum’s curse).
Each loop tracks the following variables:
                                                                                                                                                                                                      * loop_id

                                                                                                                                                                                                      * npc_id

                                                                                                                                                                                                      * iteration_count

                                                                                                                                                                                                      * loop_condition (trigger that breaks the cycle)

                                                                                                                                                                                                      * loop_outcome

When conditions are met, the loop is resolved:
                                                                                                                                                                                                         * The NPC’s state transitions to normal.
                                                                                                                                                                                                         * Local timeline stability increases (reducing anomaly spread).
                                                                                                                                                                                                         * Optional memory echo triggers, revealing narrative clues.

This subsystem links directly with the Quest and Dialogue Systems for context-based resolution.
________________


7. Temporal Stability & Feedback
Each action that interacts with time — solving anomalies, breaking loops, using gadgets — contributes to a Stability Index, representing the timeline’s health.
Stability Level
	Range
	World Effect
	Stable
	80–100
	World functions normally
	Wavering
	50–79
	Minor anomalies persist
	Critical
	20–49
	Visual distortion, looping dialogue, glitched terrain
	Collapsed
	0–19
	Time fractures expand, enemies mutate, world phases destabilize
	The system emits global signals when thresholds change, triggering world feedback (music detuning, skybox flickering, NPC confusion, etc.).
________________


8. Integration with Other Systems
Connected System
	Direction
	Description
	FSM
	↔
	Rifts and NPC loops use FSM transitions
	Actor System
	↔
	Time-aware actors adjust behavior by phase
	Quest System
	↔
	Time-dependent quest branching and conditions
	Gadget System
	↔
	Chronogardening tools detect or stabilize anomalies
	Environment
	→
	Changes weather, lighting, and audio dynamically
	UI
	↔
	Displays timeline stability and phase indicators
	________________


9. Implementation Notes
                                                                                                                                                                                                            * Temporal variables should be saved as part of the global save state, not per-scene.

                                                                                                                                                                                                            * Each rift and anomaly should emit area signals that local systems can subscribe to.

                                                                                                                                                                                                            * Phases can be implemented using scene layers or multi-state environment nodes.

                                                                                                                                                                                                            * To optimize performance, only active region timelines update in real time; others remain dormant.

                                                                                                                                                                                                            * A simple in-editor timeline visualizer can help level designers test transitions between world phases.
________________


10. Inventory & Item System
Purpose & Design Philosophy
The Inventory & Item System manages every collectible, equipable, and consumable object in Densetsu.
It acts as a bridge between progression, combat, and world interaction, ensuring that all items — from Sage’s Gadgets to quest relics — behave consistently under a unified logic.
Design goals:
                                                                                                                                                                                                               * Fully data-driven — all items defined in external JSON or TRES resources.
                                                                                                                                                                                                               * Modular — can be extended without refactoring core gameplay systems.
                                                                                                                                                                                                               * Actor-aware — items can interact with or become temporary actors (e.g., thrown gadgets).
                                                                                                                                                                                                               * Context-sensitive — items adapt their behavior based on environment, time phase, or equipped stats.

________________


Core Architecture
1. Inventory Manager
A singleton (autoload) that maintains all items currently owned by the player.
Implements stackable items, equipment slots, quick-use bars, and contextual filters.
Core Variables
                                                                                                                                                                                                                  * inventory_data: Dictionary → All items owned, indexed by ID.
                                                                                                                                                                                                                  * equipped_slots: Dictionary → Current gear / gadgets.
                                                                                                                                                                                                                  * quick_access: Array → Hotbar references.
                                                                                                                                                                                                                  * capacity_limit: int → Defines base and upgradeable capacity.
Core Functions
add_item(item_id: String, amount: int = 1)
remove_item(item_id: String, amount: int = 1)
equip_item(item_id: String)
unequip_item(slot_name: String)
use_item(item_id: String)
has_item(item_id: String) -> bool
get_equipped(slot_name: String) -> Item
________________
2. Item Base Class
Every item derives from a generic Item resource or scriptable object.
Subclasses may define additional behavior (e.g., weapons, consumables, gadgets).
Common Properties
var id: String
var name: String
var type: String # weapon, armor, gadget, consumable, quest
var description: String
var rarity: int
var weight: float
var icon: Texture2D
var stackable: bool = false
var max_stack: int = 99


Hook Methods
func on_use(user: Actor)
func on_equip(user: Actor)
func on_unequip(user: Actor)
func on_update(delta)


This polymorphic approach lets any object plug directly into combat or world logic without special cases.
________________


________________
3. Item Categories
Category
	Description
	Typical Use
	Weapons
	Offensive gear using combat subsystem (swords, kunai, staves).
	Define damage type, range, stamina cost.
	Armor
	Defensive gear modifying stats and resistances.
	Passive bonuses or conditional effects.
	Gadgets
	Sage’s biotech tools — active or passive abilities.
	Detection, puzzle solving, environment interaction.
	Consumables
	One-use items providing immediate effects.
	Restore HP/MP, cure status, temporary buffs.
	Materials
	Crafting components and upgrade ingredients.
	Collected from creatures or nodes.
	Quest Items
	Non-tradable items that trigger or resolve quests.
	Automatically used by Quest System.
	________________


________________
4. Equipment Slots & Loadouts
Each Actor has a loadout profile defining which slots are available.
Example layout:
const EQUIPMENT_SLOTS = {
  "main_hand": null,
  "off_hand": null,
  "head": null,
  "body": null,
  "legs": null,
  "gadget": null,
  "accessory": null
}


The Inventory Manager monitors slot states and emits signals when items change (e.g., equipment_changed(slot_name)).
________________


________________
5. Integration with Other Systems
System
	Direction
	Description
	Actor System
	↔
	Actors hold personal inventories and loadouts.
	Stat System
	↔
	Equipment modifies core stats and skills dynamically.
	Combat System
	↔
	Weapons define attack types and damage calculations.
	FSM
	→
	Use_Item and Equip states trigger animation chains.
	Quest System
	↔
	Quest items add and remove flags when acquired or used.
	UI System
	↔
	Inventory screens and quick access bars.
	Temporal System
	↔
	Some items exist only in specific time phases.
	________________


________________
6. Implementation Notes
                                                                                                                                                                                                                  * Use a data-driven approach (Resource or JSON) so new items don’t require code changes.

                                                                                                                                                                                                                  * Define common signals: item_used, item_equipped, item_removed.

                                                                                                                                                                                                                  * Support filtering and sorting by type for UI integration.

                                                                                                                                                                                                                  * Implement weight limits or capacity upgrades (optional).

                                                                                                                                                                                                                  * For network co-op, Inventory Manager should be replicated via RPC calls on authoritative server.
________________
11. Tools, Editor Integration & Debugging
Purpose & Scope
This section defines the in-editor tools, runtime debugging features, and pipeline integration utilities used during development of Densetsu. These systems are designed to make iteration efficient, testing accessible, and debugging intuitive for both developers and AI-assisted build processes.
The ultimate goal is for all tools to be self-contained, non-destructive, and integrated directly into Godot 4.2+. All diagnostic data should be visible in real time without requiring external software.
________________


1. Editor Integration
1.1 Custom Editor Panels
Custom panels appear within the Godot Editor to facilitate modular workflow:
                                                                                                                                                                                                                     * Actor Inspector: Shows all Actor parameters, including current state, AI flags, and FSM tree visualization.
                                                                                                                                                                                                                     * Stat Monitor: Displays live stat changes, buffs, and debuffs during runtime.
                                                                                                                                                                                                                     * Anomaly Tracker: Lists active temporal anomalies and their parameters (location, type, state, phase link).
                                                                                                                                                                                                                     * Quest Graph Viewer: A node-based interface for editing quest branching and dialogue logic.
                                                                                                                                                                                                                     * Scene Phase Switcher: Toggles environmental or temporal phases directly in the editor to preview transitions.
Each panel is registered through EditorPlugin and can access runtime data via singleton API calls (EngineRuntime.get_actor_data()).
________________


________________
2. Developer Console & Debug Tools
2.1 In-Game Developer Console
Accessible via key command (default: F2). The console allows real-time manipulation of debug variables and spawning test data.
Core Commands
/spawn <actor_id> [amount]
/set_stat <actor_id> <stat> <value>
/tp <region_name>
/toggle_anomaly <id>
/phase <phase_name>
/debug_fsm <actor_id>
2.2 Debug Overlay
A performance and state visualization layer toggled via F3. It overlays essential runtime data:
                                                                                                                                                                                                                     * FPS, frame time, active threads.
                                                                                                                                                                                                                     * Actor count per state (Active, Semi-active, Passive).
                                                                                                                                                                                                                     * Current phase and region.
                                                                                                                                                                                                                     * Memory use and signals emitted per frame.
                                                                                                                                                                                                                     * Timeline stability and Rift activity level.
2.3 Log Channels
Logs are categorized by subsystem to maintain clarity:
                                                                                                                                                                                                                     * core (runtime events)
                                                                                                                                                                                                                     * actor (spawning, state transitions)
                                                                                                                                                                                                                     * combat (damage calculations, hitbox events)
                                                                                                                                                                                                                     * temporal (rift updates, stability index)
                                                                                                                                                                                                                     * quest (triggered flags, dialogue states)
Developers can enable or mute channels via configuration file (debug.cfg).
________________


________________
3. Visualization & Debug Aids
3.1 FSM Visualizer
                                                                                                                                                                                                                     * Displays each state as a node, with color-coded edges for transitions.
                                                                                                                                                                                                                     * Real-time update when the actor switches state.
                                                                                                                                                                                                                     * Optional overlay mode in-game for AI debugging.
3.2 Temporal Phase Visualizer
                                                                                                                                                                                                                     * Shows world phase changes as color gradients over the environment.
                                                                                                                                                                                                                     * Optional distortion shaders indicate timeline instability.
                                                                                                                                                                                                                     * Integrates with the Temporal System's stability_index.
3.3 Combat Debug Grid
                                                                                                                                                                                                                     * Visualizes hitboxes, hurtboxes, and AI target zones.
                                                                                                                                                                                                                     * Displays collision layers and group membership.
                                                                                                                                                                                                                     * Optionally logs hit validation data per frame.
________________


4. Editor Scripting Utilities
Utility
	Description
	Integration
	Batch Scene Renamer
	Renames or re-paths scene files for consistency
	Editor-only plugin
	Data Sync Tool
	Syncs JSON/TRES item databases with in-game Registry
	Godot CLI + script task
	Quest Validator
	Checks dialogue trees and flag logic for broken references
	QuestGraph module
	FSM Auto-Linker
	Scans Actor scripts to auto-generate FSM state lists
	FSM plugin
	Timeline Validator
	Checks Temporal System variables for inconsistencies
	Editor + Runtime
	________________


________________
5. AI-Assisted Build Workflow
The engine supports AI-generated data pipelines for repetitive or data-driven content. These follow strict version control and validation rules:
                                                                                                                                                                                                                     * AI-generated scripts are tagged with header metadata (# AUTO-GENERATED: <timestamp>).
                                                                                                                                                                                                                     * Each generated file is logged for human review before merging.
                                                                                                                                                                                                                     * Tooling automatically checks indentation, naming conventions, and documentation completeness.
This ensures no AI-generated content bypasses quality control or overrides manually maintained code.
________________


6. Implementation Notes
                                                                                                                                                                                                                     * All tools must be toggleable in editor or runtime to minimize overhead.
                                                                                                                                                                                                                     * Prefer EditorInspectorPlugin over custom dock UI for quick integration.
                                                                                                                                                                                                                     * Debug overlays must run on a separate viewport or canvas layer to prevent interference with gameplay rendering.
                                                                                                                                                                                                                     * Consider building a lightweight DebugManager autoload that centralizes all visualization toggles and developer console commands.
                                                                                                                                                                                                                     * All logs, console commands, and state visualizations should be safe for export builds (disabled automatically on release mode).
________________
13. Audio Pipeline & Implementation
Purpose & Scope
This section structures and defines the Audio System, adding deep implementation details, workflow structure, performance considerations, tooling, and subsystem interaction. It defines exactly how audio is authored, stored, played, blended, debugged, and optimized inside the Densetsu Engine.
This section is intended for:
                                                                                                                                                                                                                        * Sound designers
                                                                                                                                                                                                                        * Programmers implementing audio systems
                                                                                                                                                                                                                        * AI-assisted toolchains generating audio logic
                                                                                                                                                                                                                        * Developers creating encounters, anomalies & environments
It provides a complete technical blueprint for the entire audio pipeline.
________________


1. Audio Asset Workflow
1.1 Folder & Naming Conventions
res://audio/
    sfx/
        characters/
        environments/
        anomalies/
        ui/
        gadgets/
    music/
        exploration/
        combat/
        anomaly/
        boss/
        system/
    containers/
        presets/
        behaviors/


________________


Naming Rules:
                                                                                                                                                                                                                        * sfx_<category>_<specific>_<variation>.wav
                                                                                                                                                                                                                        * music_<region>_<state>.ogg
                                                                                                                                                                                                                        * Variants indicated with _v1, _v2, etc.

1.2 File Constraints
                                                                                                                                                                                                                           * Formats: WAV for SFX, OGG for music and long loops.
                                                                                                                                                                                                                           * Sample Rates: 48 kHz standard; 44.1 acceptable for legacy loops.
                                                                                                                                                                                                                           * Bit Depth: 16-bit recommended; 24-bit allowed for mastering.
                                                                                                                                                                                                                           * Loop Metadata: All loopable files must include cue markers or seamless loop edits.

1.3 Authoring Guidelines
                                                                                                                                                                                                                              * All sounds normalized to -6 dBFS peak.
                                                                                                                                                                                                                              * Dialogue or voice-like cues peak at -3 dBFS.
                                                                                                                                                                                                                              * Environmental loops mastered to -12 to -18 LUFS.
________________


2. Sound Containers (System-Level)
Sound Containers are programmable audio objects with parameters and behavior logic.
Each container includes:
                                                                                                                                                                                                                              * AudioStream reference
                                                                                                                                                                                                                              * Propagation model settings
                                                                                                                                                                                                                              * Looping logic
                                                                                                                                                                                                                              * Dynamic reverb / DSP routing
                                                                                                                                                                                                                              * Trigger conditions
                                                                                                                                                                                                                              * Despawn conditions
________________
2.1 Core Parameters
Container {
    stream: AudioStream,
    volume_db: float,
    pitch_scale: float,
    loop: bool,
    loop_blend_time: float,
    propagation_radius: float,
    occlusion_enabled: bool,
    reverb_send: float,
    fade_in: float,
    fade_out: float,
    tags: ["combat", "ui", "gadget", ...]
}


2.2 Instancing Logic
Containers are spawned via AudioManager.spawn(container_id, params).
They can be:
                                                                                                                                                                                                                              * world-anchored (3D/2D positional)
                                                                                                                                                                                                                              * screen-anchored (UI sounds)
                                                                                                                                                                                                                              * global (music, ambience)
________________


3. 2D Sound Propagation Model (Stealth System)
3.1 Core Algorithm
                                                                                                                                                                                                                              1. Cast N rays in a circle from the sound origin.
                                                                                                                                                                                                                              2. Rays stop when hitting collision layers marked as sound_blocker.
                                                                                                                                                                                                                              3. The final propagation polygon defines the audible zone.
                                                                                                                                                                                                                              4. Entities inside polygon -> receive sound event.
Default ray count: 16–256, adjustable per sound.
________________
3.2 Material Dampening
Walls tagged with material types reduce radius:
                                                                                                                                                                                                                              * Wood: -10%
                                                                                                                                                                                                                              * Stone: -25%
                                                                                                                                                                                                                              * Earth: -35%
                                                                                                                                                                                                                              * Metal: -5%
                                                                                                                                                                                                                              * Vegetation: -15%
3.3 Dynamic Occlusion
Volume reduces based on line-of-sight percentage.
final_volume = base_volume * (visible_rays / total_rays)
3.4 Stealth Hooks
NPC hearing behavior listens to:
                                                                                                                                                                                                                              * sound_intensity (volume adjusted by occlusion)
                                                                                                                                                                                                                              * source_tag (weapon, gadget, creature)
                                                                                                                                                                                                                              * alertness_state of the NPC
________________


4. Dynamic Music Loop System
Music is built as modular loops that transition based on gameplay state.
4.1 Music State Graph
Examples:
                                                                                                                                                                                                                              * Exploration → Combat → Victory → Exploration
                                                                                                                                                                                                                              * Tension → BossIntro → BossPhase1 → BossPhase2 → Outro
Each state includes:
                                                                                                                                                                                                                              * Loop
                                                                                                                                                                                                                              * Transition conditions
                                                                                                                                                                                                                              * Exit cue
________________
4.2 Transitions
Types:
                                                                                                                                                                                                                              * Beat-matched (quantized transitions at measure start)
                                                                                                                                                                                                                              * End-of-loop transitions
                                                                                                                                                                                                                              * Instant (UI or urgent events)
4.3 Layer-Based Transitions
Each loop has optional layers:
                                                                                                                                                                                                                              * Percussion
                                                                                                                                                                                                                              * Harmonic pad
                                                                                                                                                                                                                              * Melodic lead
                                                                                                                                                                                                                              * Bass pulse
Layers activate/deactivate via:
                                                                                                                                                                                                                              * Combat intensity
                                                                                                                                                                                                                              * Player health
                                                                                                                                                                                                                              * Anomaly stability index
________________


5. Temporal & Anomaly Audio Effects
Anomalies distort sound.
5.1 Effects (examples)
                                                                                                                                                                                                                              * Time warping: fluctuating pitch & tempo
                                                                                                                                                                                                                              * Reverse echoes: pre-delay reversed for memory loops
                                                                                                                                                                                                                              * Low-pass smearing: reduced clarity near rifts
                                                                                                                                                                                                                              * Spatial pulsation: reverb depth oscillates
5.2 Gadget-Specific Audio Hooks (examples)
                                                                                                                                                                                                                              * Gramoflower: spectral decomposition & whisper decoding
                                                                                                                                                                                                                              * Chronobloom: time-flow pitch sweeps
                                                                                                                                                                                                                              * Memory Lantern: reverb reconstruction of past scenes
                                                                                                                                                                                                                              * Wispcatcher: harmonic location pings
________________


________________
6. Audio Debugging Tools
6.1 Propagation Visualizer
                                                                                                                                                                                                                              * Shows raycasts
                                                                                                                                                                                                                              * Draws propagation polygon
                                                                                                                                                                                                                              * Color-coded intensity zones
6.2 Music Timeline Inspector
                                                                                                                                                                                                                              * Shows loops, transitions, upcoming cues
                                                                                                                                                                                                                              * Allows manual state forcing
6.3 Voice Monitor
                                                                                                                                                                                                                              * Shows active audio voices, priorities, memory use
________________


7. Environmental Audio Zones
Types:
                                                                                                                                                                                                                              * Reverb zones (caves, interiors, forests)
                                                                                                                                                                                                                              * Silence zones (time-frozen regions)
                                                                                                                                                                                                                              * Trigger zones (combat stingers, NPC themes)
Zones blend using weighted priorities.
________________


8. Performance & Optimization
8.1 Streaming
Long files stream from disk.
                                                                                                                                                                                                                              * Buffer size: 500–2000 ms
                                                                                                                                                                                                                              * Music always streamed
8.2 Voice Budget
                                                                                                                                                                                                                              * Max SFX voices: 32–48
                                                                                                                                                                                                                              * Max music voices: 8 (layers)
                                                                                                                                                                                                                              * Occluded sounds culled first
8.3 Caching
Frequent SFX kept in memory via LRU cache.
9. Integration Points
System
	Integration
	FSM
	Combat & stealth transitions drive SFX and music states
	AI
	Hearing system uses propagation model
	Temporal System
	Distortion DSP applied dynamically
	UI
	Uses screen-anchored containers
	Gadgets
	Procedural audio via gadget hooks
	Persistence
	Music state + audio settings saved in profile
	________________


10. Implementation Notes
                                                                                                                                                                                                                              * Use Godot's AudioServer directly for advanced routing.
                                                                                                                                                                                                                              * All DSP routed through sub-buses: reverb, distortion, anomaly_fx.
                                                                                                                                                                                                                              * Custom AudioStreamPlayer multiplexer manages voice culling.
                                                                                                                                                                                                                              * SFX and music run on separate buses with distinct priority rules.
________________


Summary
This expanded audio specification provides a full, production-ready pipeline for the Densetsu engine. It unifies SFX, music, anomalies, and advanced sound logic under a single, modular framework with robust debugging, deep system integration, and scalability for future features.


________________
________________


14. Save, Load & Persistence System
Purpose & Design Philosophy
The Save/Load & Persistence System preserves player progress, world state (including resolved anomalies, world phases, and NPC memory), and relevant telemetry across sessions. It must ensure consistency, integrity, and reproducibility while remaining extensible for features like autosave, multiple slots, checkpoints, and New Game+ (NG+) modes.
Design goals:
                                                                                                                                                                                                                              * Deterministic: Saved state must allow deterministic restoration of gameplay and narrative state for debugging and replay.

                                                                                                                                                                                                                              * Lightweight & Robust: Save files are compact, resilient to partial corruption, and forward-compatible with versioned schema.

                                                                                                                                                                                                                              * Modular: Systems can opt into persistence by providing a serialization contract rather than embedding save logic.

                                                                                                                                                                                                                              * Secure & Portable: Use local file storage with simple integrity checks; plan for future cloud sync/export features.

________________


Core Concepts & Components
1. Persistence Manager (PM)
A singleton service that coordinates save/load operations, slot management, autosave scheduling, and consistency checks.
Primary responsibilities:
                                                                                                                                                                                                                                 * Register persistable subsystems and actors.

                                                                                                                                                                                                                                 * Trigger global save or partial saves (per-region, per-actor).

                                                                                                                                                                                                                                 * Manage save slots, autosave entries, and temporary checkpoint saves.

                                                                                                                                                                                                                                 * Validate save integrity (checksums, version tags).

                                                                                                                                                                                                                                 * Migrate older save formats to newer schemas (simple versioned migration hooks).

Key API (descriptive):
                                                                                                                                                                                                                                    * save(slot_id, options) — options: {type: full|region|checkpoint|quick, reason:string}

                                                                                                                                                                                                                                    * load(slot_id, options) — options: {validate_only:bool}

                                                                                                                                                                                                                                    * autosave() — internal scheduled save

                                                                                                                                                                                                                                    * create_checkpoint() / restore_checkpoint(slot_id)

                                                                                                                                                                                                                                    * register_persistable(id, serializer_callback, priority)

                                                                                                                                                                                                                                    * deregister_persistable(id)

________________


2. Persistable Contract
Any subsystem, Actor, or component that needs to persist state implements a Persistable Contract: two simple operations exposed to the PM:
                                                                                                                                                                                                                                       * serialize() -> Dictionary
 Returns a compact dictionary describing the minimal data required to restore the object. Must include a version field.

                                                                                                                                                                                                                                       * deserialize(data: Dictionary)
 Applies the saved state into the object. Must handle missing fields gracefully and support basic migration based on version.

Design rules:
                                                                                                                                                                                                                                          * Keep serialized payload minimal (avoid duplicating static data that can be referenced by ID).

                                                                                                                                                                                                                                          * Use stable keys (avoid changing keys unless accompanied by migration rules).

                                                                                                                                                                                                                                          * Prefer referential storage (IDs, resource paths) over embedding large data blobs.

________________


________________
3. Save File Layout & Versioning
Save files must be structured, human-readable (for debugging) and optionally compressed for final builds.
Example top-level save structure:
{
  "meta": {
    "format_version": 3,
    "timestamp": "2025-11-14T12:34:56Z",
    "seed": 123456789,
    "player_id": "michio_001",
    "slot_name": "Autosave_1",
    "signature": "sha256:abc123..."
  },
  "player": { /* player serialize dictionary */ },
  "world": { /* world state: regions, anomalies, world_phase */ },
  "actors": { /* registry of persistable actor IDs with lightweight state */ },
  "quests": { /* QuestManager state */ },
  "inventory": { /* Inventory snapshot */ },
  "telemetry": { /* optional playtest analytics */ }
}


________________


Versioning:
                                                                                                                                                                                                                                             * meta.format_version increments when structure changes.
                                                                                                                                                                                                                                             * PM runs migration hooks for older versions upon load.
                                                                                                                                                                                                                                             * Maintain simple, reversible migrations where possible.

Integrity:
                                                                                                                                                                                                                                                * Compute a checksum or signature (sha256 or similar) for the payload and store in meta.signature.
                                                                                                                                                                                                                                                * On load, verify signature; if failed, attempt recovery from backup or notify the user with safe fallback behavior.

________________


4. Save Strategies & Types
Support multiple save types to balance player convenience and world consistency:
                                                                                                                                                                                                                                                   * Full Save (Manual): Captures entire persistable state (player, world, actors). Used for explicit player saves.

                                                                                                                                                                                                                                                   * Autosave: Periodic or event-driven saves (entering hub, completing major quest stage). Stored in special autosave slots; keep 3 rolling autosaves by default.

                                                                                                                                                                                                                                                   * Checkpoint Save: Lightweight snapshot of immediate region and player state for quick respawn. Useful for trial-and-error sections and NG+ balancing.

                                                                                                                                                                                                                                                   * Region Save / Partial Save: Saves only the local region state and related actors, reducing write time. Requires careful dependency tracking.

                                                                                                                                                                                                                                                   * Quick Save: Fast, single-slot temporary save for testing or low-risk actions.

                                                                                                                                                                                                                                                   * Cloud Sync (future): Export/import-safe format for cloud saves—must be opt-in.

Policies:
                                                                                                                                                                                                                                                      * Autosave triggers: major quest completion, region transition, rest at Rest Point, boss defeat.
                                                                                                                                                                                                                                                      * Checkpoints: explicit design in levels where failure cost should be low.
                                                                                                                                                                                                                                                      * Limit UI clutter: show concise save indicators and allow player control over autosave behavior.

________________


5. Actor & World Persistence Patterns
                                                                                                                                                                                                                                                         * Actors:

                                                                                                                                                                                                                                                            * Only actors marked as Persistable by PM are serialized.

                                                                                                                                                                                                                                                            * Use stable actor IDs (e.g., region_boalis::npc_ishigane) to rebind saved state onto newly-instanced objects during load.

                                                                                                                                                                                                                                                            * Actor serialization includes minimal runtime state (health, inventory refs, current FSM state name, custom flags).

                                                                                                                                                                                                                                                            * Do NOT serialize transient runtime data like cached pathfinding nodes; recompute after load.

                                                                                                                                                                                                                                                               * World / Region State:

                                                                                                                                                                                                                                                                  * Regions expose serialize() containing: world_phase, local anomalies (ids & states), unlocked areas, destroyed destructibles, and region-specific flags.

                                                                                                                                                                                                                                                                  * Use event rehydration: after load, PM emits on_region_restored(region_id) to allow region systems to rebuild dependent systems (spawn visual effects, re-evaluate AI patrols).

                                                                                                                                                                                                                                                                     * Quest & Dialogue:

                                                                                                                                                                                                                                                                        * Serialize QuestManager state: active quests, stage indices, global flags, and deferred triggers.

                                                                                                                                                                                                                                                                        * Dialogue nodes should store only current progression and flags; skip storing full dialogue trees.

                                                                                                                                                                                                                                                                           * Inventory & Crafting:

                                                                                                                                                                                                                                                                              * Store item lists as arrays of item_id + quantity, plus equipped slot mapping.

                                                                                                                                                                                                                                                                              * For bespoke items with mutable state (e.g., charged gadgets), include a small state payload (charge level, calibration parameters).

________________


________________
6. New Game+ & Persistent Unlocks
Support NG+ by allowing certain variables to persist across playthroughs:
                                                                                                                                                                                                                                                                                 * Persistent Unlocks: player cosmetics, unlocked quality-of-life features, or meta-progression points.
                                                                                                                                                                                                                                                                                 * NG+ Mode: on starting NG+, player is offered to carry forward selected elements; PM stores an ng_plus_profile that upgrades seed, difficulty multipliers, and persisting unlock list.

Design rule:
                                                                                                                                                                                                                                                                                    * Avoid carrying forward story-critical flags that would break narrative arcs. Offer explicit choices to players for each carry-over item.
________________


7. Autosave & UX Considerations
                                                                                                                                                                                                                                                                                    * Visual confirmation for saves (icon + brief message).

                                                                                                                                                                                                                                                                                    * Undoability: allow limited manual revert to previous slot for user errors.

                                                                                                                                                                                                                                                                                    * Autosave frequency must not interrupt performance; schedule during low CPU frames or on safe events (scene transitions).

                                                                                                                                                                                                                                                                                    * Provide clear settings: autosave on/off, autosave frequency, number of autosave slots kept.

________________


8. Recovery, Corruption Handling & Backups
                                                                                                                                                                                                                                                                                       * Keep a rotating set of backup files (e.g., last 5 slots) to allow recovery from corruption.

                                                                                                                                                                                                                                                                                       * On corruption detected (checksum mismatch), attempt to:

                                                                                                                                                                                                                                                                                          1. Load most recent backup.
                                                                                                                                                                                                                                                                                          2. Notify the player with clear instructions.
                                                                                                                                                                                                                                                                                          3. Offer to export corrupted file for debugging (developer builds).

                                                                                                                                                                                                                                                                                             * Avoid silent data loss: present choices to the player rather than automatic overwrite when discrepancies found.

________________


9. Performance & Optimization
                                                                                                                                                                                                                                                                                                * Prefer partial/region saves during play to minimize I/O pauses.

                                                                                                                                                                                                                                                                                                * Batch serializations and write to disk asynchronously.

                                                                                                                                                                                                                                                                                                * Compress large payloads in release builds; use uncompressed, human-readable JSON/TRES for debug builds.

                                                                                                                                                                                                                                                                                                * Limit frequency of full saves to avoid SSD wear on portable devices.

________________


10. Tools & Editor Support
                                                                                                                                                                                                                                                                                                   * Save Validator Tool: Inspects save files for missing references, broken IDs, and schema mismatches.

                                                                                                                                                                                                                                                                                                   * Persistence Debugger: Editor window to inject test save data, simulate migration paths, and force-load specific slot states.

                                                                                                                                                                                                                                                                                                   * Mock Save Generator: Create fake saves for QA automation and scenario testing.

________________


11. Implementation Notes (Godot 4.2+)
                                                                                                                                                                                                                                                                                                      * Use Godot’s File and ConfigFile APIs for simple reads/writes; consider PackedScene references for scene data where needed.

                                                                                                                                                                                                                                                                                                      * Store saved assets by ID (resource path or canonical string) rather than packing raw scene data whenever possible.

                                                                                                                                                                                                                                                                                                      * Offload serialization and disk I/O to a background worker (Thread or Task) to prevent frame stalls.

                                                                                                                                                                                                                                                                                                      * Implement a lightweight version header at file start for quick validity checks before full load.

________________


________________
12. Security & Future Cloud Save
                                                                                                                                                                                                                                                                                                         * Plan for data integrity and anti-tamper for leaderboards or competitive features.

                                                                                                                                                                                                                                                                                                         * Cloud save design must include conflict resolution (last-write-wins, merge options, or user choice).

                                                                                                                                                                                                                                                                                                         * Provide export/import functions for manual transfer of save files.

________________


Summary
The Persistence System must be robust, modular, and minimally intrusive to gameplay. It should scale from single-player local saves to future cloud-enabled features while protecting narrative consistency and preventing data loss. Every system that requires persistence must register itself with the Persistence Manager and follow the Persistable Contract to ensure a consistent, maintainable save/load architecture.




________________


15. Quest & Dialogue Framework
Purpose & Design Philosophy
This Framework governs story progression, NPC interaction and player choice tracking.
Its primary function is to translate authored narrative structure into modular, data-driven systems that can react dynamically to player state, world anomalies, and prior decisions.
Design goals:
                                                                                                                                                                                                                                                                                                            * Unified Logic Core: Dialogue, quest conditions, and triggers share a single event backbone.
                                                                                                                                                                                                                                                                                                            * Data-Driven Authoring: Writers define quests and dialogue through external JSON/TOML assets or in-engine editors, not hardcoded logic.
                                                                                                                                                                                                                                                                                                            * Branchable & Reversible: Every decision path can be re-entered, reset, or evolved by anomaly effects.
                                                                                                                                                                                                                                                                                                            * Extensible: Supports sidequests, dynamic conversations, and conditional outcomes tied to any persistable variable.
                                                                                                                                                                                                                                                                                                            * Non-blocking: Dialogue never halts world simulation; everything runs asynchronously through the FSM scheduler.
________________


1. Core Architecture Overview
Components
                                                                                                                                                                                                                                                                                                            1. QuestManager (QM):

                                                                                                                                                                                                                                                                                                               * Registers and tracks all quests, their states, and triggers.
                                                                                                                                                                                                                                                                                                               * Exposes global API for querying, updating, and serializing quest data.

                                                                                                                                                                                                                                                                                                                  2. DialogueManager (DM):

                                                                                                                                                                                                                                                                                                                     * Handles conversation flow, branching logic, and voice/subtitle synchronization.
                                                                                                                                                                                                                                                                                                                     * Interfaces directly with QuestManager and Persistence Manager for condition checks and save integration.

                                                                                                                                                                                                                                                                                                                        3. EventRouter (ER):

                                                                                                                                                                                                                                                                                                                           * A lightweight signal hub connecting in-world events (actor deaths, item pickups, anomaly resolves) to quest or dialogue triggers.
                                                                                                                                                                                                                                                                                                                           * Reduces coupling between gameplay code and narrative logic.

2. Quest Definition Structure
Quest data is stored in external files (YAML/JSON).
Each quest is composed of metadata, stages, and conditions.
{
  "id": "quest_sunken_memory",
  "title": "The Sunken Memory",
  "giver": "npc_ayame",
  "stages": [
    {
      "id": "start",
      "objectives": ["Speak to Ayame near the docks."],
      "on_start": ["play_dialogue('ayame_intro')"]
    },
    {
      "id": "retrieve_shell",
      "objectives": ["Find the Resonant Shell in the flooded cave."],
      "conditions": ["inventory_has('resonant_shell')"],
      "on_complete": ["advance_quest('quest_sunken_memory','return_shell')"]
    },
    {
      "id": "return_shell",
      "objectives": ["Return the shell to Ayame."],
      "on_complete": ["reward_xp(250)", "flag_world('memory_restored')"]
    }
  ],
  "rewards": {"xp":250,"item":"chronosap_vial"},
  "flags": {"repeatable":false}
}
Design rules:
                                                                                                                                                                                                                                                                                                                              * Stage IDs act as checkpoints for persistence.
                                                                                                                                                                                                                                                                                                                              * All side effects (rewards, world flags, anomaly resolutions) are queued via EventRouter, not directly applied.
                                                                                                                                                                                                                                                                                                                              * Conditional logic uses simple boolean evaluators referencing runtime variables (world_phase, actor_alive, etc).

________________


3. Dialogue Node Structure
Dialogue is stored in a node-based format — each node has speaker, text, choices, and actions.
{
  "id": "ayame_intro",
  "speaker": "Ayame",
  "text": "You sense it too, don't you? The tides remember...",
  "choices": [
    {
      "text": "Ask about the tides",
      "goto": "ayame_tides"
    },
    {
      "text": "Leave",
      "action": ["end_dialogue"]
    }
  ],
  "on_enter": ["play_voice('ayame_line1')"],
  "conditions": ["quest_not_started('quest_sunken_memory')"]
}
Node Types
                                                                                                                                                                                                                                                                                                                                 * Linear: Auto-advance to next node.

                                                                                                                                                                                                                                                                                                                                 * Branch: Offers multiple choices, may check conditions per choice.

                                                                                                                                                                                                                                                                                                                                 * Conditional: Hidden until conditions true.

                                                                                                                                                                                                                                                                                                                                 * System: Executes special actions (start quest, give item, trigger cutscene).

Dialogue flow is event-driven: each choice dispatches an EventRouter signal processed by the FSM controlling the current scene or actor.
________________


________________
4. Runtime Logic Flow
                                                                                                                                                                                                                                                                                                                                    1. Trigger: Player interacts with a dialogue actor or world object.

                                                                                                                                                                                                                                                                                                                                    2. DM loads dialogue file, spawns UI container, and pushes node ID = entry.

                                                                                                                                                                                                                                                                                                                                    3. Node evaluation: DM checks conditions via QuestManager and GameState.

                                                                                                                                                                                                                                                                                                                                    4. Execution: Plays voice lines, triggers animations, waits for input.

                                                                                                                                                                                                                                                                                                                                    5. Choice selection: Updates quests or variables as defined.

                                                                                                                                                                                                                                                                                                                                    6. Completion: When no next node, DM signals dialogue_finished(actor_id) to EventRouter.

This allows complete decoupling between dialogue content and gameplay logic.
________________


5. Integration with Other Systems
Subsystem
	Interaction
	Persistence Manager
	Serializes quest IDs, current stages, and dialogue progression flags.
	FSM
	Dialogue or quest states can trigger FSM transitions (e.g., NPC → “Post-Quest Idle”).
	UI System
	Uses unified UI framework for dialogue windows, choice lists, and codex pop-ups.
	Audio System
	Associates voice clips and sound cues with nodes; allows lip-sync markers or SFX triggers.
	Localization Layer
	Text and audio keys resolve via external localization database.
	Anomaly System
	Certain dialogues appear only during temporal distortion states; dynamic context resolution.
	________________


6. Authoring Workflow
                                                                                                                                                                                                                                                                                                                                       1. Narrative Authoring Tool (planned):
 Visual editor for branching trees (export JSON).

                                                                                                                                                                                                                                                                                                                                       2. In-Engine Testing:
 Hot-reload dialogue assets and debug conditions via inspector.

                                                                                                                                                                                                                                                                                                                                       3. Tagging Convention:

                                                                                                                                                                                                                                                                                                                                          * @quest: links to quest ID.
                                                                                                                                                                                                                                                                                                                                          * @flag: world variable reference.
                                                                                                                                                                                                                                                                                                                                          * @event: triggers EventRouter events directly.
All narrative content passes through this pipeline, ensuring author-friendly iteration and machine-readable runtime data.
________________


7. Advanced Features
                                                                                                                                                                                                                                                                                                                                          * Reactive Dialogue: Dynamic lines based on emotion or anomaly presence.
                                                                                                                                                                                                                                                                                                                                          * Time-Locked Quests: Expire or loop when player fails to act before reset.
                                                                                                                                                                                                                                                                                                                                          * Memory Echoes: Past dialogue replays after anomalies stabilize (handled by Memory Lantern or Chronobloom).
                                                                                                                                                                                                                                                                                                                                          * Randomized Response Pools: Add variation to repeated interactions.
                                                                                                                                                                                                                                                                                                                                          * Voice & Text Sync: Optional metadata for audio marker timing.
                                                                                                                                                                                                                                                                                                                                          * Interruption Handling: Player movement or external events can interrupt without loss of state.
________________


8. Persistence & Debugging
All active quests and dialogue flags serialize through the Persistence Manager using the standard contract.
Debug tools include:
                                                                                                                                                                                                                                                                                                                                          * Quest log inspector.
                                                                                                                                                                                                                                                                                                                                          * Dialogue tree visualizer (runtime).
                                                                                                                                                                                                                                                                                                                                          * Flag monitor for variable state tracking.

________________


Summary
The Quest & Dialogue Framework unifies narrative and system logic.
By treating quests and conversations as data-driven event systems, Densetsu maintains tight gameplay integration while enabling flexible authoring, localization, and long-term scalability.


________________


16 – UI Framework & Interaction Layer
Purpose & Design Philosophy
The UI Framework governs every interactive screen, overlay, and HUD element in Densetsu.
Its mission is to present dynamic data without disrupting immersion, keeping the aesthetic minimalist, diegetic when possible, and context-reactive.
Key directives:
                                                                                                                                                                                                                                                                                                                                             * Clarity over clutter. Only surface what matters to the player’s current mode.
                                                                                                                                                                                                                                                                                                                                             * Single data source. All UI pulls live data from managers (Stats, FSM, Audio, Persistence).
                                                                                                                                                                                                                                                                                                                                             * Input-agnostic. The same UI logic must function for keyboard/mouse, controller, or touchscreen.
                                                                                                                                                                                                                                                                                                                                             * Diegetic continuity. Wherever possible (e.g., gadgets, HUD effects), the UI should appear as part of the world rather than an overlay.
________________


1. Core Architecture Overview
The UI framework is structured in three runtime layers:
Layer
	Scope
	Examples
	System Layer
	Non-interactive data display bound to core managers
	HUD, Status bars, Timers
	Interactive Layer
	Player-driven menus and prompts
	Inventory, Dialogue choices, Shop UI
	Scene Layer
	Diegetic or hybrid UI anchored to world objects
	Gadget readouts, NPC speech bubbles
	Each layer inherits from a base UIElement class providing visibility control, input handling, and event subscriptions via the EventRouter.
________________


2. Component Classes
                                                                                                                                                                                                                                                                                                                                             1. UIManager – central registry and dispatcher
                                                                                                                                                                                                                                                                                                                                             * Handles load/unload of UI scenes (PackedScene-based).
                                                                                                                                                                                                                                                                                                                                             * Maintains a stack for active menus (modal system).
                                                                                                                                                                                                                                                                                                                                             * Bridges input events and system callbacks.
                                                                                                                                                                                                                                                                                                                                             2. HUDController – lightweight singleton controlling core HUD widgets (health, stamina, mini-map, objective tracker).
                                                                                                                                                                                                                                                                                                                                             3. UIElement (base class)
                                                                                                                                                                                                                                                                                                                                             * Properties: visible, interactable, fade_state, data_source.
                                                                                                                                                                                                                                                                                                                                             * Methods: bind(data_ref), refresh(), play_anim(tag) for animation transitions.
                                                                                                                                                                                                                                                                                                                                             4. UIDataBinder – two-way binding utility connecting signals from data models (e.g., StatSystem) to visual elements (smart health bars, XP rings).
________________


3. Input Handling
                                                                                                                                                                                                                                                                                                                                             * Input events pass through UIManager before reaching gameplay actors.
                                                                                                                                                                                                                                                                                                                                             * Implements Godot 4’s InputMap actions for unified hotkeys and controller navigation.
                                                                                                                                                                                                                                                                                                                                             * Supports contextual prompts (“Press Y to Inspect”) automatically spawned via EventRouter signals.
                                                                                                                                                                                                                                                                                                                                             * Focus system for navigating widgets in menu mode without mouse.
________________


4. Visual Design Principles
                                                                                                                                                                                                                                                                                                                                             * Typography: Clean sans-serif variable font for menus; hand-drawn brush font for diegetic labels.
                                                                                                                                                                                                                                                                                                                                             * Color Hierarchy: Three-tier palette based on world elemental affinities (Earth/Fire/Water/Light).
                                                                                                                                                                                                                                                                                                                                             * Motion: All UI animations use Godot’s AnimationPlayer or Tween system for organic easing (no linear pops).
                                                                                                                                                                                                                                                                                                                                             * Scalability: Anchors and Container-based layout to maintain aspect ratios from 16:9 to 21:9.
________________


________________
5. Menu Structure Hierarchy
Menu
	Purpose
	Linked Systems
	Main Menu
	Start/Continue, Options, Extras
	Persistence, Audio
	Pause Menu
	In-game access to inventory and settings
	StatSystem, Gadget System
	Inventory
	Item management and equip slots
	Actor System, Gadget System
	Quest Log
	Active/Completed quests
	Quest Framework
	Dialogue UI
	Branch presentation and choices
	Dialogue Manager
	Infinipedia
	Codex entries with animated 3D/2D assets
	Persistence, Creature Database
	All menus share transitions and audio cues defined in UITheme resource files.
________________


6. Integration Points
System
	Integration Method
	FSM
	State tags trigger UI modes (e.g., “in_dialogue”, “in_inventory”).
	Audio System
	Plays UI SFX and music transitions from the dynamic loop bank.
	Persistence
	Saves UI preferences and last-visited menu context.
	Localization
	Loads text keys via LangDB on open.
	Accessibility Layer
	Optional contrast modes, scalable fonts, toggle for screen effects.
	________________


7. UI Animation & Feedback
                                                                                                                                                                                                                                                                                                                                             * Uses AnimationPlayer tracks for open/close, pulse, fade.

                                                                                                                                                                                                                                                                                                                                             * HUD widgets respond to game events with procedural feedback (e.g., blood splash shader when HP < 20%).

                                                                                                                                                                                                                                                                                                                                             * Sound feedback linked to input actions (hover, select, cancel).

                                                                                                                                                                                                                                                                                                                                             * Critical alerts (e.g., anomaly detected) use world-anchored visual cues through the Scene Layer.

________________


8. Performance & Memory
                                                                                                                                                                                                                                                                                                                                                * All UI assets preloaded through a single UI Atlas for texture batching.

                                                                                                                                                                                                                                                                                                                                                * Font caching and dynamic LOD for text size reduce draw calls.

                                                                                                                                                                                                                                                                                                                                                * All menus are instanced on demand, then freed on close to reduce VRAM footprint.

________________


9. Debug Tools
                                                                                                                                                                                                                                                                                                                                                   * Live UI inspector (F3): lists active elements, visibility state, focus target.

                                                                                                                                                                                                                                                                                                                                                   * Theme hot-reload: re-imports UITheme without restart.

                                                                                                                                                                                                                                                                                                                                                   * Simulated input replayer for QA automation.

________________


Summary
The UI Framework anchors player interaction within a modular, data-driven structure that aligns with the game’s philosophy of clarity and reactivity.
Every interface —from HUD to codex—runs on the same underlying system, enabling consistent visual logic and smooth integration with FSM, narrative, and persistence layers.
________________


17. Multiplayer Architecture
Overview
The multiplayer framework in Densetsu supports 2–4 local players, with a modular architecture that allows for cooperative, competitive, and mixed modes across various gameplay types. The system is designed to maintain input precision, visual clarity, and dynamic synchronization between player entities, UI, and camera systems.
Core Design Goals
                                                                                                                                                                                                                                                                                                                                                      * Unified Input System: Handle multiple controllers and keyboard inputs through a single abstraction layer.
                                                                                                                                                                                                                                                                                                                                                      * Flexible Player Spawning: Dynamically instantiate player actors with unique IDs, stats, and loadouts.
                                                                                                                                                                                                                                                                                                                                                      * Adaptive Camera Management: Support shared-screen, split-screen, and arena-based modes depending on context.
                                                                                                                                                                                                                                                                                                                                                      * Dynamic UI Assignment: Each player receives independent HUD elements, contextual prompts, and indicators.
                                                                                                                                                                                                                                                                                                                                                      * Session Integrity: Maintain state persistence for all active players within matches and transitions.
Supported Multiplayer Modes
1. Cooperative Modes
                                                                                                                                                                                                                                                                                                                                                      * Arcade Mode: Linear missions that can be played solo or cooperatively. Players share objectives, resources, and revive mechanics.
                                                                                                                                                                                                                                                                                                                                                      * Simulation Training: Short challenge levels supporting simultaneous player participation or turn-based competition.
2. Competitive Modes
                                                                                                                                                                                                                                                                                                                                                      * VS Arena: Head-to-head or team-based combat for 2–4 players, featuring health, stamina, and time-based victory conditions.
                                                                                                                                                                                                                                                                                                                                                      * Ninja Sports: Minigames such as Ninja Volleyball, Shuripong, Capture the Scroll, Ninja Golf, and Ninja Joust (Balance Breaker). Each designed for tight, responsive input and physics-based interactions.
3. Mixed Modes
Some special events and arcade variants combine cooperative objectives with competitive scoring, encouraging both teamwork and rivalry.
________________


Input & Controller Handling
                                                                                                                                                                                                                                                                                                                                                      * Input Abstraction: A unified InputRouter manages device recognition, binding profiles, and per-player input maps.
                                                                                                                                                                                                                                                                                                                                                      * Hot Join / Drop: Players can join or leave mid-session where applicable, triggering reallocation of inputs and HUD elements.
                                                                                                                                                                                                                                                                                                                                                      * Device Priority: Gamepads take precedence over keyboard/mouse combinations, with automatic reassignment if a controller disconnects.
________________


Camera System
                                                                                                                                                                                                                                                                                                                                                      * Shared Camera (Default): Camera tracks all players within a defined bounding area. Zooms and pans dynamically to maintain visibility.
                                                                                                                                                                                                                                                                                                                                                      * Split-Screen Mode: For VS or long-distance separation scenarios. Viewports dynamically split when players exceed camera bounds.
                                                                                                                                                                                                                                                                                                                                                      * Arena Lock: For duels or minigames, the camera remains fixed or slightly dynamic, ensuring equal visibility and spatial fairness.
________________


User Interface
                                                                                                                                                                                                                                                                                                                                                      * HUD Instancing: Each player has a unique HUD instance displaying health, energy, and status effects.
                                                                                                                                                                                                                                                                                                                                                      * Color Coding: Player frames, markers, and effects use distinct palettes for clarity.
                                                                                                                                                                                                                                                                                                                                                      * Shared Prompts: Cooperative interactions (e.g., switches, puzzles) trigger joint prompts, scaled by player proximity.
________________


Session & Data Management
                                                                                                                                                                                                                                                                                                                                                      * Player Profiles: Store cosmetic loadouts, control preferences, and performance stats locally.
                                                                                                                                                                                                                                                                                                                                                      * Match State: Tracks round wins, scores, and timers for versus or sports modes.
                                                                                                                                                                                                                                                                                                                                                      * Save Integration: In co-op, progress merges into the host profile; guests can export session stats to their own files.
________________


________________
Technical Implementation Notes
                                                                                                                                                                                                                                                                                                                                                      * Scene Layers: Each player operates within an independent actor layer but shares global physics and environment contexts.
                                                                                                                                                                                                                                                                                                                                                      * Collision Channels: Player-specific collision masks prevent friendly fire or allow toggled interaction modes.
                                                                                                                                                                                                                                                                                                                                                      * Signal Architecture: Events (hits, scores, triggers) emit through a shared MultiplayerEventBus that updates HUDs and cameras.
________________


Future Stretch Goal: Network Multiplayer
While initially out of scope, the system is modular enough to accommodate online play through:
                                                                                                                                                                                                                                                                                                                                                      * Input prediction and reconciliation systems.
                                                                                                                                                                                                                                                                                                                                                      * Deterministic state syncing for physics and combat.
                                                                                                                                                                                                                                                                                                                                                      * Matchmaking, lobby management, and peer-to-peer fallback.
This would be addressed post-launch as a potential expansion or standalone update.
________________
18. UX & User Experience Systems
Purpose & Philosophy
This section defines the User Experience (UX) strategy for Densetsu, focusing on onboarding, accessibility, feedback loops, and player guidance. While the UI renders visuals and input, UX ensures the player's journey through menus, systems, and gameplay is intuitive, meaningful, and emotionally resonant.
Guiding principles:
                                                                                                                                                                                                                                                                                                                                                      * Respect player time: Minimize friction, allow opt-outs for optional content, and provide quick access to frequently used features.
                                                                                                                                                                                                                                                                                                                                                      * Teach through play: Embed core mechanics in early gameplay rather than excessive tutorials.
                                                                                                                                                                                                                                                                                                                                                      * Progressive disclosure: Reveal complexity gradually as the player gains competence.
                                                                                                                                                                                                                                                                                                                                                      * Consistency: Maintain predictable behavior across interactions and visual language.
________________


1. Onboarding & Tutorial Strategy
1.1 First-Play Flow
                                                                                                                                                                                                                                                                                                                                                      * Micro-tutorials: Introduce core mechanics (movement, basic attack, gadget use, Rest Point leveling) through short, context-sensitive prompts during the opening sequence rather than blocking tutorials.
                                                                                                                                                                                                                                                                                                                                                      * Interactive Intro: The Infinitree hub serves as a safe sandbox for first-time players to experiment with movement and gadgets. Exiting left returns to main menu; right continues game — this acts as an implicit tutorial for navigation.
                                                                                                                                                                                                                                                                                                                                                      * Optional Deep Dives: Offer optional tutorial nodes in the hub for advanced mechanics (combat combos, crafting, anomaly parsing).
1.2 Adaptive Help
                                                                                                                                                                                                                                                                                                                                                      * Track player performance on core metrics (e.g., deaths, repeat failures at a section). If thresholds exceeded, gently offer tips or suggest lowering difficulty.
________________


________________
2. Accessibility & Inclusivity
2.1 Visual Accessibility
                                                                                                                                                                                                                                                                                                                                                      * High-contrast UI mode and alternative color palettes for colorblind users.
                                                                                                                                                                                                                                                                                                                                                      * UI scaling from 80% to 150% with layout reflow.
                                                                                                                                                                                                                                                                                                                                                      * Subtitles with speaker labels and non-verbal sound tags.
2.2 Input Accessibility
                                                                                                                                                                                                                                                                                                                                                      * Fully remappable controls and toggle options for hold vs tap actions.
                                                                                                                                                                                                                                                                                                                                                      * Assist modes: aim assist for ranged mechanics, auto-parry windows (optional), and simplified movement toggles.
2.3 Audio Accessibility
                                                                                                                                                                                                                                                                                                                                                      * Visual indicators for key audio cues (e.g., stealth detection flashes).
                                                                                                                                                                                                                                                                                                                                                      * Adjustable audio channel volumes (SFX, Music, Voice, Ambient).
2.4 Cognitive Accessibility
                                                                                                                                                                                                                                                                                                                                                      * Reduce cognitive load by avoiding simultaneous complex mechanics in tutorial moments.
                                                                                                                                                                                                                                                                                                                                                      * Offer a “Slow Mode” that increases timing windows for key actions.
________________


3. Player Feedback & Affordances
                                                                                                                                                                                                                                                                                                                                                      * Immediate Response: Every player action produces visual, audio, or haptic feedback (if supported).
                                                                                                                                                                                                                                                                                                                                                      * Predictable Consequences: Tooltips and preview lines show expected outcomes for actions (equip changes show stat delta).
                                                                                                                                                                                                                                                                                                                                                      * Failure Feedback: On repeated failure, provide specific, actionable hints (e.g., “Try using the Chronobloom to assess time flow”).
________________


4. Navigation & Information Architecture
                                                                                                                                                                                                                                                                                                                                                      * Primary Navigation: Main menu → Save/Load → Settings → Extras.
                                                                                                                                                                                                                                                                                                                                                      * In-Game Quick Access: Radial gadget wheel and quick-item bar.
                                                                                                                                                                                                                                                                                                                                                      * Contextual Menus: Right-click or controller long-press opens contextual actions for interactive objects.
________________


________________
5. User Research & Iteration Plan
                                                                                                                                                                                                                                                                                                                                                      * Playtests: Weekly internal sessions, bi-weekly external playtests with diverse players.
                                                                                                                                                                                                                                                                                                                                                      * Metrics: Track time-to-complete-tutorial, UI interaction frequency, menu depth, and use of assist features.
                                                                                                                                                                                                                                                                                                                                                      * A/B Tests: Deploy optional variations of prompts and HUD layouts to determine clarity.
________________


6. Localization & Cultural Considerations
                                                                                                                                                                                                                                                                                                                                                      * Externalize all text and audio keys.
                                                                                                                                                                                                                                                                                                                                                      * Design UI to accommodate right-to-left languages and expanded string lengths.
                                                                                                                                                                                                                                                                                                                                                      * Avoid culturally specific icons; prefer universal symbols or context-aware localization.
________________


7. UX for Multiplayer Modes
                                                                                                                                                                                                                                                                                                                                                      * Join/Leave Flow: Simple hot-join with immediate HUD instancing.
                                                                                                                                                                                                                                                                                                                                                      * Split-Screen UX: Maintain critical HUD elements within each viewport’s safe area.
                                                                                                                                                                                                                                                                                                                                                      * Shared Objectives: Clear indicators for shared tasks and priority markers for competitive modes.
________________


8. Analytics & Telemetry
                                                                                                                                                                                                                                                                                                                                                      * Collect anonymized metrics: session length, crash reports, HUD usage, feature opt-ins (assist modes).
                                                                                                                                                                                                                                                                                                                                                      * Respect privacy and provide clear opt-out in settings.
                                                                                                                                                                                                                                                                                                                                                      * Use telemetry to inform tutorials, difficulty curves, and content balancing.
________________


9. Implementation Notes
                                                                                                                                                                                                                                                                                                                                                      * UX rules are enforced by UIManager and Experience Manager; provide a UX policy library for consistency (e.g., prompt frequency, timeout durations).
                                                                                                                                                                                                                                                                                                                                                      * All prompts must be localizable and toggleable.
                                                                                                                                                                                                                                                                                                                                                      * Maintain an experiment flag system to enable or disable new UX flows during playtests.
________________


________________
Summary
This UX framework ensures Densetsu teaches and supports players with grace, reduces friction, and scales to a range of abilities and platforms. It ties directly into onboarding, accessibility, analytics, and multiplayer flows to deliver a unified player experience.
________________
19. Cutscene & Event Scripting System
Overview
The Cutscene & Event Scripting System governs all story-driven, dynamic, and interactive sequences in Densetsu. It unifies cinematics, camera control, scripted gameplay events, anomaly sequences, and environmental storytelling into a single event-driven framework built to integrate with all core systems (FSM, Dialogue, Audio, Persistence, etc.).
The system must be:
                                                                                                                                                                                                                                                                                                                                                      * Modular: Every cutscene is a self-contained asset.
                                                                                                                                                                                                                                                                                                                                                      * Non-blocking: The world simulation continues unless explicitly paused.
                                                                                                                                                                                                                                                                                                                                                      * Deterministic: Playback yields consistent results regardless of frame rate.
                                                                                                                                                                                                                                                                                                                                                      * Data-driven: No hardcoded sequences; all authored via event tracks or scripting files.
                                                                                                                                                                                                                                                                                                                                                      * Extensible: Supports future systems (temporal distortions, boss intros, special camera effects).
________________


1. Core Architecture
The system is composed of four primary components:
1.1 EventDirector
                                                                                                                                                                                                                                                                                                                                                      * Central orchestrator responsible for loading, playing, pausing, and stopping cutscenes or scripted events.
                                                                                                                                                                                                                                                                                                                                                      * Manages state stacks to allow nested events (e.g., anomaly flashback inside a cutscene).
1.2 TimelineTrack System
Cutscenes are built as tracks, similar to animation timelines.
Track types:
                                                                                                                                                                                                                                                                                                                                                      * ActorTrack – controls animations, movement, actions.
                                                                                                                                                                                                                                                                                                                                                      * CameraTrack – positions, zooms, transitions, shakes.
                                                                                                                                                                                                                                                                                                                                                      * AudioTrack – plays SFX, BGM transitions, timing cues.
                                                                                                                                                                                                                                                                                                                                                      * DialogueTrack – triggers dialogue nodes.
                                                                                                                                                                                                                                                                                                                                                      * FXTrack – spawns particles, shaders, distortion pulses.
                                                                                                                                                                                                                                                                                                                                                      * EventTrack – sets variables, dispatches game events.
                                                                                                                                                                                                                                                                                                                                                      * WaitTrack – delays, sync points, and conditional waits.

1.3 EventScript Assets
                                                                                                                                                                                                                                                                                                                                                         * Lightweight text-based scripting format (JSON/YAML/TOML) defining timelines and event conditions.
                                                                                                                                                                                                                                                                                                                                                         * Can embed logic nodes, conditionals, and branching.
1.4 Scene Puppeteering Layer
                                                                                                                                                                                                                                                                                                                                                         * Temporarily overrides actor control (FSM input suppressed).
                                                                                                                                                                                                                                                                                                                                                         * Allows for keyframed motion, procedural posing, or hybrid sequences.
                                                                                                                                                                                                                                                                                                                                                         * Returns control gracefully after completion.
________________


2. Authoring Flow
Step 1: Create an EventScript asset
Authors define:
                                                                                                                                                                                                                                                                                                                                                         * participating actors
                                                                                                                                                                                                                                                                                                                                                         * timeline tracks
                                                                                                                                                                                                                                                                                                                                                         * timings
                                                                                                                                                                                                                                                                                                                                                         * triggers
                                                                                                                                                                                                                                                                                                                                                         * conditions
Step 2: Link to Quest, Dialogue, or GameTrigger
The EventScript is referenced by:
                                                                                                                                                                                                                                                                                                                                                         * quest stage transitions
                                                                                                                                                                                                                                                                                                                                                         * NPC dialogues
                                                                                                                                                                                                                                                                                                                                                         * in-world triggers (pressure plates, anomaly nodes)
Step 3: Test via EventDirector Debug Mode
                                                                                                                                                                                                                                                                                                                                                         * scrub through timeline
                                                                                                                                                                                                                                                                                                                                                         * force play states
                                                                                                                                                                                                                                                                                                                                                         * inspect actor transforms
________________


________________
3. Timeline Track Details
3.1 ActorTrack
                                                                                                                                                                                                                                                                                                                                                         * Play animation
                                                                                                                                                                                                                                                                                                                                                         * Move, Rotate/flip
                                                                                                                                                                                                                                                                                                                                                         * Trigger FSM state
3.2 CameraTrack
Camera is a dedicated actor managed by the CameraDirector.
                                                                                                                                                                                                                                                                                                                                                         * Position, zoom, rotation
                                                                                                                                                                                                                                                                                                                                                         * Smooth follow or rail movement
                                                                                                                                                                                                                                                                                                                                                         * Screen shake (frequency, amplitude)
                                                                                                                                                                                                                                                                                                                                                         * Letterboxing for dramatic scenes
3.3 AudioTrack
                                                                                                                                                                                                                                                                                                                                                         * Start/stop music layers
                                                                                                                                                                                                                                                                                                                                                         * Cue stingers or ambient loops
                                                                                                                                                                                                                                                                                                                                                         * Sync SFX to animations
3.4 DialogueTrack
                                                                                                                                                                                                                                                                                                                                                         * Initiate dialogue node inside the event
                                                                                                                                                                                                                                                                                                                                                         * Pause timeline until choice made (if configured)
3.5 FXTrack
                                                                                                                                                                                                                                                                                                                                                         * Particle burst
                                                                                                                                                                                                                                                                                                                                                         * Shader effects (chromatic aberration, distortion)
                                                                                                                                                                                                                                                                                                                                                         * Screen overlays (anomaly flashes)
3.6 EventTrack
                                                                                                                                                                                                                                                                                                                                                         * Set world flags
                                                                                                                                                                                                                                                                                                                                                         * Advance quest stage
                                                                                                                                                                                                                                                                                                                                                         * Spawn/despawn actors
                                                                                                                                                                                                                                                                                                                                                         * Modify weather or anomaly parameters

3.7 WaitTrack
                                                                                                                                                                                                                                                                                                                                                            * Fixed duration
                                                                                                                                                                                                                                                                                                                                                            * Conditional (wait until actor reaches point, or an FSM event fires)
4. Triggering Events
Events begin from:
                                                                                                                                                                                                                                                                                                                                                            * QuestManager
                                                                                                                                                                                                                                                                                                                                                            * Dialogue choices
                                                                                                                                                                                                                                                                                                                                                            * Area triggers
                                                                                                                                                                                                                                                                                                                                                            * Gadget usage
                                                                                                                                                                                                                                                                                                                                                            * Anomaly destabilization
                                                                                                                                                                                                                                                                                                                                                            * Cutscene chaining (nested sequences)
All triggers route through EventDirector for consistency.
________________


5. Integration with Core Systems
System
	Integration
	FSM
	Actors are controlled or partially overridden during events
	Dialogue
	Cutscenes can start, branch, or respond to dialogue choices
	Audio
	Music transitions & SFX timing tied to timeline
	Temporal System
	Cutscenes can induce slow/fast time distortions
	Persistence
	Event progress saved once flagged or completed
	Camera System
	CameraDirector executes camera timeline tracks
	________________


6. Temporal & Anomaly Sequences
Special support for:
                                                                                                                                                                                                                                                                                                                                                            * Scenes inside scenes (Trigger cutscene or level without leaving current one)
                                                                                                                                                                                                                                                                                                                                                            * Reverse-time playback (local only)
                                                                                                                                                                                                                                                                                                                                                            * Stuttered frames when anomalies spike
                                                                                                                                                                                                                                                                                                                                                            * Alternate timelines showing what "should have happened"
Timeline supports time-warp markers:
                                                                                                                                                                                                                                                                                                                                                            * reverse playback
                                                                                                                                                                                                                                                                                                                                                            * half-speed sequences
                                                                                                                                                                                                                                                                                                                                                            * jitter frames

These integrate with the temporal shader pipeline and anomaly logic.
7. Event Scripting Language (ESL)
Example (YAML)
actors:
  - id: michio
  - id: ayame


tracks:
  - type: camera
    keyframes:
      - time: 0.0
        pos: [120, 80]
        zoom: 1.2
      - time: 1.5
        pos: [160, 80]
        zoom: 1.0


  - type: actor
    actor: ayame
    actions:
      - time: 0.2
        play_anim: "wave"


  - type: dialogue
    node: "ayame_intro"


  - type: event
    at: 3.0
    set_flag: "memory_restored"


The ESL is intentionally minimal to be writable by designers and interpretable by AI tools.
________________


8. Playback Modes
Cinematic Mode
                                                                                                                                                                                                                                                                                                                                                               * Full control override
                                                                                                                                                                                                                                                                                                                                                               * Letterboxing
                                                                                                                                                                                                                                                                                                                                                               * Player input locked
Interactive Mode
                                                                                                                                                                                                                                                                                                                                                               * Player can move during timeline
                                                                                                                                                                                                                                                                                                                                                               * Timeline reacts to conditions
________________
Hybrid Mode
                                                                                                                                                                                                                                                                                                                                                               * Player walks while camera and NPCs follow scripted tracks
Anomaly Mode
                                                                                                                                                                                                                                                                                                                                                               * Time distortion effects applied
                                                                                                                                                                                                                                                                                                                                                               * Cutscene pacing altered based on stability indices
________________


9. Debug Tools
                                                                                                                                                                                                                                                                                                                                                               * Timeline Scrubber
                                                                                                                                                                                                                                                                                                                                                               * Track Inspector
                                                                                                                                                                                                                                                                                                                                                               * Actor Override Panel
                                                                                                                                                                                                                                                                                                                                                               * Event Log View (all triggered signals)
                                                                                                                                                                                                                                                                                                                                                               * Camera Path Visualizer
________________


10. Implementation Notes
                                                                                                                                                                                                                                                                                                                                                               * EventDirector must run on deterministic time independent of framerate.
                                                                                                                                                                                                                                                                                                                                                               * Tracks must be stateless and read-only during playback.
                                                                                                                                                                                                                                                                                                                                                               * Event cancellation returns control gracefully to all actors.
                                                                                                                                                                                                                                                                                                                                                               * Nested events use a stack to avoid losing context.
                                                                                                                                                                                                                                                                                                                                                               * Integration with Persistence ensures mid-event saves load correctly.
________________


Summary
This system forms the backbone of story delivery, anomaly sequences, and all scripted gameplay moments in Densetsu. By combining timeline tracks, event-driven logic, and deep integration with core engine systems, it ensures cinematic expression, narrative clarity, and technical reliability while supporting both linear storytelling and freeform exploration.
________________
20 – Physics, Collision & Interaction 
Purpose
Define how Densetsu handles physical interactions, collision detection, spatial queries, environmental responses, and physics-driven gameplay behaviors. This is one of the engine’s most foundational systems, influencing combat, movement, stealth, AI, gadgets, and puzzle mechanics.
This section establishes a modular, actor-driven physical interaction framework that integrates natively with Godot’s physics engine while allowing high-level customization.
________________


20.1 Core Principles
                                                                                                                                                                                                                                                                                                                                                               1. Modular Physics
 Each actor defines its own physical characteristics through a modular component system (colliders, sensors, physics flags).
Every object should be adjustable without rewriting physics code.

                                                                                                                                                                                                                                                                                                                                                               2. Predictable & Fair Interactions
 Hitboxes, hurtboxes, terrain, moving platforms, and hazards rely on deterministic logic.
Combat reads movement data and collision results without hacks.

                                                                                                                                                                                                                                                                                                                                                               3. Lightweight Simulation
 No heavy rigid-body simulation for characters.
Combatants use kinematic motion with custom physics rules to guarantee responsiveness.

                                                                                                                                                                                                                                                                                                                                                               4. Environment-First
 Movement abilities, stealth, gadgets, environmental puzzles, and platforming must obey the same unified physics.
________________


________________
20.2 Collision Architecture
Types of Colliders
Each actor may include one or more of the following:
                                                                                                                                                                                                                                                                                                                                                                  * Primary Body Collider (PBC):
 Defines the actor’s physical presence; interacts with terrain and platforms.
                                                                                                                                                                                                                                                                                                                                                                  * Hurtboxes:
 Damage receivers. Can have multiple layers (body, head, limbs, etc.).
                                                                                                                                                                                                                                                                                                                                                                  * Hitboxes:
 Damage dealers during attacks; abstracted through FSM frame events.
                                                                                                                                                                                                                                                                                                                                                                  * Sensors:
 Used for AI, gadgets, sound detection, stealth cones, and environment triggers.
                                                                                                                                                                                                                                                                                                                                                                  * Interaction Volumes:
 Contextual interaction triggers (NPC talk range, pickup range, ledge grab detect).
________________


Collision Layers & Masks
A strict naming and numbering system governs how objects detect one another:
                                                                                                                                                                                                                                                                                                                                                                     1. Terrain
                                                                                                                                                                                                                                                                                                                                                                     2. Actor Bodies
                                                                                                                                                                                                                                                                                                                                                                     3. Actor Hitboxes
                                                                                                                                                                                                                                                                                                                                                                     4. Actor Hurtboxes
                                                                                                                                                                                                                                                                                                                                                                     5. Gadgets & Projectiles
                                                                                                                                                                                                                                                                                                                                                                     6. Traps & Hazards
                                                                                                                                                                                                                                                                                                                                                                     7. Sound Propagation Polygons
                                                                                                                                                                                                                                                                                                                                                                     8. UI / Debug
                                                                                                                                                                                                                                                                                                                                                                     9. Multiplayer Entities (Local)
                                                                                                                                                                                                                                                                                                                                                                     10. Multiplayer Shared Objects
This ensures clarity and predictable behaviors.
________________


________________
20.3 Motion & Movement Resolution
Character Motion
All characters—including enemies, creatures, players—use a shared motion solver:
                                                                                                                                                                                                                                                                                                                                                                     * Kinematic motion (move_and_slide + custom vertical/horizontal friction)
                                                                                                                                                                                                                                                                                                                                                                     * FSM-driven actions override default movement
                                                                                                                                                                                                                                                                                                                                                                     * Priority system: forced movement > skill movement > basic locomotion
Environmental Forces
The framework supports:
                                                                                                                                                                                                                                                                                                                                                                     * Wind zones (push actors)
                                                                                                                                                                                                                                                                                                                                                                     * Water physics (buoyancy, drag)
                                                                                                                                                                                                                                                                                                                                                                     * Slippery surfaces
                                                                                                                                                                                                                                                                                                                                                                     * Gravity direction overrides (for anomalies)
________________


20.4 Dynamic Environment Interaction
Interactable Elements
                                                                                                                                                                                                                                                                                                                                                                     * Ledges (grab, climb, vault)
                                                                                                                                                                                                                                                                                                                                                                     * Breakable objects (state changes)
                                                                                                                                                                                                                                                                                                                                                                     * Switches, levers
                                                                                                                                                                                                                                                                                                                                                                     * Pushable/pullable blocks
                                                                                                                                                                                                                                                                                                                                                                     * Physics puzzles (only lightweight, actor-style)
                                                                                                                                                                                                                                                                                                                                                                     * Climbable surfaces (vines, walls)
Anomaly-Affected Physics
Temporal anomalies may:
                                                                                                                                                                                                                                                                                                                                                                     * Reverse gravity
                                                                                                                                                                                                                                                                                                                                                                     * Slow or accelerate local physics
                                                                                                                                                                                                                                                                                                                                                                     * Disable friction
                                                                                                                                                                                                                                                                                                                                                                     * Create repeating physics loops
                                                                                                                                                                                                                                                                                                                                                                     * Phase platforms in/out
Actors must adapt based on “environment flags” read each frame.
________________


________________
20.5 Hit Detection & Combat Physics
Hit Registration
A custom system processes:
                                                                                                                                                                                                                                                                                                                                                                     1. Hitbox volume → Hurtbox volume intersection
                                                                                                                                                                                                                                                                                                                                                                     2. Attack data → Defensive data
                                                                                                                                                                                                                                                                                                                                                                     3. Result → Damage event → FSM reaction
This ensures:
                                                                                                                                                                                                                                                                                                                                                                     * No dependency on Godot’s built-in physics for combat logic
                                                                                                                                                                                                                                                                                                                                                                     * Deterministic and replay-safe combat outcomes
Knockback & Impulse Rules
Knockback uses:
                                                                                                                                                                                                                                                                                                                                                                     * Strength × weapon modifier × contact angle
                                                                                                                                                                                                                                                                                                                                                                     * Environment modifiers (slopes, slippery surfaces, water)
                                                                                                                                                                                                                                                                                                                                                                     * Actor-specific resistances
________________


20.6 Sound & Stealth Interaction (Physics Side)
Sound propagation relies on ray occlusion:
                                                                                                                                                                                                                                                                                                                                                                     * From source → cast N rays (configurable)
                                                                                                                                                                                                                                                                                                                                                                     * Build visible polygon minus occlusions
                                                                                                                                                                                                                                                                                                                                                                     * Actors inside polygon receive sound event with intensity dropoff
                                                                                                                                                                                                                                                                                                                                                                     * Entities check:

                                                                                                                                                                                                                                                                                                                                                                        * Awareness state
                                                                                                                                                                                                                                                                                                                                                                        * Direction of sound
                                                                                                                                                                                                                                                                                                                                                                        * Distance
This section cross-links with Audio (Section 13) and AI Perception (Section 7).
________________


________________
20.7 Multiplayer Considerations
Local multiplayer physics must ensure:
                                                                                                                                                                                                                                                                                                                                                                        * Stable collisions with 2–4 players
                                                                                                                                                                                                                                                                                                                                                                        * Player priority resolution (who takes a platform slot, who gets shoved)
                                                                                                                                                                                                                                                                                                                                                                        * Sound propagation per-player where relevant
                                                                                                                                                                                                                                                                                                                                                                        * Camera boundaries and dynamic splits (if used in the future)
Network multiplayer is marked as a stretch goal, not planned here.
________________


20.8 Debug & Tooling
Built-in physics tools:
                                                                                                                                                                                                                                                                                                                                                                        * Hitbox/hurtbox visualizer
                                                                                                                                                                                                                                                                                                                                                                        * Sensor overlays
                                                                                                                                                                                                                                                                                                                                                                        * Raycast debugging
                                                                                                                                                                                                                                                                                                                                                                        * Sound polygon display
                                                                                                                                                                                                                                                                                                                                                                        * Environment flag viewer
                                                                                                                                                                                                                                                                                                                                                                        * Actor physical state inspector
These tools allow designers to rapidly test physics-dependent systems.
________________
21 — Animation, VFX & Procedural Feedback System
Purpose
Define the unified system for animations, visual effects, procedural feedback, and state-driven presentation. This framework ensures that gameplay systems, FSM logic, combat, movement, gadgets, and anomalies all visually communicate their state in real time.
This section establishes how the engine handles animation playback, blending, timings, event signaling, and integrated VFX responses.
________________


21.1 Core Principles
                                                                                                                                                                                                                                                                                                                                                                        1. State-Driven Presentation
 Animations and effects are controlled by actor states and frame events, not by hardcoded logic.

                                                                                                                                                                                                                                                                                                                                                                        2. Minimal Animator Dependency
 Animators provide clean clips; the engine handles the logic.

                                                                                                                                                                                                                                                                                                                                                                        3. Full Separation Between Data & Presentation
 Animations don’t contain logic, only triggers.
Logic doesn’t contain animations, only references.

                                                                                                                                                                                                                                                                                                                                                                        4. Procedural Enhancement
 Impacts, wind-ups, footstep dust, weapon trails, and environmental reactions are automatically spawned via procedural VFX rules.

                                                                                                                                                                                                                                                                                                                                                                        5. Modularity
 Each actor, gadget, creature, or destructible object uses the same animation & VFX interface.
________________


________________
21.2 Animation System Architecture
Base Animation Player
Every actor contains an AnimationGraphController, which:
                                                                                                                                                                                                                                                                                                                                                                           * Reads the actor’s FSM current state
                                                                                                                                                                                                                                                                                                                                                                           * Selects the correct animation
                                                                                                                                                                                                                                                                                                                                                                           * Handles blending (directional, speed-based, or triggered)
                                                                                                                                                                                                                                                                                                                                                                           * Triggers events based on animation frames
                                                                                                                                                                                                                                                                                                                                                                           * Supports additive layers (breathing, blinking, minor pose shifts)
                                                                                                                                                                                                                                                                                                                                                                           * Supports per-bone manipulation for subtle procedural corrections
The animation graph is data-driven, meaning:
                                                                                                                                                                                                                                                                                                                                                                           * States define animation names
                                                                                                                                                                                                                                                                                                                                                                           * Animations define tags
                                                                                                                                                                                                                                                                                                                                                                           * FSM emits timing signals
                                                                                                                                                                                                                                                                                                                                                                           * No code duplication required
________________


Animation Categories
                                                                                                                                                                                                                                                                                                                                                                           * Locomotion: idle, walk, run, jump, fall, land
                                                                                                                                                                                                                                                                                                                                                                           * Combat: punches, kicks, combos, weapon swings
                                                                                                                                                                                                                                                                                                                                                                           * Special Moves: rolls, dashes, aerial recoveries
                                                                                                                                                                                                                                                                                                                                                                           * Reactions: taking damage, parries, knockback
                                                                                                                                                                                                                                                                                                                                                                           * Status Effects: stunned, slowed, corrupted
                                                                                                                                                                                                                                                                                                                                                                           * Non-Combat: interactions, talking, pushing objects
                                                                                                                                                                                                                                                                                                                                                                           * Cinematic: short 1–2 second contextual animations
                                                                                                                                                                                                                                                                                                                                                                           * Gadget Use: deploying, activating, charging, listening
                                                                                                                                                                                                                                                                                                                                                                           * Creature Movement: crawling, flying, running, etc.
Each animation may include:
                                                                                                                                                                                                                                                                                                                                                                           * Root motion (optional)
                                                                                                                                                                                                                                                                                                                                                                           * Events (hit frames, dust spawns, gadget pulses)
                                                                                                                                                                                                                                                                                                                                                                           * Tags (airborne, grounded, attack, movement, stealth)
________________


________________
21.3 Frame Events & Animation Hooks
Frame events are the backbone of the system.
Event Types
                                                                                                                                                                                                                                                                                                                                                                           * Hitbox Create / Remove
                                                                                                                                                                                                                                                                                                                                                                           * Movement Impulse
                                                                                                                                                                                                                                                                                                                                                                           * Sound Trigger
                                                                                                                                                                                                                                                                                                                                                                           * VFX Trigger
                                                                                                                                                                                                                                                                                                                                                                           * Camera Shake
                                                                                                                                                                                                                                                                                                                                                                           * State Notify (FSM)
                                                                                                                                                                                                                                                                                                                                                                           * Footstep Event
                                                                                                                                                                                                                                                                                                                                                                           * Weapon Trail Start / Stop
                                                                                                                                                                                                                                                                                                                                                                           * Particle Emitter Toggle
Usage
Animation frames (or timestamps) contain event markers.
FSM reads and executes them in real time.
Example: A sword swing might define:
Frame
	Event
	3
	Enable hitbox
	5
	Play woosh sound
	7
	Spawn slash VFX
	9
	Disable hitbox
	No special-case logic inside animations — all mapped in data.
________________


21.4 VFX System
A universal VFX Spawner handles:
                                                                                                                                                                                                                                                                                                                                                                           * Particle systems (sparks, dust, magic burst)
                                                                                                                                                                                                                                                                                                                                                                           * Animated sprites (slash trails, puffs, wind marks)
                                                                                                                                                                                                                                                                                                                                                                           * Light pulses
                                                                                                                                                                                                                                                                                                                                                                           * Shader effects (impact distortion, ghost trails, temporal tearing)
                                                                                                                                                                                                                                                                                                                                                                           * Gadget-specific biological effects (spores, sap, chrono-blooms)

Each VFX asset is defined as a template containing:
                                                                                                                                                                                                                                                                                                                                                                              * Style category
                                                                                                                                                                                                                                                                                                                                                                              * Lifetime
                                                                                                                                                                                                                                                                                                                                                                              * Position rules (actor root, weapon tip, limb)
                                                                                                                                                                                                                                                                                                                                                                              * Scaling behavior
                                                                                                                                                                                                                                                                                                                                                                              * Animation or particle parameters
                                                                                                                                                                                                                                                                                                                                                                              * Optional shader parameters (e.g., time ripple intensity)
VFX templates can be invoked by:
                                                                                                                                                                                                                                                                                                                                                                              * Hit results
                                                                                                                                                                                                                                                                                                                                                                              * Animation events
                                                                                                                                                                                                                                                                                                                                                                              * Environmental triggers
                                                                                                                                                                                                                                                                                                                                                                              * Status effects
                                                                                                                                                                                                                                                                                                                                                                              * Anomalies
                                                                                                                                                                                                                                                                                                                                                                              * Gadgets
________________


21.5 Procedural Feedback Ruleset
Procedural feedback ensures consistency without manual placement.
Examples
                                                                                                                                                                                                                                                                                                                                                                              * Landing generates dust proportional to fall distance
                                                                                                                                                                                                                                                                                                                                                                              * Heavy hits apply recoil shake + impact sparks
                                                                                                                                                                                                                                                                                                                                                                              * Running emits footstep puffs based on material
                                                                                                                                                                                                                                                                                                                                                                              * Stealth takes into account surface type for step sounds & dust
                                                                                                                                                                                                                                                                                                                                                                              * Critical hits apply unique slash trails + short motion blur
                                                                                                                                                                                                                                                                                                                                                                              * Using a gadget may emit a unique biological VFX pulse
                                                                                                                                                                                                                                                                                                                                                                              * Damage taken spawns hit flash shader effect

Everything must be triggered automatically, based on:
                                                                                                                                                                                                                                                                                                                                                                                 * Actor physical data
                                                                                                                                                                                                                                                                                                                                                                                 * Damage type
                                                                                                                                                                                                                                                                                                                                                                                 * Surface type
                                                                                                                                                                                                                                                                                                                                                                                 * Movement speed
                                                                                                                                                                                                                                                                                                                                                                                 * Current state
                                                                                                                                                                                                                                                                                                                                                                                 * Equipment used
________________


________________
21.6 Camera Feedback Tools
The system supports:
                                                                                                                                                                                                                                                                                                                                                                                 * Directional shake (source → camera angle)
                                                                                                                                                                                                                                                                                                                                                                                 * Smooth follow w/ dead zones and elastic drag
                                                                                                                                                                                                                                                                                                                                                                                 * Hit stop (“impact pause”)
                                                                                                                                                                                                                                                                                                                                                                                 * Focus transition for bosses or mini-events
                                                                                                                                                                                                                                                                                                                                                                                 * Split-screen rules (if implemented for local multiplayer)
                                                                                                                                                                                                                                                                                                                                                                                 * Cinematic framing for anomalies or scripted moments
Camera responses are tightly integrated with frame events and VFX triggers.
________________


21.7 Material & Shader Integration
Shaders add temporal flavor:
                                                                                                                                                                                                                                                                                                                                                                                 * Outline pulses for anomalies
                                                                                                                                                                                                                                                                                                                                                                                 * Chromatic distortion around rifts
                                                                                                                                                                                                                                                                                                                                                                                 * “Afterimage” trails during fast moves
                                                                                                                                                                                                                                                                                                                                                                                 * Blinking hit-flash effect on damaged actors
                                                                                                                                                                                                                                                                                                                                                                                 * Flowing gradients for Gaea and Timespace affinity magic
                                                                                                                                                                                                                                                                                                                                                                                 * Water ripple deformation
                                                                                                                                                                                                                                                                                                                                                                                 * Heat haze from fire attacks
All shaders must expose configurable parameters for code or animation events.
________________


21.8 Multiplayer Considerations
In local multiplayer:
                                                                                                                                                                                                                                                                                                                                                                                 * Each player’s action effects must remain readable
                                                                                                                                                                                                                                                                                                                                                                                 * VFX auto-scale or tone down based on player count
                                                                                                                                                                                                                                                                                                                                                                                 * Camera feedback must not disorient non-acting players
                                                                                                                                                                                                                                                                                                                                                                                 * Sound triggers must remain spatially consistent
                                                                                                                                                                                                                                                                                                                                                                                 * Hitbox visualization for debugging must show per-player IDs
Network multiplayer, if ever implemented, would require syncing:
                                                                                                                                                                                                                                                                                                                                                                                 * Animation states
                                                                                                                                                                                                                                                                                                                                                                                 * Frame events
                                                                                                                                                                                                                                                                                                                                                                                 * Hitboxes/hurtboxes
                                                                                                                                                                                                                                                                                                                                                                                 * VFX triggers
                                                                                                                                                                                                                                                                                                                                                                                 * Camera-independent feedback

22. Input, Controls & Action Mapping
22.1 Purpose
Define a unified, fully modular input and action mapping system that supports:
                                                                                                                                                                                                                                                                                                                                                                                    * Keyboard, mouse, controller, and mixed setups
                                                                                                                                                                                                                                                                                                                                                                                    * Rebindable controls
                                                                                                                                                                                                                                                                                                                                                                                    * Context‑sensitive actions
                                                                                                                                                                                                                                                                                                                                                                                    * Multi‑player input handling (2–4 players)
                                                                                                                                                                                                                                                                                                                                                                                    * AI/automation hooks
                                                                                                                                                                                                                                                                                                                                                                                    * Replay/ghost data
The system ensures absolute determinism and consistency across gameplay, FSM, combat, gadgets, and interactions.
22.2 Core Principles
                                                                                                                                                                                                                                                                                                                                                                                    1. Action‑Driven, Not Button‑Driven – The game listens for actions ("Jump", "Attack", "Interact") instead of direct button names.
                                                                                                                                                                                                                                                                                                                                                                                    2. Context Layers – Exploration, combat, menus, gadgets, and anomalies each have their own input layer.
                                                                                                                                                                                                                                                                                                                                                                                    3. Fully Rebindable – Every action can be rebound by the player.
                                                                                                                                                                                                                                                                                                                                                                                    4. Multi‑Device Support – Any combination of keyboard/mouse/controller per player.
                                                                                                                                                                                                                                                                                                                                                                                    5. Predictable – Inputs feed into a deterministic buffer consumed by the FSM.
                                                                                                                                                                                                                                                                                                                                                                                    6. Modular – New actions or devices can be added without rewriting code.
________________
22.3 Action Map Structure
Actions are grouped into categories:
Player Movement
                                                                                                                                                                                                                                                                                                                                                                                    * Move_Left
                                                                                                                                                                                                                                                                                                                                                                                    * Move_Right
                                                                                                                                                                                                                                                                                                                                                                                    * Jump
                                                                                                                                                                                                                                                                                                                                                                                    * Crouch
                                                                                                                                                                                                                                                                                                                                                                                    * Dash
                                                                                                                                                                                                                                                                                                                                                                                    * Wall_Slide
Combat
                                                                                                                                                                                                                                                                                                                                                                                    * Attack_Light
                                                                                                                                                                                                                                                                                                                                                                                    * Attack_Heavy
                                                                                                                                                                                                                                                                                                                                                                                    * Weapon_Switch
                                                                                                                                                                                                                                                                                                                                                                                    * Guard / Parry
                                                                                                                                                                                                                                                                                                                                                                                    * Dodge
                                                                                                                                                                                                                                                                                                                                                                                    * Aim (for ranged)
                                                                                                                                                                                                                                                                                                                                                                                    * Shoot / Throw
Interaction
                                                                                                                                                                                                                                                                                                                                                                                    * Interact
                                                                                                                                                                                                                                                                                                                                                                                    * Pickup
                                                                                                                                                                                                                                                                                                                                                                                    * Use_Gadget
                                                                                                                                                                                                                                                                                                                                                                                    * Inspect
                                                                                                                                                                                                                                                                                                                                                                                    * Talk
System
                                                                                                                                                                                                                                                                                                                                                                                    * Pause
                                                                                                                                                                                                                                                                                                                                                                                    * Menu_Navigate
                                                                                                                                                                                                                                                                                                                                                                                    * Menu_Confirm
                                                                                                                                                                                                                                                                                                                                                                                    * Menu_Cancel
Special / State‑Driven
                                                                                                                                                                                                                                                                                                                                                                                    * Context_Action (changes meaning based on state)
                                                                                                                                                                                                                                                                                                                                                                                    * Gadget_Alt_Action
                                                                                                                                                                                                                                                                                                                                                                                    * Stealth_Toggle (if implemented)
These actions are stored in a data file readable by Godot.
________________
22.4 Per‑Player Input Routing
Each player slot (1–4) owns:
                                                                                                                                                                                                                                                                                                                                                                                    * A unique Input Device Profile
                                                                                                                                                                                                                                                                                                                                                                                    * An Action Map Instance
                                                                                                                                                                                                                                                                                                                                                                                    * Input history buffer
                                                                                                                                                                                                                                                                                                                                                                                    * Controller vibration parameters (if applicable)
Players can:
                                                                                                                                                                                                                                                                                                                                                                                    * Use different devices
                                                                                                                                                                                                                                                                                                                                                                                    * Switch devices
                                                                                                                                                                                                                                                                                                                                                                                    * Hot‑swap controllers
                                                                                                                                                                                                                                                                                                                                                                                    * Join/leave local sessions dynamically (e.g., title screen Arcade Mode)
22.5 Deterministic Input Buffer
All inputs flow into a predictive, frame‑indexed buffer with:
                                                                                                                                                                                                                                                                                                                                                                                    * Press/Hold/Release
                                                                                                                                                                                                                                                                                                                                                                                    * Double‑tap
                                                                                                                                                                                                                                                                                                                                                                                    * Long‑press
                                                                                                                                                                                                                                                                                                                                                                                    * Direction + action combos (e.g., down + attack)
The FSM consumes this buffer. This ensures input reads always yield clean signals.
22.6 Context Layers
Exploration Layer
Movement, jump, interact, basic attack.
Combat Layer
Full combat moveset unlocked, combat actions override exploration actions.
Menu Layer
Disables gameplay actions; enables UI navigation.
Gadget Layer
Changes the meaning of certain actions (e.g., aiming, scanning, tuning).
Anomaly Layer
Special rules for time loops, puzzles, rift interactions.
The system swaps layers automatically based on FSM & current scene.
22.7 Rebinding System
                                                                                                                                                                                                                                                                                                                                                                                    * Uses Godot InputMap under the hood
                                                                                                                                                                                                                                                                                                                                                                                    * Wraps it in a custom tool allowing:
                                                                                                                                                                                                                                                                                                                                                                                    * Per‑player bindings
                                                                                                                                                                                                                                                                                                                                                                                    * Multi‑device binding
                                                                                                                                                                                                                                                                                                                                                                                    * Binding conflicts detection
                                                                                                                                                                                                                                                                                                                                                                                    * Unsafe action warnings (e.g., unassigned Jump)
Bindings are saved in the player profile.
22.8 Multi‑Player Considerations
                                                                                                                                                                                                                                                                                                                                                                                    * Each player receives a color code and UI identifier
                                                                                                                                                                                                                                                                                                                                                                                    * Input conflicts resolved by unique device IDs
                                                                                                                                                                                                                                                                                                                                                                                    * Split‑screen camera rules handled separately
                                                                                                                                                                                                                                                                                                                                                                                    * Action mapping rules shared across all players
Local co‑op modes (Arcade, VS, Ninja Sports) require per‑player active action sets.
22.9 Input Simulation & Scripting Hooks
Useful for:
                                                                                                                                                                                                                                                                                                                                                                                    * AI agents
                                                                                                                                                                                                                                                                                                                                                                                    * Training dummies
                                                                                                                                                                                                                                                                                                                                                                                    * Automated tests
                                                                                                                                                                                                                                                                                                                                                                                    * Cutscenes
FSM‑safe simulated inputs include:
                                                                                                                                                                                                                                                                                                                                                                                    * Simulate_Press(action)
                                                                                                                                                                                                                                                                                                                                                                                    * Simulate_Hold(action, duration)
                                                                                                                                                                                                                                                                                                                                                                                    * Simulate_Release(action)
These feed the same buffer as players.
22.10 Replay & Ghost Support (Optional)
The buffer makes it trivial to save:
                                                                                                                                                                                                                                                                                                                                                                                    * Inputs per frame
                                                                                                                                                                                                                                                                                                                                                                                    * With deterministic playback
This allows later implementation of:
                                                                                                                                                                                                                                                                                                                                                                                    * Time trial ghosts
                                                                                                                                                                                                                                                                                                                                                                                    * Training mode rewinds
22.11 Accessibility Hooks
                                                                                                                                                                                                                                                                                                                                                                                    * Toggle hold vs. press
                                                                                                                                                                                                                                                                                                                                                                                    * Alternate control presets
                                                                                                                                                                                                                                                                                                                                                                                    * Deadzone adjustments
                                                                                                                                                                                                                                                                                                                                                                                    * Auto‑run (optional)
                                                                                                                                                                                                                                                                                                                                                                                    * One‑handed mode (long‑term stretch)
22.12 Integration Points
                                                                                                                                                                                                                                                                                                                                                                                    * FSM System: consumes buffered actions
                                                                                                                                                                                                                                                                                                                                                                                    * Combat System: combo trees & timing windows
                                                                                                                                                                                                                                                                                                                                                                                    * Movement System: jump, dash, walls, edge cases
                                                                                                                                                                                                                                                                                                                                                                                    * UI System: menu navigation
                                                                                                                                                                                                                                                                                                                                                                                    * Gadgets System: action remapping for devices
                                                                                                                                                                                                                                                                                                                                                                                    * Multiplayer: per‑player routing
                                                                                                                                                                                                                                                                                                                                                                                    * Audio System: menu navigations & confirmations




________________


23. Testing & Quality Assurance
23.1 Purpose & Scope
Testing ensures that all gameplay systems, tools, scripts, and content behave as intended and remain stable as the project evolves. QA is integrated into development from the earliest prototype phases and supports both human testers and automated AI-driven testing.
23.2 Testing Categories
23.2.1 Unit Testing
                                                                                                                                                                                                                                                                                                                                                                                    * Covers core engine modules (FSM, Actor System, Stats, Combat Modules, etc.)
                                                                                                                                                                                                                                                                                                                                                                                    * Automated tests validate expected outputs and state transitions.
23.2.2 Integration Testing
                                                                                                                                                                                                                                                                                                                                                                                    * Ensures multi-system features (e.g., Anomalies + Gadgets + Dialogue Triggers) work together.
                                                                                                                                                                                                                                                                                                                                                                                    * Validates that changes in one module do not break others.
23.2.3 System Testing
                                                                                                                                                                                                                                                                                                                                                                                    * Full gameplay loops such as Combat → Loot → Rest → Level Up.
                                                                                                                                                                                                                                                                                                                                                                                    * Progression, world state changes, and anomaly resolutions.
23.2.4 Performance Testing
                                                                                                                                                                                                                                                                                                                                                                                    * Stress tests for actors, particles, sounds, and gadgets.
                                                                                                                                                                                                                                                                                                                                                                                    * Ensures the game runs within target hardware constraints.
23.2.5 Regression Testing
                                                                                                                                                                                                                                                                                                                                                                                    * Scheduled after every major change.
                                                                                                                                                                                                                                                                                                                                                                                    * Automated CI-like workflow (local/manual if CI not yet available).
23.2.6 User Testing
                                                                                                                                                                                                                                                                                                                                                                                    * Internal playtesting cycles within Retraissance.
                                                                                                                                                                                                                                                                                                                                                                                    * External closed groups for diverse hardware feedback.
________________
23.3 Tools & Methodology
Logging
                                                                                                                                                                                                                                                                                                                                                                                    * Unified logging framework at engine level.
                                                                                                                                                                                                                                                                                                                                                                                    * Supports categorized logs: ERROR, WARN, INFO, DEBUG, STATE.
Automated Testing Support
                                                                                                                                                                                                                                                                                                                                                                                    * AI-assisted scripts simulate inputs, stress combat, pathfinding, and gadget activation.
Bug Tracking Workflow
                                                                                                                                                                                                                                                                                                                                                                                    * Lightweight internal tracker (e.g., Notion, Trello, or custom).
                                                                                                                                                                                                                                                                                                                                                                                    * Categorization:
                                                                                                                                                                                                                                                                                                                                                                                    * Critical: Blocks gameplay or crashes.
                                                                                                                                                                                                                                                                                                                                                                                    * High: Breaks systems or progression.
                                                                                                                                                                                                                                                                                                                                                                                    * Medium: Noticeable but not blocking.
                                                                                                                                                                                                                                                                                                                                                                                    * Low: Cosmetic or minor inconsistencies.
23.4 QA Philosophy
                                                                                                                                                                                                                                                                                                                                                                                    * Test early, test often.
                                                                                                                                                                                                                                                                                                                                                                                    * Transparency between QA and engineering.
                                                                                                                                                                                                                                                                                                                                                                                    * Every bug has an owner.
                                                                                                                                                                                                                                                                                                                                                                                    * Minimal friction: fixes are small, incremental, and documented.
23.5 Output & Reporting
                                                                                                                                                                                                                                                                                                                                                                                    * Builds must include a changelog and known issues list.
                                                                                                                                                                                                                                                                                                                                                                                    * Weekly QA summary for internal team.
                                                                                                                                                                                                                                                                                                                                                                                    * Metrics tracked: crash frequency, stability score, systemic error reports.


________________


24 — Accessibility Support
24.1 Overview
The goal is to ensure that as many players as possible — regardless of physical, sensory, or cognitive differences — can enjoy and interact with the game at full depth. Accessibility is implemented as a modular, system‑level layer of the engine, integrated early into the architecture rather than added late.
This section outlines foundational accessibility features that the engine should ideally support. Adding this might significantly increase production time! TBD![c]
________________


24.2 Accessibility Philosophy
                                                                                                                                                                                                                                                                                                                                                                                    * Player Agency: The player decides how they want to experience the game.
                                                                                                                                                                                                                                                                                                                                                                                    * Modularity: Every accessibility feature is implemented as a toggleable or configurable module.
                                                                                                                                                                                                                                                                                                                                                                                    * Non‑Intrusiveness: Accessibility settings never reduce the intended artistic, narrative, or gameplay experience unless the player explicitly requests it.
                                                                                                                                                                                                                                                                                                                                                                                    * Consistency: All systems follow the same rules — HUD, audio, UI, gameplay, and input layers.
________________


24.3 Categories of Accessibility
24.3.1 Visual Accessibility
                                                                                                                                                                                                                                                                                                                                                                                    * Colorblind Modes: Protanopia, Deuteranopia, Tritanopia filters.
                                                                                                                                                                                                                                                                                                                                                                                    * High‑Contrast UI & HUD Modes for key elements.
                                                                                                                                                                                                                                                                                                                                                                                    * Adjustable Font Sizes for menus, subtitles, dialogue boxes.
                                                                                                                                                                                                                                                                                                                                                                                    * Icon‑focused UI Option: Replaces text with symbolic UI where applicable.
                                                                                                                                                                                                                                                                                                                                                                                    * Reduced FX Mode: Limits camera shake, bloom, flashes, chromatic aberration.
                                                                                                                                                                                                                                                                                                                                                                                    * Silhouette Mode (Optional): Some actors  emphasized with clearer outlines.
24.3.2 Auditory Accessibility
                                                                                                                                                                                                                                                                                                                                                                                    * Subtitle Support: For dialogue, important ambient cues, and story events.
                                                                                                                                                                                                                                                                                                                                                                                    * Closed Captioning: Identifies sound types ("[Rustling]", "[Enemy charging]").
                                                                                                                                                                                                                                                                                                                                                                                    * Sound Cue Visualizers: Small UI indicators for directional sound cues.
                                                                                                                                                                                                                                                                                                                                                                                    * Adjustable Dynamic Range: Night mode, boosted voice mode.
                                                                                                                                                                                                                                                                                                                                                                                    * Haptic Feedback Substitution: Optional vibration for important sound events.
24.3.3 Motor Accessibility
                                                                                                                                                                                                                                                                                                                                                                                    * Customizable Controls: Remapping for all actions.
                                                                                                                                                                                                                                                                                                                                                                                    * Input Buffering Options: Adjustable leniency for combos & dodges.
                                                                                                                                                                                                                                                                                                                                                                                    * Hold‑to‑Press Conversion: Any hold action can become a toggle.
                                                                                                                                                                                                                                                                                                                                                                                    * Slow‑Motion Assist (Optional): Temporarily slows time during precision input
                                                                                                                                                                                                                                                                                                                                                                                    * Auto‑Platforming Assist (Optional): Soft correction toward ledges in critical jumps.
24.3.4 Cognitive / Processing Accessibility
                                                                                                                                                                                                                                                                                                                                                                                    * Simplified Navigation Mode: Clearer visual hints for objectives.
                                                                                                                                                                                                                                                                                                                                                                                    * Puzzle Timing Extensions: Longer timers on time‑limited environmental puzzles.
                                                                                                                                                                                                                                                                                                                                                                                    * Reduced Complexity Mode: Limits multi‑step tasks (without removing puzzles).
                                                                                                                                                                                                                                                                                                                                                                                    * Enhanced Interactable Highlighting: Important objects clearly indicated.
                                                                                                                                                                                                                                                                                                                                                                                    * Lore Summary Assist: Optional digestible summaries for complex lore segments.
________________


24.4 UI & UX Accessibility
                                                                                                                                                                                                                                                                                                                                                                                    * All menus fully navigable via keyboard, controller, and mouse.
                                                                                                                                                                                                                                                                                                                                                                                    * UI must scale dynamically to all resolutions (including ultra‑wide and 4:3).
                                                                                                                                                                                                                                                                                                                                                                                    * Focus states must be visually distinct in menu navigation.
                                                                                                                                                                                                                                                                                                                                                                                    * Menu transitions must never lock players into animations.
                                                                                                                                                                                                                                                                                                                                                                                    * Tutorial prompts adapt to controller type in real time.
________________


24.5 Gameplay Accessibility Layers
Accessibility interacts with gameplay through modular assist layers:
24.5.1 Combat Assist Layer
                                                                                                                                                                                                                                                                                                                                                                                    * Auto‑targeting toggle.
                                                                                                                                                                                                                                                                                                                                                                                    * Dodge‑assist timing window extension.
                                                                                                                                                                                                                                                                                                                                                                                    * Enemy outline visibility.
                                                                                                                                                                                                                                                                                                                                                                                    * Reduced enemy aggression setting.
24.5.2 Platforming Assist Layer
                                                                                                                                                                                                                                                                                                                                                                                    * Coyote‑time extender.
                                                                                                                                                                                                                                                                                                                                                                                    * Jump forgiveness buffer.
                                                                                                                                                                                                                                                                                                                                                                                    * Optional auto‑climb for low ledges.
________________
24.5.3 Stealth Assist Layer
                                                                                                                                                                                                                                                                                                                                                                                    * Detection range scaling.
                                                                                                                                                                                                                                                                                                                                                                                    * On‑screen preview of enemy hearing/vision cones.
                                                                                                                                                                                                                                                                                                                                                                                    * Automatic noise‑level visualization.
These assists do not activate unless explicitly chosen.
________________


24.6 Accessibility Profiles
Players can save multiple accessibility profiles:
                                                                                                                                                                                                                                                                                                                                                                                    * "Combat Assist"
                                                                                                                                                                                                                                                                                                                                                                                    * "Exploration Mode"
                                                                                                                                                                                                                                                                                                                                                                                    * "Cinematic Experience"
                                                                                                                                                                                                                                                                                                                                                                                    * Custom profiles
Profiles can be exported and imported (useful for sharing recommended settings or online community presets).
________________


24.7 Development Requirements
                                                                                                                                                                                                                                                                                                                                                                                    * All accessibility features must be integrated early, not added after core gameplay.
                                                                                                                                                                                                                                                                                                                                                                                    * QA must test all features with the same priority as gameplay systems.
                                                                                                                                                                                                                                                                                                                                                                                    * Every update must be validated against accessibility requirements.
________________


24.8 Future Expansion
Additional systems may be implemented:
                                                                                                                                                                                                                                                                                                                                                                                    * Sign‑language avatar for major cutscenes.
                                                                                                                                                                                                                                                                                                                                                                                    * Haptic environmental mapping.
                                                                                                                                                                                                                                                                                                                                                                                    * Advanced color re‑theming for full visual remapping.


________________


25. Localization Support
25.1 Overview
Localization in Densetsu is designed as a first-class, engine-level subsystem, not an afterthought. Because the game features dense lore, cultural terminology, dynamic dialogue, contextual UI, and time‑based systems, localization must be:
                                                                                                                                                                                                                                                                                                                                                                                    * Modular (fully isolated from game logic),
                                                                                                                                                                                                                                                                                                                                                                                    * Data‑driven (built on structured files),
                                                                                                                                                                                                                                                                                                                                                                                    * Runtime‑flexible (switchable without reboot), and
                                                                                                                                                                                                                                                                                                                                                                                    * Extensible (easy to add new languages or dialects).
The system must support not only translation but also regional formatting, cultural adaptation, and UI scaling changes for different languages.
________________


25.2 Localization Philosophy
                                                                                                                                                                                                                                                                                                                                                                                    * Accuracy over literal translation: Respect tone, cultural nuance, and narrative rhythm.
                                                                                                                                                                                                                                                                                                                                                                                    * Lore Consistency: Core terms (e.g., Suhada, Mycomind, Okashira) follow a glossary.
                                                                                                                                                                                                                                                                                                                                                                                    * Technical Separation: No text hardcoded into scripts; all pulled from localization assets.
                                                                                                                                                                                                                                                                                                                                                                                    * Flexible UI: Layout adapts to languages with longer or shorter text.
                                                                                                                                                                                                                                                                                                                                                                                    * Accessibility Integration: Works seamlessly with font scaling, dyslexia‑friendly fonts, high‑contrast mode.
________________


25.3 Supported Content Types
The localization layer must cover:
                                                                                                                                                                                                                                                                                                                                                                                    * UI text: menus, labels, tooltips, HUD text.
                                                                                                                                                                                                                                                                                                                                                                                    * Dialogue: main script, optional dialogue, branching choices.
                                                                                                                                                                                                                                                                                                                                                                                    * Item & Gadget descriptions.
                                                                                                                                                                                                                                                                                                                                                                                    * Quest text: objectives, hints, conditions.
                                                                                                                                                                                                                                                                                                                                                                                    * System text: notifications, error messages.
                                                                                                                                                                                                                                                                                                                                                                                    * Audio subtitles & captions.
                                                                                                                                                                                                                                                                                                                                                                                    * Lore Archives / Infinipedia entries.
                                                                                                                                                                                                                                                                                                                                                                                    * Titles & Achievements.
                                                                                                                                                                                                                                                                                                                                                                                    * Minigame instructions.
Everything text‑based must route through localization.
25.4 Technical Structure
25.4.1 File Format
Localization data stored as:
                                                                                                                                                                                                                                                                                                                                                                                    * CSV, JSON, or Godot Resource files (.tres / .res)
                                                                                                                                                                                                                                                                                                                                                                                    * Optional: external .po files for third‑party translation tools
25.4.2 Key‑Value System
Every string has a stable unique key. Example:
                                                                                                                                                                                                                                                                                                                                                                                    * ui.start_game
                                                                                                                                                                                                                                                                                                                                                                                    * quest.hirogawa.missing_miners.step_1
                                                                                                                                                                                                                                                                                                                                                                                    * dialogue.sage.reveal_truth_01
                                                                                                                                                                                                                                                                                                                                                                                    * lore.varthum.loop_explanation
Keys NEVER change once published.
________________


25.5 Runtime Localization Flow
                                                                                                                                                                                                                                                                                                                                                                                    1. Language selected at startup or via menu.
                                                                                                                                                                                                                                                                                                                                                                                    2. Engine loads language pack into memory.
                                                                                                                                                                                                                                                                                                                                                                                    3. All UI & dynamic elements pull from localized strings.
                                                                                                                                                                                                                                                                                                                                                                                    4. UI reflows for text width, font changes, or spacing adjustments.
                                                                                                                                                                                                                                                                                                                                                                                    5. Switching languages triggers a soft reload of active UI nodes.
System must support hot‑swapping language at any point.
________________


25.6 Fonts & Script Support
Requirements:
                                                                                                                                                                                                                                                                                                                                                                                    * Unicode font files for multilingual support.
                                                                                                                                                                                                                                                                                                                                                                                    * Special fallback fonts for:
                                                                                                                                                                                                                                                                                                                                                                                    * CJK scripts
                                                                                                                                                                                                                                                                                                                                                                                    * Cyrillic
                                                                                                                                                                                                                                                                                                                                                                                    * Accented Latin
                                                                                                                                                                                                                                                                                                                                                                                    * Dyslexia‑friendly font option
                                                                                                                                                                                                                                                                                                                                                                                    * Dynamically scalable font sizes
Localization layer must allow font override per language.
Example: Japanese UI uses a different UI font than English.
25.7 Layout Adaptation
Localization must trigger:
                                                                                                                                                                                                                                                                                                                                                                                    * Automatic text resizing rules.
                                                                                                                                                                                                                                                                                                                                                                                    * Smart line‑breaking.
                                                                                                                                                                                                                                                                                                                                                                                    * Text box size expansion (when possible).
                                                                                                                                                                                                                                                                                                                                                                                    * Auto‑scrolling text for extremely long passages.
                                                                                                                                                                                                                                                                                                                                                                                    * Fallback rules for narrow UI spaces.
UI must remain readable at all times.
________________


25.8 Cultural Adaptation
Some content may need region‑specific variations:
                                                                                                                                                                                                                                                                                                                                                                                    * Tutorials for different control conventions.
                                                                                                                                                                                                                                                                                                                                                                                    * Terms that must be localized (e.g., Suhada may remain untranslated or be footnoted).
                                                                                                                                                                                                                                                                                                                                                                                    * Pronunciation guides for invented terms.
                                                                                                                                                                                                                                                                                                                                                                                    * Potential right-to-left (RTL) support.
Lore‑heavy content such as Infinipedia entries must include notes for translators.
________________


25.9 Tools & Workflow
Localization Editor
A simple internal tool or Godot plugin that:
                                                                                                                                                                                                                                                                                                                                                                                    * Displays all keys
                                                                                                                                                                                                                                                                                                                                                                                    * Shows missing translations
                                                                                                                                                                                                                                                                                                                                                                                    * Previews UI placement with sample text
                                                                                                                                                                                                                                                                                                                                                                                    * Flags overflow issues
External Workflow
Supports:
                                                                                                                                                                                                                                                                                                                                                                                    * CSV export/import
                                                                                                                                                                                                                                                                                                                                                                                    * Connection to translation platforms (optional)
________________
Validation
Engine must warn the developer if:
                                                                                                                                                                                                                                                                                                                                                                                    * A key is missing in the selected language
                                                                                                                                                                                                                                                                                                                                                                                    * A UI element cannot render the text properly
                                                                                                                                                                                                                                                                                                                                                                                    * Formatting tags are invalid
________________


25.10 Integration With Other Systems
Localization interacts with:
                                                                                                                                                                                                                                                                                                                                                                                    * Dialogue & Quest System: Branch text based on player choices.
                                                                                                                                                                                                                                                                                                                                                                                    * HUD & Inventory: Dynamic labels.
                                                                                                                                                                                                                                                                                                                                                                                    * Cutscenes: Subtitles and captioning.
                                                                                                                                                                                                                                                                                                                                                                                    * Infinipedia: Structured multi‑section entries.
                                                                                                                                                                                                                                                                                                                                                                                    * Multiplayer: Display player names & prompts.
                                                                                                                                                                                                                                                                                                                                                                                    * Accessibility: Font overrides, caption settings.
All systems must expose a simple loc_key property.
________________


25.11 Future Expansion
Potential advanced features:
                                                                                                                                                                                                                                                                                                                                                                                    * Auto‑lip‑sync support for fully voiced scenes.
                                                                                                                                                                                                                                                                                                                                                                                    * Region‑specific content filtering.
                                                                                                                                                                                                                                                                                                                                                                                    * Dynamic grammar rules (pluralization, gendered languages).
                                                                                                                                                                                                                                                                                                                                                                                    * AI‑assisted early translation drafts (never final).
________________


25.12 Summary
Localization is a modular but essential part of the engine. It underpins dialogue, UI, lore, subtitles, and tutorials. The system is fully data‑driven, easily expandable, and deeply integrated with accessibility and gameplay systems.
This guarantees Densetsu can scale to a global audience without sacrificing quality or narrative integrity.


________________


26. Performance & Optimization Strategy
26.1 Overview
Performance is a foundational requirement of the Densetsu Engine. Because the project must run on a wide range of hardware — from low-spec PCs to modern devices — optimization is not an afterthought but a design pillar. Every system (actors, FSM, audio, rendering, UI, physics) must be built with efficiency, scalability, and predictability.
Performance strategy is holistic, modular, and measurable, relying on profiling data and strict coding standards.
________________


26.2 Optimization Philosophy
                                                                                                                                                                                                                                                                                                                                                                                    * Performance by Design: Systems must be efficient from the start.
                                                                                                                                                                                                                                                                                                                                                                                    * Predictable Cost: Every subsystem clearly defines worst-case computational cost.
                                                                                                                                                                                                                                                                                                                                                                                    * Data-Driven Decisions: Profiling informs optimization priorities.
                                                                                                                                                                                                                                                                                                                                                                                    * Graceful Degradation: Under high load, systems scale back non-essential features.
                                                                                                                                                                                                                                                                                                                                                                                    * Modularity: Improvements can target modules without affecting stability.
________________


26.3 Target Platforms & Baselines
26.3.1 Minimum Target
                                                                                                                                                                                                                                                                                                                                                                                    * Low-spec PC laptops with integrated graphics
                                                                                                                                                                                                                                                                                                                                                                                    * Stable 60 FPS at native resolution (scaling allowed)
26.3.2 Preferred Target
                                                                                                                                                                                                                                                                                                                                                                                    * Mid-range PCs
                                                                                                                                                                                                                                                                                                                                                                                    * Stable 120 FPS possible with optimization settings
26.3.3 Feature Scaling
Systems must support:
                                                                                                                                                                                                                                                                                                                                                                                    * Resolution scaling
                                                                                                                                                                                                                                                                                                                                                                                    * Particle/FX reduction
                                                                                                                                                                                                                                                                                                                                                                                    * Actor population caps
                                                                                                                                                                                                                                                                                                                                                                                    * Simplified lighting mode
                                                                                                                                                                                                                                                                                                                                                                                    * Reduced audio reverb & convolution
26.4 Core Optimization Strategies
26.4.1 Actor Lifecycle Cost Management
                                                                                                                                                                                                                                                                                                                                                                                    * Pooling for Actors, Projectiles, FX
                                                                                                                                                                                                                                                                                                                                                                                    * Strict Active/Semi-Active/Passive actor tiers
                                                                                                                                                                                                                                                                                                                                                                                    * Idle AI throttling
                                                                                                                                                                                                                                                                                                                                                                                    * Event-driven AI where possible instead of per-frame polling
                                                                                                                                                                                                                                                                                                                                                                                    * Hitbox and physics activation only when necessary
26.4.2 FSM Optimization
                                                                                                                                                                                                                                                                                                                                                                                    * Restrict heavy logic to enter or exit calls
                                                                                                                                                                                                                                                                                                                                                                                    * Lightweight per-frame updates
                                                                                                                                                                                                                                                                                                                                                                                    * Cached references for frequently accessed nodes
26.4.3 Rendering Optimization
                                                                                                                                                                                                                                                                                                                                                                                    * Static batching for unchanging background assets
                                                                                                                                                                                                                                                                                                                                                                                    * Tilemap optimization through chunking
                                                                                                                                                                                                                                                                                                                                                                                    * Texture atlasing and shared materials
                                                                                                                                                                                                                                                                                                                                                                                    * Avoid multi-pass shaders on mid-end hardware
26.4.4 Physics Optimization
                                                                                                                                                                                                                                                                                                                                                                                    * Layer-based collision filtering
                                                                                                                                                                                                                                                                                                                                                                                    * Reduced raycasts where possible
                                                                                                                                                                                                                                                                                                                                                                                    * Predictive raycast reuse (cache results for X frames)
                                                                                                                                                                                                                                                                                                                                                                                    * Simplified collision shapes for non-critical elements
26.4.5 Audio Optimization
                                                                                                                                                                                                                                                                                                                                                                                    * Limit simultaneous sound instances
                                                                                                                                                                                                                                                                                                                                                                                    * Pool audio players
                                                                                                                                                                                                                                                                                                                                                                                    * Disable audio processing outside camera range
26.4.6 UI Optimization
                                                                                                                                                                                                                                                                                                                                                                                    * Avoid heavy redraws per frame
                                                                                                                                                                                                                                                                                                                                                                                    * Use visible toggles instead of re-instancing
                                                                                                                                                                                                                                                                                                                                                                                    * Cache text rendering when possible
________________


________________
26.5 Memory Management
Goals:
                                                                                                                                                                                                                                                                                                                                                                                    * Stable runtime memory use
                                                                                                                                                                                                                                                                                                                                                                                    * Zero memory leaks
                                                                                                                                                                                                                                                                                                                                                                                    * Tight control of dynamic allocations
Techniques:
                                                                                                                                                                                                                                                                                                                                                                                    * Object pools for frequently used nodes
                                                                                                                                                                                                                                                                                                                                                                                    * Reuse large textures across regions where possible
                                                                                                                                                                                                                                                                                                                                                                                    * Avoid loading entire regions into memory at once
                                                                                                                                                                                                                                                                                                                                                                                    * Use stream loading for large levels
________________


26.6 Streaming & World Loading
Region Streaming
Levels should load/unload in chunks:
                                                                                                                                                                                                                                                                                                                                                                                    * Preload upcoming scenes during traversal
                                                                                                                                                                                                                                                                                                                                                                                    * Post-unload inactive regions
                                                                                                                                                                                                                                                                                                                                                                                    * Use low-cost proxies for far backgrounds
Asset Streaming
                                                                                                                                                                                                                                                                                                                                                                                    * Music crossfades must not block disk
                                                                                                                                                                                                                                                                                                                                                                                    * Large spritesheets streamed progressively
                                                                                                                                                                                                                                                                                                                                                                                    * Async load for NPC dialogue audio or extended animations
________________


________________
26.7 Profiling & Diagnostic Tools
Required Tools
                                                                                                                                                                                                                                                                                                                                                                                    * Built-in FPS and frametime overlay
                                                                                                                                                                                                                                                                                                                                                                                    * CPU time breakdown per system (actors, FSM, rendering, physics)
                                                                                                                                                                                                                                                                                                                                                                                    * Memory usage graph
                                                                                                                                                                                                                                                                                                                                                                                    * Node count tracking
                                                                                                                                                                                                                                                                                                                                                                                    * Audio instance tracking
Runtime Debug Options
                                                                                                                                                                                                                                                                                                                                                                                    * Highlight expensive nodes
                                                                                                                                                                                                                                                                                                                                                                                    * Visualize collision shapes
                                                                                                                                                                                                                                                                                                                                                                                    * Show actor activity tiers
                                                                                                                                                                                                                                                                                                                                                                                    * Show streaming status (loaded/unloaded regions)
________________


26.8 Graceful Degradation System
When performance dips:
                                                                                                                                                                                                                                                                                                                                                                                    1. Reduce particle density
                                                                                                                                                                                                                                                                                                                                                                                    2. Simplify shaders
                                                                                                                                                                                                                                                                                                                                                                                    3. Lower streaming resolution of textures
                                                                                                                                                                                                                                                                                                                                                                                    4. Reduce enemy AI update frequency
                                                                                                                                                                                                                                                                                                                                                                                    5. Disable non-critical FX (ambient particles, foliage motion)
This system is toggleable and adjustable via player options.
________________


26.9 Build-Time Optimization
                                                                                                                                                                                                                                                                                                                                                                                    * Texture compression (ASTC/BCn)
                                                                                                                                                                                                                                                                                                                                                                                    * Lossless audio compression for SFX, Ogg for music
                                                                                                                                                                                                                                                                                                                                                                                    * Pre-baking of collision layers
                                                                                                                                                                                                                                                                                                                                                                                    * Pre-baking of navigation meshes
________________


________________
26.10 Coding Standards for Performance
                                                                                                                                                                                                                                                                                                                                                                                    * No per-frame allocations
                                                                                                                                                                                                                                                                                                                                                                                    * Avoid deep scene hierarchies
                                                                                                                                                                                                                                                                                                                                                                                    * Minimize signal spam
                                                                                                                                                                                                                                                                                                                                                                                    * Use lightweight data structures
                                                                                                                                                                                                                                                                                                                                                                                    * Cache everything accessed frequently
All developers must follow the standards to ensure consistent performance.
________________


26.11 Future Expansion
If resources allow:
                                                                                                                                                                                                                                                                                                                                                                                    * GPU-accelerated particle systems
                                                                                                                                                                                                                                                                                                                                                                                    * Multithreaded AI batches
                                                                                                                                                                                                                                                                                                                                                                                    * Advanced occlusion culling
                                                                                                                                                                                                                                                                                                                                                                                    * Procedural mip generation
________________


26.12 Summary
The performance strategy ensures Densetsu runs smoothly on a variety of hardware. Through modular design, object pooling, runtime profiling, and clear coding standards, the game maintains stability, efficiency, and responsiveness across all gameplay scenarios.
________________


27 – Level & Region Architecture
Purpose & Scope
This section defines how Densetsu structures, composes, streams, and manages its world at the level of regions, rooms, and scene chunks. It covers scene organization, streaming strategy, region metadata, encounter placement rules, anomaly integration, and editor workflows that enable designers to build large, interconnected Metroidvania-style worlds while maintaining performance and narrative consistency.
The goal is to provide a single authoritative specification that designers, level builders, engineers, and AI tools can use to create, validate, and iterate playable regions at scale.
________________


1. Core Concepts
1.1 Region vs Scene vs Chunk
                                                                                                                                                                                                                                                                                                                                                                                    * Region: The largest logical area (e.g., Hirogawa, Galport, Varthum). Regions contain multiple scenes, have distinct world-phase rules, music, and political/contextual lore.
                                                                                                                                                                                                                                                                                                                                                                                    * Scene: A playable map area or room (e.g., waterfall path, mine entrance, village plaza). Scenes are the primary design unit; each is streamed or loaded individually.
                                                                                                                                                                                                                                                                                                                                                                                    * Chunk: Smaller subscene pieces that can be streamed in/out inside a scene for optimization (background layers, tall structures, off-screen NPC clusters).
1.2 Hub vs Linear vs Open Regions
                                                                                                                                                                                                                                                                                                                                                                                    * Hubs: Central nodes connecting many exits (Infinitree, Boalis). Hubs host services, vendors, and persistent NPC states.
                                                                                                                                                                                                                                                                                                                                                                                    * Linear Regions: Shorter, directed sequences supporting story beats (e.g., story arc leading to a town fire). These may use simpler streaming.
                                                                                                                                                                                                                                                                                                                                                                                    * Open Regions: Dense exploration zones with multiple vertical layers and branching paths requiring heavier streaming and LOD control.
1.3 Portals & Exits
Portals are explicit connectors between scenes: doors, caves, bridges, rifts. Each portal stores metadata: destination scene id, entry point id, transition type (fade, door animation, cutscene), and conditions (locked, quest-dependent).
________________


________________
2. Scene Composition & Layout Rules
2.1 Grid & Modular Tiles
                                                                                                                                                                                                                                                                                                                                                                                    * Use a tile-based grid for floor/terrain layout for consistency, but allow free-placed objects for set-pieces.
                                                                                                                                                                                                                                                                                                                                                                                    * Tilemaps define collision and material types (wood, stone, water) used by physics, audio, and VFX systems.
2.2 Navigation & Connectivity
                                                                                                                                                                                                                                                                                                                                                                                    * Every scene must have at least one portal to another scene or hub to avoid dead-ends unless intentionally isolated for narrative.
                                                                                                                                                                                                                                                                                                                                                                                    * Designers should annotate flow priority: main path vs optional path vs secret.
                                                                                                                                                                                                                                                                                                                                                                                    * Maintain a graph of scenes per region for automated pathfinding and fast-travel considerations.
2.3 Verticality & Layering
                                                                                                                                                                                                                                                                                                                                                                                    * Scenes should define layering sections (foreground, action plane, background) to control parallax, occlusion, and focus.
                                                                                                                                                                                                                                                                                                                                                                                    * Action plane is where actors interact; background layers are decorative or low-frequency interactivity.
2.4 Encounter Zones & Spawn Points
                                                                                                                                                                                                                                                                                                                                                                                    * Place encounter zones with: spawn points, max active enemies, respawn policy, and difficulty scaling parameters.
                                                                                                                                                                                                                                                                                                                                                                                    * Distinguish "ambient spawns" (creatures, peaceful) from "combat encounters" (tied to progression).
                                                                                                                                                                                                                                                                                                                                                                                    * Define patrol paths as data (waypoints) and annotate with conditions (time of day, phase).
2.5 Environmental Hazards & Triggers
                                                                                                                                                                                                                                                                                                                                                                                    * Hazards (collapsing platforms, spikes, timed traps) are templated with activation conditions and reset rules.
                                                                                                                                                                                                                                                                                                                                                                                    * Triggers link to EventDirector for scripted set-pieces or anomaly responses.
________________


________________
3. Streaming & Loading Strategy
3.1 Streaming Granularity
                                                                                                                                                                                                                                                                                                                                                                                    * Scenes are the primary streaming unit; chunks allow intra-scene streaming for dense areas.
                                                                                                                                                                                                                                                                                                                                                                                    * Load radius: a configurable radius determines when neighboring scenes/chunks are streamed.
3.2 Loading Modes
                                                                                                                                                                                                                                                                                                                                                                                    * Seamless Streaming: Transition without loading screen (camera pans across a portal while next scene streams). Requires prefetching.
                                                                                                                                                                                                                                                                                                                                                                                    * Screen Transition: Fade or animation while next scene loads (use for heavy set pieces).
                                                                                                                                                                                                                                                                                                                                                                                    * Cutscene Transition: Use EventDirector to orchestrate camera and state while loading.
3.3 Prefetching & Hints
                                                                                                                                                                                                                                                                                                                                                                                    * Designers can mark portals with prefetch priorities to load destination assets early.
                                                                                                                                                                                                                                                                                                                                                                                    * Prefetch budgets limit how many scenes to load ahead to save memory.
3.4 Memory Management
                                                                                                                                                                                                                                                                                                                                                                                    * Unload distant scenes and chunks, preserving minimal placeholders for persistence (persistent actor states, flags).
                                                                                                                                                                                                                                                                                                                                                                                    * Pool commonly used objects (props, enemies) to avoid allocations.
________________


4. Region Metadata & Configuration
Each Region contains a manifest (RegionMeta) used at runtime for configuration and tools:
                                                                                                                                                                                                                                                                                                                                                                                    * region_id
                                                                                                                                                                                                                                                                                                                                                                                    * display_name
                                                                                                                                                                                                                                                                                                                                                                                    * continent
                                                                                                                                                                                                                                                                                                                                                                                    * default_world_phase
                                                                                                                                                                                                                                                                                                                                                                                    * music_bank
                                                                                                                                                                                                                                                                                                                                                                                    * default_weather
                                                                                                                                                                                                                                                                                                                                                                                    * anomaly_density (expected anomalies per km²)
                                                                                                                                                                                                                                                                                                                                                                                    * resource_nodes (bamboo, ore types)
                                                                                                                                                                                                                                                                                                                                                                                    * entry_portals (list of initial entry points)
                                                                                                                                                                                                                                                                                                                                                                                    * persistence_policy (which actors survive unload)
Region manifests allow global systems to tune behavior and UI (map icons, quest filters).
5. Anomaly & Temporal Integration
5.1 Anomaly Anchors
                                                                                                                                                                                                                                                                                                                                                                                    * Scenes can host anomaly anchors: fixed points where rifts or echoes are placed. Anchors include affinity tags (Timespace, Gaea) and difficulty scaling.
5.2 Anomaly Phasing
                                                                                                                                                                                                                                                                                                                                                                                    * Regions define how anomalies affect local world phases (visual shaders, enemy corruption levels, NPC dialogue overrides).
                                                                                                                                                                                                                                                                                                                                                                                    * Anomaly resolution updates RegionMeta flags and may unlock or alter portals.
5.3 Memory Echo Placement
                                                                                                                                                                                                                                                                                                                                                                                    * Memory echoes are placed as special markers with recorded playback sequences (Dialogue, VFX, Particle, SFX) invoked by Memory Lantern or EventDirector.
________________


6. Encounter & Content Placement Rules
6.1 Difficulty & Progression Curves
                                                                                                                                                                                                                                                                                                                                                                                    * Scenes contain a recommended_level_range used by spawn scaling and loot tables.
                                                                                                                                                                                                                                                                                                                                                                                    * Difficulty rubber-bands based on player stats, number of players in the session, and region world-phase.
6.2 Loot & Resource Distribution
                                                                                                                                                                                                                                                                                                                                                                                    * Guarantee minimal resources for player progression per region.
                                                                                                                                                                                                                                                                                                                                                                                    * Place rare resource nodes in optional/exploration paths.
6.3 Quest Anchors & NPC Placement
                                                                                                                                                                                                                                                                                                                                                                                    * Quest-giver NPCs are placed in hubs or safe zones.
                                                                                                                                                                                                                                                                                                                                                                                    * Persistent NPCs flagged as persistent_actor are re-instanced with saved state upon region load.
________________


________________
7. Visual & Audio Zoning
7.1 Audio Zones
                                                                                                                                                                                                                                                                                                                                                                                    * Scenes define ambient audio zones with priority blending (village ambience, river, shrine). These integrate with MusicManager for transitions.
7.2 Lighting & Post-Process Zones
                                                                                                                                                                                                                                                                                                                                                                                    * Scene contains local lightmaps, dynamic lights, and post-processing volumes (fog density, color grading tied to world phase).
                                                                                                                                                                                                                                                                                                                                                                                    * Temporal anomalies may swap post-process profiles.
7.3 Shader & Material Overrides
                                                                                                                                                                                                                                                                                                                                                                                    * Designers can tag areas with shader overrides for visual anomalies (heat shimmer, time fracture) that respond to Stability Index.
________________


8. Editor Tools & Workflows
8.1 Region Graph Editor
                                                                                                                                                                                                                                                                                                                                                                                    * Visual graph connecting scenes and portals. Shows flow priority, quest-lock annotations, and prefetch hints.
8.2 Scene Profiler
                                                                                                                                                                                                                                                                                                                                                                                    * Reports actor count, draw calls, audio voices, estimated memory footprint.
8.3 Encounter Validator
                                                                                                                                                                                                                                                                                                                                                                                    * Verifies spawn points, ensures balance across recommended_level_range, and flag missing respawn rules.
8.4 Anomaly Placement Tool
                                                                                                                                                                                                                                                                                                                                                                                    * Drag-and-drop anomaly anchors with immediate preview of visual/audio effects and gameplay parameters.
8.5 Automated Export
                                                                                                                                                                                                                                                                                                                                                                                    * Region manifest and scene bundles exported as versioned packages for QA and builds.
________________


9. Persistence & Save Interaction
9.1 Persistent Actor Rules
                                                                                                                                                                                                                                                                                                                                                                                    * Actors marked persistent are serialized with minimal state (position, HP, inventory refs, FSM state id) and rehydrated on load.
                                                                                                                                                                                                                                                                                                                                                                                    * Non-persistent actors are re-generated using spawn tables.
9.2 World State Flags
                                                                                                                                                                                                                                                                                                                                                                                    * Scene load reads global flags to decide variant tiles, disabled portals, or altered NPCs.
9.3 Checkpoint / Rest Point Behavior
                                                                                                                                                                                                                                                                                                                                                                                    * Rest points function as save anchors and provide region reinitialization cues (AI reset rules, respawn triggers).
________________


10. Multiplayer & Local Co-op Considerations
                                                                                                                                                                                                                                                                                                                                                                                    * Shared scenes must support multiple players active concurrently; camera & UI rules adapt accordingly.
                                                                                                                                                                                                                                                                                                                                                                                    * Spawn balancing for multiple players: increase encounter caps or scale enemy HP & damage.
                                                                                                                                                                                                                                                                                                                                                                                    * Interaction contention: shared switches have merge rules (first-actor wins or consensus by proximity).
________________


11. Performance & LOD Strategies
                                                                                                                                                                                                                                                                                                                                                                                    * Use chunked occlusion culling and object pooling.
                                                                                                                                                                                                                                                                                                                                                                                    * LOD levels for far-away decorative assets and NPCs.
                                                                                                                                                                                                                                                                                                                                                                                    * Limit dynamic lights per scene; bake static lighting where possible.
                                                                                                                                                                                                                                                                                                                                                                                    * Use simplified physics proxy shapes for non-critical background objects.
________________


12. Testing & Validation
                                                                                                                                                                                                                                                                                                                                                                                    * Automated scene walk tests to ensure all portals lead somewhere and no unreachable sections exist (unless intended).
                                                                                                                                                                                                                                                                                                                                                                                    * Stress tests to spawn max actors and measure performance thresholds per scene.
                                                                                                                                                                                                                                                                                                                                                                                    * Regression suite for region manifest changes and migration.
13. Recommended File & Naming Conventions
res://regions/<region_id>/
region_meta.json
scenes/
<scene_id>.tscn
<scene_id>_chunks/
chunk_01.tscn
audio/
vfx/
spawn_tables/
prefabs/
Scene IDs and portal IDs must be globally unique across the project.
________________


Summary
This Level & Region Architecture provides a robust, practical blueprint to create large, immersive worlds for Densetsu. It balances designer freedom with technical constraints, supports temporal anomaly integration, and ensures a predictable streaming and persistence model that keeps the game performant and narratively coherent.
________________


28 — AI System
28.1 Purpose & Scope
The AI System governs all non-player autonomous behavior in Densetsu, including enemies, creatures, NPCs, and anomaly-driven entities. It defines perception, decision-making, locomotion, combat reactions, ecological patterns, and temporal distortion responses.
The system is modular, data-driven, and tightly integrated with the Actor System, Finite State Machine (FSM), Level Architecture, Audio System, Stealth/Hearing model, and Temporal Anomaly layer.
This defines how an AI entity thinks, senses, acts, and transitions between states.
________________


28.2 Core Architecture
AI in Densetsu is structured around four pillars:
• 1. Sensing Layer — what the AI perceives
• 2. Evaluation Layer — what the AI concludes
• 3. Decision Layer — what the AI intends
• 4. Action Layer — what the AI does
These map directly into the Actor’s FSM.
________________


28.3 AI Categories
AI templates fall into distinct groups:
28.3.1 Enemies
                                                                                                                                                                                                                                                                                                                                                                                    * Purpose-driven
                                                                                                                                                                                                                                                                                                                                                                                    * Aggressive or territorial
                                                                                                                                                                                                                                                                                                                                                                                    * Use complex combat states and combos
                                                                                                                                                                                                                                                                                                                                                                                    * React strongly to anomalies and corruption
________________
28.3.2 Creatures
                                                                                                                                                                                                                                                                                                                                                                                    * Ecology-driven, instinctual
                                                                                                                                                                                                                                                                                                                                                                                    * Do not use advanced tactics
                                                                                                                                                                                                                                                                                                                                                                                    * Behavior influenced by hunger, fear, territory, anomalies
                                                                                                                                                                                                                                                                                                                                                                                    * Can be tamed, avoided, or observed
28.3.3 NPCs (Villagers, Merchants, Quest NPCs)
                                                                                                                                                                                                                                                                                                                                                                                    * Dialogue-driven
                                                                                                                                                                                                                                                                                                                                                                                    * Scripted routines (daily cycles)
                                                                                                                                                                                                                                                                                                                                                                                    * Respond to player reputation and world-phase
28.3.4 Riftspawn & Corrupted Entities
                                                                                                                                                                                                                                                                                                                                                                                    * Anomaly-dependent
                                                                                                                                                                                                                                                                                                                                                                                    * Logic partially overridden by temporal instability
                                                                                                                                                                                                                                                                                                                                                                                    * May glitch between states or react unpredictably
________________


28.4 Sensing Layer
AI senses are modular components attachable to any AI actor.
28.4.1 Vision Sensor
                                                                                                                                                                                                                                                                                                                                                                                    * 2D conical raycast fan
                                                                                                                                                                                                                                                                                                                                                                                    * Field of view configurable
                                                                                                                                                                                                                                                                                                                                                                                    * Checks obstacles using physics layers
                                                                                                                                                                                                                                                                                                                                                                                    * Detects actors, items, hazards
28.4.2 Hearing Sensor
Uses the game’s sound propagation system:
                                                                                                                                                                                                                                                                                                                                                                                    * Sound events emit a radius & obstruction mask
                                                                                                                                                                                                                                                                                                                                                                                    * Sensor detects whether AI is inside the propagation polygon
                                                                                                                                                                                                                                                                                                                                                                                    * Includes urgency threshold (ignore small sounds)
                                                                                                                                                                                                                                                                                                                                                                                    * Used heavily in stealth gameplay
28.4.3 Proximity Sensor
                                                                                                                                                                                                                                                                                                                                                                                    * Simple radius trigger
                                                                                                                                                                                                                                                                                                                                                                                    * Used for creatures and passive NPCs
________________
28.4.4 Anomaly Sensor (Special)
                                                                                                                                                                                                                                                                                                                                                                                    * Detects local instability values
                                                                                                                                                                                                                                                                                                                                                                                    * Causes corruption-triggered state changes
                                                                                                                                                                                                                                                                                                                                                                                    * Required for riftspawn
Sensing components communicate events to the Evaluation Layer.
________________


28.5 Evaluation Layer
Processes sensory input to form conclusions.
Evaluation Examples:
                                                                                                                                                                                                                                                                                                                                                                                    * "Player spotted"
                                                                                                                                                                                                                                                                                                                                                                                    * "Sound detected to the east"
                                                                                                                                                                                                                                                                                                                                                                                    * "Food source nearby"
                                                                                                                                                                                                                                                                                                                                                                                    * "Territory invaded"
                                                                                                                                                                                                                                                                                                                                                                                    * "Corruption spike: enter defensive mode"
Evaluation uses:
                                                                                                                                                                                                                                                                                                                                                                                    * Threat level algorithms
                                                                                                                                                                                                                                                                                                                                                                                    * Line-of-sight persistence windows
                                                                                                                                                                                                                                                                                                                                                                                    * Internal emotional parameters (fear, aggression)
                                                                                                                                                                                                                                                                                                                                                                                    * Anomaly Influence Modifiers
________________


________________
28.6 Decision Layer
The heart of AI behavior.
Decision logic combines:
                                                                                                                                                                                                                                                                                                                                                                                    * Current FSM state
                                                                                                                                                                                                                                                                                                                                                                                    * Recent evaluations
                                                                                                                                                                                                                                                                                                                                                                                    * AI personality & archetype
                                                                                                                                                                                                                                                                                                                                                                                    * Health, stamina, corruption
                                                                                                                                                                                                                                                                                                                                                                                    * Party size (creature packs)
                                                                                                                                                                                                                                                                                                                                                                                    * Multipliers from anomalies
Decision Output Examples:
                                                                                                                                                                                                                                                                                                                                                                                    * Chase player
                                                                                                                                                                                                                                                                                                                                                                                    * Flee to nest
                                                                                                                                                                                                                                                                                                                                                                                    * Seek ally
                                                                                                                                                                                                                                                                                                                                                                                    * Investigate sound
                                                                                                                                                                                                                                                                                                                                                                                    * Attack pattern A/B/C
                                                                                                                                                                                                                                                                                                                                                                                    * Enter corrupted frenzy
These decisions trigger FSM state changes.
________________


28.7 Action Layer (FSM Integration)
Each AI uses states such as:
                                                                                                                                                                                                                                                                                                                                                                                    * Idle
                                                                                                                                                                                                                                                                                                                                                                                    * Patrol
                                                                                                                                                                                                                                                                                                                                                                                    * Investigate
                                                                                                                                                                                                                                                                                                                                                                                    * Chase
                                                                                                                                                                                                                                                                                                                                                                                    * Attack Variant 1/2/3
                                                                                                                                                                                                                                                                                                                                                                                    * Retreat
                                                                                                                                                                                                                                                                                                                                                                                    * Call Reinforcements
                                                                                                                                                                                                                                                                                                                                                                                    * Corrupted Burst
                                                                                                                                                                                                                                                                                                                                                                                    * Flee
                                                                                                                                                                                                                                                                                                                                                                                    * Return to Home
FSM transitions are triggered by Decision Layer events.
________________


________________
28.8 Locomotion & Navigation
28.8.1 Pathfinding
                                                                                                                                                                                                                                                                                                                                                                                    * 2D navigation polygons per scene
                                                                                                                                                                                                                                                                                                                                                                                    * Local avoidance for multi-entity collisions
                                                                                                                                                                                                                                                                                                                                                                                    * Dynamic re-routing around hazards
28.8.2 Movement Styles
                                                                                                                                                                                                                                                                                                                                                                                    * Grounded walkers
                                                                                                                                                                                                                                                                                                                                                                                    * Jumping creatures
                                                                                                                                                                                                                                                                                                                                                                                    * Flying units
                                                                                                                                                                                                                                                                                                                                                                                    * Burrowing or phase-shifting anomaly entities
Each movement style uses a distinct motion model.
________________


28.9 Combat AI
28.9.1 Attack Patterns
Defined through templates:
                                                                                                                                                                                                                                                                                                                                                                                    * Wind-up frames
                                                                                                                                                                                                                                                                                                                                                                                    * Active hit frames
                                                                                                                                                                                                                                                                                                                                                                                    * Recovery frames
                                                                                                                                                                                                                                                                                                                                                                                    * Cancel windows
28.9.2 Adaptive Difficulty
                                                                                                                                                                                                                                                                                                                                                                                    * Adjusts aggression based on player performance
                                                                                                                                                                                                                                                                                                                                                                                    * Limits unfair chain attacks
28.9.3 Group Behavior
Enemies coordinate in groups:
                                                                                                                                                                                                                                                                                                                                                                                    * One attacker at a time while others flank
                                                                                                                                                                                                                                                                                                                                                                                    * Pack morale for creatures
                                                                                                                                                                                                                                                                                                                                                                                    * Intelligent retreats for certain factions
________________


________________
28.10 Creature Ecology
Creatures use:
                                                                                                                                                                                                                                                                                                                                                                                    * Hunger
                                                                                                                                                                                                                                                                                                                                                                                    * Curiosity
                                                                                                                                                                                                                                                                                                                                                                                    * Territory boundaries
                                                                                                                                                                                                                                                                                                                                                                                    * Fear levels
                                                                                                                                                                                                                                                                                                                                                                                    * Day/Night behavior changes
Taming interfaces with their instinctual needs.
________________


28.11 NPC AI (Non-Combat)
                                                                                                                                                                                                                                                                                                                                                                                    * Schedules (morning, mid-day, night)
                                                                                                                                                                                                                                                                                                                                                                                    * Location-based routines
                                                                                                                                                                                                                                                                                                                                                                                    * Reaction barks and contextual commentary
                                                                                                                                                                                                                                                                                                                                                                                    * Quest-driven overrides
                                                                                                                                                                                                                                                                                                                                                                                    * Party-following rules (for escorts)
NPC behavior always respects story and world-phase.
________________


28.12 Temporal Anomaly Integration
Anomalies dynamically affect AI:
                                                                                                                                                                                                                                                                                                                                                                                    * Time dilation (slow or accelerate enemies)
                                                                                                                                                                                                                                                                                                                                                                                    * Corruption states open alternative FSM branches
                                                                                                                                                                                                                                                                                                                                                                                    * Memory echoes confuse NPC routing
                                                                                                                                                                                                                                                                                                                                                                                    * Loop sequences override decision layer
Special anomaly states generate unique enemy patterns.
________________


________________
28.13 AI Data Structure
Each AI actor contains:
                                                                                                                                                                                                                                                                                                                                                                                    * ai_archetype
                                                                                                                                                                                                                                                                                                                                                                                    * sensing_components list
                                                                                                                                                                                                                                                                                                                                                                                    * emotional_state (fear, aggression, curiosity)
                                                                                                                                                                                                                                                                                                                                                                                    * territory_data
                                                                                                                                                                                                                                                                                                                                                                                    * pack_links
                                                                                                                                                                                                                                                                                                                                                                                    * anomaly_affinity
                                                                                                                                                                                                                                                                                                                                                                                    * decision_context buffer
This allows easy cloning, tuning, and runtime modification.
________________


28.14 Editor Tools
28.14.1 Behavior Tree Inspector
Even though FSM is the primary system, designer tools visualize the high-level logic as a tree for clarity.
28.14.2 Patrol Path Editor
Waypoint editor with:
                                                                                                                                                                                                                                                                                                                                                                                    * Wait times
                                                                                                                                                                                                                                                                                                                                                                                    * Look directions
                                                                                                                                                                                                                                                                                                                                                                                    * Conditional branches
28.14.3 Sensing Visualizer
Debug overlay showing:
                                                                                                                                                                                                                                                                                                                                                                                    * Vision cones
                                                                                                                                                                                                                                                                                                                                                                                    * Hearing polygons
                                                                                                                                                                                                                                                                                                                                                                                    * Proximity radii
28.14.4 Anomaly AI Preview
Allows testing of corrupted or time-loop behaviors.
________________


________________
28.15 Debugging & Profiling
                                                                                                                                                                                                                                                                                                                                                                                    * Toggle aggression
                                                                                                                                                                                                                                                                                                                                                                                    * Freeze decision layer
                                                                                                                                                                                                                                                                                                                                                                                    * Force specific states
                                                                                                                                                                                                                                                                                                                                                                                    * AI load test (100 NPCs)
                                                                                                                                                                                                                                                                                                                                                                                    * Perception logs
________________


28.16 Multiplayer Considerations
                                                                                                                                                                                                                                                                                                                                                                                    * AI must synchronize perception events to multiple players
                                                                                                                                                                                                                                                                                                                                                                                    * Priority rules decide which player a group focuses
                                                                                                                                                                                                                                                                                                                                                                                    * Co-op stealth: noise aggregation and shared suspicion
________________


Summary
The AI System in Densetsu combines modular sensing, robust decision-making, ecological and narrative integration, and seamless FSM coordination. It supports enemy aggression, creature ecology, riftspawn unpredictability, and NPC daily life—all functioning reliably under temporal anomalies and multiplayer scenarios.
________________
29. Modular Narrative Integration System
29.1 Purpose & Philosophy
It defines how story content enters gameplay without dictating the creative writing itself.
It provides tools, runtime rules, and data structures that allow narrative elements—dialogue, lore, discoveries, memory echoes, anomaly insights, NPC arcs—to seamlessly interact with the engine’s broader modular systems.
This system ensures:
                                                                                                                                                                                                                                                                                                                                                                                    * Narrative beats can occur non-linearly.
                                                                                                                                                                                                                                                                                                                                                                                    * Story can respond to player state, world state, time state, and anomalies.
                                                                                                                                                                                                                                                                                                                                                                                    * Every narrative fixture is a module, not a monolith.
                                                                                                                                                                                                                                                                                                                                                                                    * Designers and writers can add or rearrange narrative without restructuring code.
The system does not decide the story—only how the story is delivered.
________________


29.2 Core Principles
                                                                                                                                                                                                                                                                                                                                                                                    1. Narrative as Data, Not Scripts
 All content is stored as structured data files, usable by human or AI collaborators.

                                                                                                                                                                                                                                                                                                                                                                                    2. Events Are Conditional, Not Sequential
 Narrative triggers rely on states, flags, anomalies, gadgets, and actors—no mandatory “A leads to B.”

                                                                                                                                                                                                                                                                                                                                                                                    3. Modular Components
 Dialogue, lore pickups, cutscenes, flashbacks, time echoes, NPC arcs—each is a standalone module.

                                                                                                                                                                                                                                                                                                                                                                                    4. Reactive Storytelling
 Story elements respond to:

                                                                                                                                                                                                                                                                                                                                                                                       * Player actions & morality
                                                                                                                                                                                                                                                                                                                                                                                       * World restoration level
                                                                                                                                                                                                                                                                                                                                                                                       * Temporal stability
                                                                                                                                                                                                                                                                                                                                                                                       * Party composition
                                                                                                                                                                                                                                                                                                                                                                                       * Active gadgets
                                                                                                                                                                                                                                                                                                                                                                                       * Time of day

                                                                                                                                                                                                                                                                                                                                                                                          5. Non-Blocking Design
 No narrative element may permanently soft-lock gameplay.
Even story-critical gates must offer conditional paths (main route, anomaly route, memory route).

29.3 Narrative Modules
Narrative content is broken down into independent module types:
29.3.1 Dialogue Module
A single conversation node or tree.
Contains:
                                                                                                                                                                                                                                                                                                                                                                                             * Lines
                                                                                                                                                                                                                                                                                                                                                                                             * Speaker tags
                                                                                                                                                                                                                                                                                                                                                                                             * Animation cues (optional)
                                                                                                                                                                                                                                                                                                                                                                                             * Conditional lines (branching via flags)
                                                                                                                                                                                                                                                                                                                                                                                             * Unlock conditions
                                                                                                                                                                                                                                                                                                                                                                                             * Progression flags to set upon completion
29.3.2 Lore Module
Any collectible or informational piece:
                                                                                                                                                                                                                                                                                                                                                                                             * Text entries
                                                                                                                                                                                                                                                                                                                                                                                             * Memory fragments
                                                                                                                                                                                                                                                                                                                                                                                             * Time echoes
                                                                                                                                                                                                                                                                                                                                                                                             * Audio diaries
                                                                                                                                                                                                                                                                                                                                                                                             * Environmental murals
Marked with:
                                                                                                                                                                                                                                                                                                                                                                                             * Category
                                                                                                                                                                                                                                                                                                                                                                                             * Region
                                                                                                                                                                                                                                                                                                                                                                                             * Unlock trigger
                                                                                                                                                                                                                                                                                                                                                                                             * Whether it persists or updates over time
29.3.3 Cutscene Module
Lightweight, scriptable sequences referencing:
                                                                                                                                                                                                                                                                                                                                                                                             * Camera motion presets (modular)
                                                                                                                                                                                                                                                                                                                                                                                             * Actor animation states
                                                                                                                                                                                                                                                                                                                                                                                             * Audio cues
                                                                                                                                                                                                                                                                                                                                                                                             * Timed events
                                                                                                                                                                                                                                                                                                                                                                                             * Dialogue modules (optional)
________________
29.3.4 Anomaly Narrative Module
Special module type tied to:
                                                                                                                                                                                                                                                                                                                                                                                             * Temporal rifts
                                                                                                                                                                                                                                                                                                                                                                                             * Instability zones
                                                                                                                                                                                                                                                                                                                                                                                             * Narrative loops
                                                                                                                                                                                                                                                                                                                                                                                             * Echoes of past/future
These require anomaly conditions and may change after player actions elsewhere.
29.3.5 NPC Arc Module
Defines multi-stage narrative progression for any important NPC.
Includes:
                                                                                                                                                                                                                                                                                                                                                                                             * Arc stages
                                                                                                                                                                                                                                                                                                                                                                                             * Unlock conditions
                                                                                                                                                                                                                                                                                                                                                                                             * Fail / alternate branches
                                                                                                                                                                                                                                                                                                                                                                                             * Loop interactions (if NPC is temporally trapped)
                                                                                                                                                                                                                                                                                                                                                                                             * Region-dependent variations
________________


29.4 Trigger & Condition System
A universal wrapper for all narrative modules.
29.4.1 Trigger Types
                                                                                                                                                                                                                                                                                                                                                                                             * Proximity / area enter
                                                                                                                                                                                                                                                                                                                                                                                             * Interaction
                                                                                                                                                                                                                                                                                                                                                                                             * Player stat threshold
                                                                                                                                                                                                                                                                                                                                                                                             * World restoration percentage
                                                                                                                                                                                                                                                                                                                                                                                             * Quest progression
                                                                                                                                                                                                                                                                                                                                                                                             * NPC arc stage
                                                                                                                                                                                                                                                                                                                                                                                             * Time-of-day
                                                                                                                                                                                                                                                                                                                                                                                             * Temporal state (stable, unstable, active rift)
                                                                                                                                                                                                                                                                                                                                                                                             * Gadget equipped / active
                                                                                                                                                                                                                                                                                                                                                                                             * Puzzle result
                                                                                                                                                                                                                                                                                                                                                                                             * Player action flags (chaotic, merciful, indifferent)
________________
29.4.2 Condition Logic
Conditions support:
                                                                                                                                                                                                                                                                                                                                                                                             * AND group
                                                                                                                                                                                                                                                                                                                                                                                             * OR group
                                                                                                                                                                                                                                                                                                                                                                                             * NOT logic
                                                                                                                                                                                                                                                                                                                                                                                             * Parameterized thresholds
                                                                                                                                                                                                                                                                                                                                                                                             * Region-specific overrides
________________


29.5 Narrative State Machine (NSM)
Each narrative module feeds into a very small, universal state machine:
                                                                                                                                                                                                                                                                                                                                                                                             1. Locked
 Conditions unmet, player unaware.
                                                                                                                                                                                                                                                                                                                                                                                             2. Available
 Player can trigger it.
                                                                                                                                                                                                                                                                                                                                                                                             3. Active
 Playing now: dialogue, cutscene, lore reveal, etc.
                                                                                                                                                                                                                                                                                                                                                                                             4. Resolved
 Completed; may set flags.
                                                                                                                                                                                                                                                                                                                                                                                             5. Altered (optional)
 State for modules that change after world restoration or anomaly resolution.
                                                                                                                                                                                                                                                                                                                                                                                             6. Archived
 Stored in the player’s narrative log.
This provides predictable behavior without hardcoding sequences.
________________


________________
29.6 Integration with Other Systems
29.6.1 Actor System
                                                                                                                                                                                                                                                                                                                                                                                                * NPC states change based on arc modules.
                                                                                                                                                                                                                                                                                                                                                                                                * Actors may expose triggers (talk to X, rescue X, discover X).

29.6.2 FSM
Actors use narrative-tagged states like:
                                                                                                                                                                                                                                                                                                                                                                                                   * state_talkable
                                                                                                                                                                                                                                                                                                                                                                                                   * state_cutscene
                                                                                                                                                                                                                                                                                                                                                                                                   * state_temporal_echo
29.6.3 Quest System (when designed)
Narrative modules will define:
                                                                                                                                                                                                                                                                                                                                                                                                   * Quest intro triggers
                                                                                                                                                                                                                                                                                                                                                                                                   * Quest resolution triggers
                                                                                                                                                                                                                                                                                                                                                                                                   * NPC reactions
                                                                                                                                                                                                                                                                                                                                                                                                   * Fail states or alternate consequences
29.6.4 Anomalies
Narrative modules may:
                                                                                                                                                                                                                                                                                                                                                                                                   * Unlock only during instability
                                                                                                                                                                                                                                                                                                                                                                                                   * Change when stability is restored
                                                                                                                                                                                                                                                                                                                                                                                                   * Extend or shorten loops
                                                                                                                                                                                                                                                                                                                                                                                                   * Reveal memories
                                                                                                                                                                                                                                                                                                                                                                                                   * Alter NPC perception
29.6.5 Gadgets
Some gadgets influence narrative presentation:
                                                                                                                                                                                                                                                                                                                                                                                                   * Memory Lantern shows flashback lines
                                                                                                                                                                                                                                                                                                                                                                                                   * Chronobloom reveals secret narrative nodes
                                                                                                                                                                                                                                                                                                                                                                                                   * Spore Compass finds lore

________________


29.7 Tools for Writers & Designers
To ensure both humans and AI helpers can collaborate:
Data Templates
Each narrative module has a canonical YAML or JSON structure.
Editor Helpers
                                                                                                                                                                                                                                                                                                                                                                                                      * Preview dialogue tree
                                                                                                                                                                                                                                                                                                                                                                                                      * Preview camera path
                                                                                                                                                                                                                                                                                                                                                                                                      * Condition builder
                                                                                                                                                                                                                                                                                                                                                                                                      * Flag inspector
                                                                                                                                                                                                                                                                                                                                                                                                      * Loop cycle visualizer
Tagging System
Every narrative element includes tags like:
                                                                                                                                                                                                                                                                                                                                                                                                      * region
                                                                                                                                                                                                                                                                                                                                                                                                      * NPC
                                                                                                                                                                                                                                                                                                                                                                                                      * anomaly
                                                                                                                                                                                                                                                                                                                                                                                                      * timeline
                                                                                                                                                                                                                                                                                                                                                                                                      * arc
                                                                                                                                                                                                                                                                                                                                                                                                      * morality
This ensures a maintainable library of story content.
________________


29.8 Saving & Persistence
Narrative states are stored via the Persistence Framework:
                                                                                                                                                                                                                                                                                                                                                                                                      * Current stage of every NPC arc
                                                                                                                                                                                                                                                                                                                                                                                                      * Seen / unseen dialogues
                                                                                                                                                                                                                                                                                                                                                                                                      * Resolved loops
                                                                                                                                                                                                                                                                                                                                                                                                      * Timeline-altering choices
                                                                                                                                                                                                                                                                                                                                                                                                      * Lore collected
                                                                                                                                                                                                                                                                                                                                                                                                      * World restoration percentage

________________


________________
29.9 Debugging & Testing
A Narrative Debug Panel provides:
                                                                                                                                                                                                                                                                                                                                                                                                         * Skip-to-stage controls
                                                                                                                                                                                                                                                                                                                                                                                                         * Flag toggling
                                                                                                                                                                                                                                                                                                                                                                                                         * Trigger simulation
                                                                                                                                                                                                                                                                                                                                                                                                         * Module reload without restarting game
                                                                                                                                                                                                                                                                                                                                                                                                         * Visualization of active conditions
Essential for rapid writing + testing.
________________


29.10 Future Extensions (Optional)
Not required now but planned to keep the system modular:
                                                                                                                                                                                                                                                                                                                                                                                                         * Voice-over line integration
                                                                                                                                                                                                                                                                                                                                                                                                         * Dynamic subtitle system
                                                                                                                                                                                                                                                                                                                                                                                                         * Timeline reactivity graphs
                                                                                                                                                                                                                                                                                                                                                                                                         * Multi-character party dialogues
                                                                                                                                                                                                                                                                                                                                                                                                         * Dynamic barks with emotional states
All optional modules that do not alter the core structure.
________________
30. Localization & Language Framework
30.1 Purpose & Philosophy
Localization must be treated as a data-driven, modular, system-level feature that can be extended or swapped without breaking any game logic.
Goals:
                                                                                                                                                                                                                                                                                                                                                                                                         * Support multiple languages with minimal overhead.
                                                                                                                                                                                                                                                                                                                                                                                                         * Allow incremental translation during development.
                                                                                                                                                                                                                                                                                                                                                                                                         * Avoid hardcoding any UI text, dialogue, or world text.
                                                                                                                                                                                                                                                                                                                                                                                                         * Provide runtime tools for switching languages instantly (for testing).
                                                                                                                                                                                                                                                                                                                                                                                                         * Maintain a single source-of-truth for all translatable content.
Localization must integrate smoothly with:
                                                                                                                                                                                                                                                                                                                                                                                                         * Narrative modules
                                                                                                                                                                                                                                                                                                                                                                                                         * UI system
                                                                                                                                                                                                                                                                                                                                                                                                         * Input prompts
                                                                                                                                                                                                                                                                                                                                                                                                         * Tutorials
                                                                                                                                                                                                                                                                                                                                                                                                         * Item descriptions
                                                                                                                                                                                                                                                                                                                                                                                                         * Gadget interfaces
                                                                                                                                                                                                                                                                                                                                                                                                         * Environmental text (signs, books, murals)
It must also allow dynamic insertion of player names, stats, quantities, and variables.
________________


30.2 Core Principles
                                                                                                                                                                                                                                                                                                                                                                                                         1. Never embed text directly into code.
 All translatable strings are referenced via keys.

                                                                                                                                                                                                                                                                                                                                                                                                         2. Translation as structured data.
 Each language is a dictionary file (JSON/YAML) with identical key trees.

                                                                                                                                                                                                                                                                                                                                                                                                         3. Atomic strings only.
 No sentence concatenation inside code—use templates with variable placeholders.

                                                                                                                                                                                                                                                                                                                                                                                                         4. Modular language packs.
 New languages can be dropped in without editing engine code.

                                                                                                                                                                                                                                                                                                                                                                                                         5. Late-binding evaluation.
 Variables (names, numbers, item counts, stats) are injected at runtime.

30.3 Localization Data Structure
The recommended structure:
localization/
    en/
        ui.json
        dialogues.json
        items.json
        lore.json
        system.json
        tutorial.json
    jp/
        ui.json
        dialogues.json
        items.json
        lore.json
        system.json
        tutorial.json
    pt/
        ...


Each file mirrors the same key layout.
30.3.1 Key Format
Keys are hierarchical:
ui.menu.start
ui.menu.quit
dialogue.npc.bonsai_sage.greeting_01
item.weapon.kunai.description
system.error.not_found
tutorial.movement.jump
This ensures easy maintenance and predictable usage.
________________


________________
30.4 Dynamic Variables / Template Injection
Localization supports tokens:
"You have {count} kunai."
"The {item_name} is now equipped."
"{npc_name} thanks you."
Variable sets are passed to the localization manager, ensuring:
                                                                                                                                                                                                                                                                                                                                                                                                            * Correct pluralization rules
                                                                                                                                                                                                                                                                                                                                                                                                            * Gender rules (for some languages)
                                                                                                                                                                                                                                                                                                                                                                                                            * Contextual formatting
Example (Godot):
Localization.get("item.pickup.message", {
    "count": 3,
    "item_name": "Kunai"
})
________________


30.5 Runtime Localization Manager
Responsibilities:
                                                                                                                                                                                                                                                                                                                                                                                                            * Load language packs.
                                                                                                                                                                                                                                                                                                                                                                                                            * Provide cached access to keys.
                                                                                                                                                                                                                                                                                                                                                                                                            * Provide debug fallback (English if missing).
                                                                                                                                                                                                                                                                                                                                                                                                            * Handle variable injection.
                                                                                                                                                                                                                                                                                                                                                                                                            * Provide notification to UI components on language change.
                                                                                                                                                                                                                                                                                                                                                                                                            * Support hot-reload during development.
Language Switching
At any time, the player or tester can switch languages via:
Localization.set_language("jp")
UI and narrative elements receiving language signals automatically update presented text.
________________


________________
30.6 Integration with Other Systems
30.6.1 UI System
                                                                                                                                                                                                                                                                                                                                                                                                            * All UI components use localization keys.
                                                                                                                                                                                                                                                                                                                                                                                                            * Buttons, labels, prompts load text dynamically.
                                                                                                                                                                                                                                                                                                                                                                                                            * Responsive UI must auto-adjust for text length.
30.6.2 Narrative System
Dialogue modules reference only keys, not text.
Example:
dialogue_line: "dialogue.npc.hirogawa.elder.hello_01"
This allows one narrative design to scale across languages.
30.6.3 Inventory & Items
Item names and descriptions come from localized dictionaries.
30.6.4 Gadgets
Gadget UIs, instructional text, and anomaly detection messages rely on localization keys.
30.6.5 Tutorial System
Every prompt and instruction must be language-keyed, including:
                                                                                                                                                                                                                                                                                                                                                                                                            * Movement tutorials
                                                                                                                                                                                                                                                                                                                                                                                                            * Stealth cues
                                                                                                                                                                                                                                                                                                                                                                                                            * Combat tips
30.6.6 Sound System (optional)
If voice acting is added:
                                                                                                                                                                                                                                                                                                                                                                                                            * Voice files link to text keys.
                                                                                                                                                                                                                                                                                                                                                                                                            * Subtitle timing references the same IDs.
________________


________________
30.7 Edge Cases & Advanced Features
30.7.1 Pluralization & Grammar Rules
Some languages require:
                                                                                                                                                                                                                                                                                                                                                                                                            * Gender rules
                                                                                                                                                                                                                                                                                                                                                                                                            * Pronoun variations
                                                                                                                                                                                                                                                                                                                                                                                                            * Plural categories

The system supports language-specific rules loaded from a grammar file:
grammar/en.json
grammar/pl.json
30.7.2 Right-to-Left Languages (optional future)
Not required at launch, but:
                                                                                                                                                                                                                                                                                                                                                                                                               * System should not forbid RTL support.
                                                                                                                                                                                                                                                                                                                                                                                                               * UI container mirroring should be implemented in the engine layer.
30.7.3 Font Substitution & Fallback
Each language pack defines:
                                                                                                                                                                                                                                                                                                                                                                                                               * Primary font
                                                                                                                                                                                                                                                                                                                                                                                                               * Fallback font
                                                                                                                                                                                                                                                                                                                                                                                                               * Glyph ranges
Suhada, anthropomorphic languages, rune scripts, and anomaly text each may require unique font sets.
30.7.4 In-World Text
Environmental elements (signs, scrolls, books) are also localized via:
                                                                                                                                                                                                                                                                                                                                                                                                               * Keyed text
                                                                                                                                                                                                                                                                                                                                                                                                               * Optional art layers for languages that redraw symbols
                                                                                                                                                                                                                                                                                                                                                                                                               * Memory Echo text overlays
________________


________________
30.8 Testing & Debugging Tools
Localization Debug Panel
Functions include:
                                                                                                                                                                                                                                                                                                                                                                                                               * Live switch language
                                                                                                                                                                                                                                                                                                                                                                                                               * Show missing keys
                                                                                                                                                                                                                                                                                                                                                                                                               * Highlight unused keys
                                                                                                                                                                                                                                                                                                                                                                                                               * Dump currently loaded dictionary
                                                                                                                                                                                                                                                                                                                                                                                                               * Log variable injection errors
Fake Language Mode
A “Pseudolanguage” option:
                                                                                                                                                                                                                                                                                                                                                                                                               * Expands text
                                                                                                                                                                                                                                                                                                                                                                                                               * Inserts accent marks
                                                                                                                                                                                                                                                                                                                                                                                                               * Helps test UI overflow and layout adaptability
________________


30.9 Pipeline for Writers & Translators
Workflow
                                                                                                                                                                                                                                                                                                                                                                                                               1. Narrative / UI designer adds a new key to the English dictionary.
                                                                                                                                                                                                                                                                                                                                                                                                               2. Translators receive updated files with missing keys flagged.
                                                                                                                                                                                                                                                                                                                                                                                                               3. Translators deliver new language files.
                                                                                                                                                                                                                                                                                                                                                                                                               4. Localization manager loads updated packs.
                                                                                                                                                                                                                                                                                                                                                                                                               5. Writers test in runtime using debug tools.
Validation
The engine includes a validation step that:
                                                                                                                                                                                                                                                                                                                                                                                                               * Ensures all languages have the same keys
                                                                                                                                                                                                                                                                                                                                                                                                               * Reports missing or duplicate keys
                                                                                                                                                                                                                                                                                                                                                                                                               * Ensures JSON/YAML syntax integrity
________________


30.10 Persistence & Save System
Saves store:
                                                                                                                                                                                                                                                                                                                                                                                                               * Current language
                                                                                                                                                                                                                                                                                                                                                                                                               * Last voice/subtitle settings

Localization does not store resolved text; all text resolves on load.
31. Tooling Strategy & Editor Extensions
31.1 Purpose & Philosophy
The Densetsu Engine must include editor tools that:
                                                                                                                                                                                                                                                                                                                                                                                                                  * Reduce human workload
                                                                                                                                                                                                                                                                                                                                                                                                                  * Speed up content iteration
                                                                                                                                                                                                                                                                                                                                                                                                                  * Reduce human error
                                                                                                                                                                                                                                                                                                                                                                                                                  * Make it easier for both programmers and non-programmers to contribute consistently
Tooling must remain modular, non-invasive, and easy to enable/disable depending on workflow needs.
These tools are not meant to replace human creativity—they exist to:
                                                                                                                                                                                                                                                                                                                                                                                                                  * Automate repetitive tasks
                                                                                                                                                                                                                                                                                                                                                                                                                  * Provide visual debugging
                                                                                                                                                                                                                                                                                                                                                                                                                  * Validate data consistency
                                                                                                                                                                                                                                                                                                                                                                                                                  * Streamline asset insertion
                                                                                                                                                                                                                                                                                                                                                                                                                  * Help create base systems (FSM templates, actor skeletons, gadgets, items, levels)
________________


31.2 Principles
                                                                                                                                                                                                                                                                                                                                                                                                                  1. Tools never enforce design.
 They help implement the design, but do not dictate it.

                                                                                                                                                                                                                                                                                                                                                                                                                  2. Tools operate on the same data structures the engine uses.
 Zero duplication.

                                                                                                                                                                                                                                                                                                                                                                                                                  3. Every tool is optional.
 The editor should run fine without custom tools if necessary.

                                                                                                                                                                                                                                                                                                                                                                                                                  4. All tools must be Godot-native.
 No external executables unless absolutely required.

                                                                                                                                                                                                                                                                                                                                                                                                                  5. Tools must be transparent.
 User can always see the data they manipulate, not hidden behind proprietary formats.

________________


________________
31.3 Core Tool Categories
31.3.1 Actor Tools
Custom panels to:
                                                                                                                                                                                                                                                                                                                                                                                                                     * Create new actor definitions (Player, Creature, NPC, Trap, Gadget)
                                                                                                                                                                                                                                                                                                                                                                                                                     * Assign FSM states from templates
                                                                                                                                                                                                                                                                                                                                                                                                                     * Attach default components (colliders, stats, combat definitions)
                                                                                                                                                                                                                                                                                                                                                                                                                     * Auto-generate folder structures and placeholder scripts
                                                                                                                                                                                                                                                                                                                                                                                                                     * Validate actor configuration (missing animations, missing states)
Actor Validator example errors:
                                                                                                                                                                                                                                                                                                                                                                                                                     * “Hitbox group missing for melee state”
                                                                                                                                                                                                                                                                                                                                                                                                                     * “No walk animation assigned”
                                                                                                                                                                                                                                                                                                                                                                                                                     * “FSM state file mismatch with actor capabilities”
________________


31.3.2 FSM Authoring Tools
A visual interface for:
                                                                                                                                                                                                                                                                                                                                                                                                                     * Creating state graphs
                                                                                                                                                                                                                                                                                                                                                                                                                     * Linking transitions
                                                                                                                                                                                                                                                                                                                                                                                                                     * Assigning behaviors
                                                                                                                                                                                                                                                                                                                                                                                                                     * Previewing state priorities and tags
The tool does not replace code.
It generates:
                                                                                                                                                                                                                                                                                                                                                                                                                     * State definitions
                                                                                                                                                                                                                                                                                                                                                                                                                     * Transition tables
                                                                                                                                                                                                                                                                                                                                                                                                                     * Debug views
This allows designers to modify state logic visually, while programmers enhance functionality through scripts.
________________


________________
31.3.3 Dialogue & Quest Tools
Even if narrative planning is in early stage, tools must support future expansion.
Features:
                                                                                                                                                                                                                                                                                                                                                                                                                     * Visual node-tree editor for dialogue flow
                                                                                                                                                                                                                                                                                                                                                                                                                     * Condition flags on branches
                                                                                                                                                                                                                                                                                                                                                                                                                     * Quest state definitions
                                                                                                                                                                                                                                                                                                                                                                                                                     * Auto-generated localization keys
                                                                                                                                                                                                                                                                                                                                                                                                                     * Preview in-editor
                                                                                                                                                                                                                                                                                                                                                                                                                     * Export to JSON for runtime
Once the narrative system is formalized, this tool integrates fully.
________________


31.3.4 Item & Gadget Tools
Tools to:
                                                                                                                                                                                                                                                                                                                                                                                                                     * Create inventory items
                                                                                                                                                                                                                                                                                                                                                                                                                     * Create Sage’s Gadgets
                                                                                                                                                                                                                                                                                                                                                                                                                     * Define parameters (weight, tags, activated effects, cooldowns)
                                                                                                                                                                                                                                                                                                                                                                                                                     * Assign sprites, animations, and attach data resources
                                                                                                                                                                                                                                                                                                                                                                                                                     * Auto-generate item IDs and localization placeholders
This ensures a unified item creation workflow.
________________


31.3.5 Animation Event Authoring Tools
A timeline editor to insert:
                                                                                                                                                                                                                                                                                                                                                                                                                     * Hitbox activation frames
                                                                                                                                                                                                                                                                                                                                                                                                                     * Invulnerability windows
                                                                                                                                                                                                                                                                                                                                                                                                                     * Footstep events
                                                                                                                                                                                                                                                                                                                                                                                                                     * Sound trigger events
                                                                                                                                                                                                                                                                                                                                                                                                                     * Weapon trail events
                                                                                                                                                                                                                                                                                                                                                                                                                     * FSM frame events
This reduces coding errors and makes combat more consistent.
________________


________________
31.3.6 Audio Tools
Since audio systems are highly structured, tools help define:
                                                                                                                                                                                                                                                                                                                                                                                                                     * Sound containers (loop, intro, outro, conditional layers)
                                                                                                                                                                                                                                                                                                                                                                                                                     * Propagation parameters (for stealth)
                                                                                                                                                                                                                                                                                                                                                                                                                     * Event triggers linked to FSM states
                                                                                                                                                                                                                                                                                                                                                                                                                     * Debug spatial propagation rays (visual overlay)
This improves iteration on stealth and combat audio.
________________


31.4 Editor Extensions for Debugging
31.4.1 Actor Debug Overlay
When enabled in editor/test mode:
                                                                                                                                                                                                                                                                                                                                                                                                                     * Shows hitboxes
                                                                                                                                                                                                                                                                                                                                                                                                                     * Shows hurtboxes
                                                                                                                                                                                                                                                                                                                                                                                                                     * Shows active state + priority
                                                                                                                                                                                                                                                                                                                                                                                                                     * Shows stat deltas
                                                                                                                                                                                                                                                                                                                                                                                                                     * Shows polygons of sound propagation
31.4.2 Time Anomaly Visualizer
A tool to:
                                                                                                                                                                                                                                                                                                                                                                                                                     * Highlight active anomaly zones
                                                                                                                                                                                                                                                                                                                                                                                                                     * Show rift boundaries
                                                                                                                                                                                                                                                                                                                                                                                                                     * Show timeline instability graphs
                                                                                                                                                                                                                                                                                                                                                                                                                     * Track unresolved loops
                                                                                                                                                                                                                                                                                                                                                                                                                     * Debug NPC cycles
This helps designers iterate on temporal mechanics without guesswork.
________________


________________
31.5 Automated Content Validators
31.5.1 Project Linting
Runs automated checks on:
                                                                                                                                                                                                                                                                                                                                                                                                                     * Folder structures
                                                                                                                                                                                                                                                                                                                                                                                                                     * Missing assets
                                                                                                                                                                                                                                                                                                                                                                                                                     * Duplicate IDs
                                                                                                                                                                                                                                                                                                                                                                                                                     * Localization mismatches
                                                                                                                                                                                                                                                                                                                                                                                                                     * Unassigned animation states
                                                                                                                                                                                                                                                                                                                                                                                                                     * Actor warnings
31.5.2 “Smart Suggestions” Mode
Optional tool (disabled by default):
                                                                                                                                                                                                                                                                                                                                                                                                                     * Suggests missing states based on animations found
                                                                                                                                                                                                                                                                                                                                                                                                                     * Suggests hitboxes where frame timing suggests impact
                                                                                                                                                                                                                                                                                                                                                                                                                     * Suggests localization keys not yet translated
This is assistive, not generative.
________________


31.6 Asset Pipeline Tools
31.6.1 Animation Importer
When a sprite sheet or animation set is imported:
                                                                                                                                                                                                                                                                                                                                                                                                                        * Detect motion directions
                                                                                                                                                                                                                                                                                                                                                                                                                        * Generate default clips (idle, walk, run, jump)
                                                                                                                                                                                                                                                                                                                                                                                                                        * Apply pivot/stretch corrections
                                                                                                                                                                                                                                                                                                                                                                                                                        * Optionally apply “actor style” presets
31.6.2 Tilemap & Level Helpers
Tools for:
                                                                                                                                                                                                                                                                                                                                                                                                                        * Autotiling rule creation
                                                                                                                                                                                                                                                                                                                                                                                                                        * Placing interactables from templates
                                                                                                                                                                                                                                                                                                                                                                                                                        * Marking zones (stealth, safe, anomaly)
                                                                                                                                                                                                                                                                                                                                                                                                                        * Generating collision shapes from art layers

________________


31.7 Extensibility & Plug-In Architecture
Every tool must support:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Being replaced
                                                                                                                                                                                                                                                                                                                                                                                                                           * Being extended
                                                                                                                                                                                                                                                                                                                                                                                                                           * Being disabled per-project stage
                                                                                                                                                                                                                                                                                                                                                                                                                           * Exported as .zip or .pck for other Densetsu-related projects
The tooling layer is its own module inside the engine.
________________


31.8 Long-Term Vision
Future optional tooling:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Virtual camera path editor
                                                                                                                                                                                                                                                                                                                                                                                                                           * Music transition editor
                                                                                                                                                                                                                                                                                                                                                                                                                           * Network stress simulator (if online mode planned)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Creature ecosystem simulator
                                                                                                                                                                                                                                                                                                                                                                                                                           * Timeline stability tester
These should not be built now, but the architecture should leave room for them.
________________


31.9 Integration With the Team Workflow
Because the team is small and spread thin, tools must:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Minimize repetitive manual work
                                                                                                                                                                                                                                                                                                                                                                                                                           * Reduce the need for constant cross-checking
                                                                                                                                                                                                                                                                                                                                                                                                                           * Give everyone a common language and workflow
                                                                                                                                                                                                                                                                                                                                                                                                                           * Allow programmer-generated templates for designers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Support AI-assisted code generation while ensuring human oversight
Tools should speed up development without altering the artistic identity of the game.


________________


32. Localization System
Overview
The Localization System provides all tools, runtime structures, editors, and pipelines required to support multiple languages and culturally adapted content in Densetsu. Unlike Section 30 (Localization & Language), which defines the creative and stylistic rules of localization, this section focuses on the technical implementation.
Localization is designed as a fully modular subsystem, compatible with the engine’s Actor/Component architecture, UI system, and file-based data pipelines across the entire project.
________________


Goals
                                                                                                                                                                                                                                                                                                                                                                                                                           * Allow easy addition, removal, or modification of supported languages.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Provide designers and translators with human-readable formats.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Ensure all UI, dialogue, system text, tutorials, and metadata can be localized.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Support future expansion such as right-to-left (RTL) languages or region-specific typography.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Maintain lightweight performance with runtime caching, fallback structures, and event-driven updates.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Prevent hardcoded strings anywhere in logic or UI.
________________


________________
Localization File Structure
Localization files are stored as external text assets and may be hot-reloaded during development.
Recommended formats:
                                                                                                                                                                                                                                                                                                                                                                                                                           * .json (primary) — best for key-value structured data.
                                                                                                                                                                                                                                                                                                                                                                                                                           * .csv or .tsv — useful for translators, supported via import.
Directory structure:
/localization
/en
ui.json
dialogue_main.json
items.json
tutorials.json
/jp
ui.json
dialogue_main.json
items.json
tutorials.json
/pt
...
Each file contains a flat or nested key-value dictionary, e.g.:
{
"ui.menu.start": "Start Game",
"ui.menu.exit": "Exit",
"item.bamboo_sword.name": "Bamboo Sword",
"item.bamboo_sword.desc": "A simple wooden training weapon."
}
________________


________________
Key Naming Conventions
Keys must follow a global namespace pattern:
SYSTEM.CATEGORY.SUBCATEGORY.IDENTIFIER
Examples:
                                                                                                                                                                                                                                                                                                                                                                                                                           * ui.menu.start
                                                                                                                                                                                                                                                                                                                                                                                                                           * ui.pause.options
                                                                                                                                                                                                                                                                                                                                                                                                                           * dialogue.npc_ishigane.intro_01
                                                                                                                                                                                                                                                                                                                                                                                                                           * tutorial.combat.parry
                                                                                                                                                                                                                                                                                                                                                                                                                           * item.weapon.katana_wood.name
                                                                                                                                                                                                                                                                                                                                                                                                                           * system.error.missing_key
All keys must be unique across the project.
________________


Fallback Behavior
If a key is missing:
                                                                                                                                                                                                                                                                                                                                                                                                                           1. The system attempts a fallback language (usually English).
                                                                                                                                                                                                                                                                                                                                                                                                                           2. If still missing, it logs a warning.
                                                                                                                                                                                                                                                                                                                                                                                                                           3. It displays the key itself: "ui.menu.start" visibly becomes [ui.menu.start].
This ensures missing strings cannot silently pass QA.
________________


Runtime Architecture
The localization system is built around a central LocalizationManager.
Responsibilities:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Load and cache language data.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Provide functions to retrieve localized strings.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Notify the UI when the language changes.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Manage font and layout changes.
________________
API (conceptual):
LocalizationManager.set_language(code)
LocalizationManager.get(key)
LocalizationManager.get_formatted(key, params)
LocalizationManager.subscribe(listener)
________________


String Parameters
Supports printf-style or named substitution.
Example key:
"system.save.slots_used": "You are using {used}/{max} save slots."
Runtime usage:
LocalizationManager.get_formatted("system.save.slots_used", {
"used": 3,
"max": 12
})
________________


________________
Font, Typography & Layout Handling
Because languages differ in glyph sets and word length, the localization system handles:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Per-language font assets
                                                                                                                                                                                                                                                                                                                                                                                                                           * Word wrapping rules
                                                                                                                                                                                                                                                                                                                                                                                                                           * Character spacing tweaks
                                                                                                                                                                                                                                                                                                                                                                                                                           * UI container resizing
                                                                                                                                                                                                                                                                                                                                                                                                                           * Vertical/horizontal layout changes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Optional right-to-left (RTL) support (future)
Each language directory includes a descriptor file:
/meta.json
{
"font": "NotoSansCJK-Regular.ttf",
"line_spacing": 1.1,
"rtl": false,
"ui_scale": 1.0
}
________________


Editor Integration
The editor provides tools for:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Previewing text in all supported languages
                                                                                                                                                                                                                                                                                                                                                                                                                           * Importing CSVs from translators
                                                                                                                                                                                                                                                                                                                                                                                                                           * Generating missing key reports
                                                                                                                                                                                                                                                                                                                                                                                                                           * Hot-reloading localization files
                                                                                                                                                                                                                                                                                                                                                                                                                           * Searching all text by key or content
UI widgets automatically bind to localization keys via a property field:
[LocalizedLabel key="ui.menu.start"]
This allows designers to change languages and verify layout integrity directly inside the editor.
________________


________________
Dialogue Integration
The dialogue system uses the same key-value system.
Dialogue scripts reference keys, not text:
say npc_ishigane.dialogue_greeting_01
wait
say npc_ishigane.dialogue_question_02
This unifies the toolchain and prevents duplicated data.
________________


Hot Reloading (Development Only)
When enabled:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Saving a localization file in the project directory immediately updates all UI.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actors update their dialogue containers.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Logs show mismatched or new keys.
This ensures fast iteration.
________________


Testing & QA Tools
The localization module provides several QA modes:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Fake translation mode (lengthened strings to test layout)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Missing key highlighter (bright colors for debugging)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Random language switching to test runtime stability
                                                                                                                                                                                                                                                                                                                                                                                                                           * Batch integrity checker for key mismatches between languages
________________


Expansion Considerations
Future extensions may include:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Support for right-to-left (RTL) text
                                                                                                                                                                                                                                                                                                                                                                                                                           * Region-specific item names
                                                                                                                                                                                                                                                                                                                                                                                                                           * Voice-over language mapping
                                                                                                                                                                                                                                                                                                                                                                                                                           * Per-language difficulty tuning (if narrative demands it)
Localization remains fully modular and can be expanded without rewriting the system.
Summary
The Localization System is:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Modular
                                                                                                                                                                                                                                                                                                                                                                                                                           * Data-driven
                                                                                                                                                                                                                                                                                                                                                                                                                           * Cache-based with fallback
                                                                                                                                                                                                                                                                                                                                                                                                                           * Fully integrated with UI and dialogue tools
                                                                                                                                                                                                                                                                                                                                                                                                                           * Friendly to translators, designers, and programmers
It ensures that Densetsu remains globally accessible without limiting creativity or performance.
________________
33. Gameplay Scripting & Event System
Overview
The Gameplay Scripting & Event System defines how interactive, narrative, and systemic events are authored and executed in Densetsu. It provides a unified framework for cutscenes, triggers, scripted sequences, environmental interactions, puzzle logic, world-state transitions, and complex conditional gameplay.
This system must be modular, data-driven, and designer-friendly, allowing human or AI collaborators to safely create content without rewriting engine code.
________________


Goals
                                                                                                                                                                                                                                                                                                                                                                                                                           * Provide a universal event architecture for all in-game sequences.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Allow designers to build interactions without needing to code.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Prevent spaghetti logic by using modular, reusable event components.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Allow events to be easily versioned, extended, or disabled.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Integrate tightly with actors, dialogue, UI, audio, temporal anomalies, and quests.
________________


Core Concepts
1. Event Nodes
The system is built around modular event nodes, each representing a single action. Examples:
                                                                                                                                                                                                                                                                                                                                                                                                                           * PlayAnimation
                                                                                                                                                                                                                                                                                                                                                                                                                           * PlaySound
                                                                                                                                                                                                                                                                                                                                                                                                                           * MoveActorTo
                                                                                                                                                                                                                                                                                                                                                                                                                           * SpawnActor
                                                                                                                                                                                                                                                                                                                                                                                                                           * DespawnActor
                                                                                                                                                                                                                                                                                                                                                                                                                           * SetFlag
                                                                                                                                                                                                                                                                                                                                                                                                                           * CheckFlag
                                                                                                                                                                                                                                                                                                                                                                                                                           * Delay
                                                                                                                                                                                                                                                                                                                                                                                                                           * ShowDialogue
                                                                                                                                                                                                                                                                                                                                                                                                                           * ChangeCamera
Nodes can be used standalone or combined into event graphs.
________________
2. Event Graphs
Event nodes connect into flow graphs that determine:
                                                                                                                                                                                                                                                                                                                                                                                                                           * When events begin
                                                                                                                                                                                                                                                                                                                                                                                                                           * What conditions must be true
                                                                                                                                                                                                                                                                                                                                                                                                                           * What actions occur
                                                                                                                                                                                                                                                                                                                                                                                                                           * Which branches follow based on outcomes
This creates a visual scripting style suitable for designers.
3. Conditions & Flags
The system integrates with global, regional, and actor-specific flags. Examples:
                                                                                                                                                                                                                                                                                                                                                                                                                           * story.mainStage >= 4
                                                                                                                                                                                                                                                                                                                                                                                                                           * region["Hirogawa"].bambooQuestComplete == true
                                                                                                                                                                                                                                                                                                                                                                                                                           * actor["Michio"].HP < 20
Conditions can be nested, combined, or grouped.
________________


Event States
All events have states:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Idle – waiting for trigger conditions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Triggered – conditions met, ready to run
                                                                                                                                                                                                                                                                                                                                                                                                                           * Running – actively processing instructions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Paused – suspended (camera lock, dialogue, etc.)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Completed – finished successfully
                                                                                                                                                                                                                                                                                                                                                                                                                           * Failed – optional, for branching logic
________________


Event Triggers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Area triggers (player enters/exits zone)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Interaction prompts (press button near object)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Dialogue choices
                                                                                                                                                                                                                                                                                                                                                                                                                           * Combat state changes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Puzzle solutions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Quest stage updates
                                                                                                                                                                                                                                                                                                                                                                                                                           * Anomaly stability changes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Time-based triggers (time of day, timers)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actor state (HP, position, FSM tag)
Multiple triggers can be configured for a single event.
Event Execution
Sequential Execution
Nodes run one after another in a timeline.
Parallel Execution
Multiple nodes can run simultaneously. Examples:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actor moves while camera pans
                                                                                                                                                                                                                                                                                                                                                                                                                           * UI fades while sound effects play
Branching
Based on conditions:
                                                                                                                                                                                                                                                                                                                                                                                                                           * If player has item X, go to branch A
                                                                                                                                                                                                                                                                                                                                                                                                                           * If NPC is alive, execute alternate dialogue
________________


Integration with Engine Systems
Finite State Machine
Events may:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Force state transitions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Await specific states (e.g., actor.idle)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Pause or override states temporarily
Quest System
Events can:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Update quest stages
                                                                                                                                                                                                                                                                                                                                                                                                                           * Unlock new quests
                                                                                                                                                                                                                                                                                                                                                                                                                           * Trigger rewards
Dialogue System
Events may:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Start dialogue
                                                                                                                                                                                                                                                                                                                                                                                                                           * Await chosen response
                                                                                                                                                                                                                                                                                                                                                                                                                           * Branch based on player choice
Camera System
Events can:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Trigger scripted camera paths
                                                                                                                                                                                                                                                                                                                                                                                                                           * Override player-controlled camera
                                                                                                                                                                                                                                                                                                                                                                                                                           * Apply zoom, shake, or filters
Audio System
Events may:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Play music stingers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Start dynamic loop transitions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Adjust spatial or ambient sound
Temporal Anomalies
Events can:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Change anomaly state
                                                                                                                                                                                                                                                                                                                                                                                                                           * Trigger anomaly puzzles
                                                                                                                                                                                                                                                                                                                                                                                                                           * Update rift stability metrics
UI
Events may:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Show alerts
                                                                                                                                                                                                                                                                                                                                                                                                                           * Fade screen
                                                                                                                                                                                                                                                                                                                                                                                                                           * Present tutorial popups
________________


________________
Event Assets
Events are stored in external files:
/events
hirogawa_intro.json
seigetsu_ambush.json
anomaly_rift01.json
npc_time_loop_05.json
Files define:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Triggers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Node graphs
                                                                                                                                                                                                                                                                                                                                                                                                                           * Variables
                                                                                                                                                                                                                                                                                                                                                                                                                           * Conditions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Flags modified
________________


Runtime Debug Tools
                                                                                                                                                                                                                                                                                                                                                                                                                           * Graph visualizer to see active nodes.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Breakpoint system to freeze execution.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Event inspector to display triggers, flags, and states.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Manual trigger UI for testing.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Logging overlay for errors or missing nodes.
________________


Editor Tools
The event editor allows:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Drag-and-drop event nodes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Rearranging connections
                                                                                                                                                                                                                                                                                                                                                                                                                           * Creating reusable subgraphs
                                                                                                                                                                                                                                                                                                                                                                                                                           * Testing events without gameplay
                                                                                                                                                                                                                                                                                                                                                                                                                           * Live preview of camera, animations, and dialogue
________________


________________
Safe Execution Principles
                                                                                                                                                                                                                                                                                                                                                                                                                           * Events run in isolated sandboxes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Hard failure protection: events cannot crash gameplay
                                                                                                                                                                                                                                                                                                                                                                                                                           * Soft fallback behaviors ensure continuity
                                                                                                                                                                                                                                                                                                                                                                                                                           * No node may hang indefinitely; safeguards required
________________


Summary
The Gameplay Scripting & Event System provides:
                                                                                                                                                                                                                                                                                                                                                                                                                           * A modular, powerful framework
                                                                                                                                                                                                                                                                                                                                                                                                                           * Visual scripting for designers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Deep integration with all major engine systems
                                                                                                                                                                                                                                                                                                                                                                                                                           * Safe, debuggable event execution
This system is essential for building cutscenes, quests, anomaly sequences, puzzles, and narrative flow throughout Densetsu.
________________
34. Cutscene System
Overview
The Cutscene System provides the foundational tools to create narrative sequences, cinematic moments, character introductions, environmental storytelling reveals, boss entrances, and special scripted events in Densetsu. It is built on top of the Gameplay Scripting & Event System (Section 33), but specialized for high-level cinematic control, ensuring consistency, polish, and designer-friendly authoring.
Cutscenes must be non-blocking, skippable (unless explicitly locked), modular, and layered, allowing simultaneous camera, animation, audio, UI, and event control.
________________


Goals
                                                                                                                                                                                                                                                                                                                                                                                                                           * Provide a unified, data-driven pipeline for all cutscenes.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Ensure cutscenes blend seamlessly with gameplay.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Allow designers to create cutscenes without programming.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Support full camera control, actor staging, animations, lighting, UI suppression, and audio cues.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Enable branching cinematic sequences driven by player choice or world-state.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Guarantee safe, non-crashing execution with fallback behaviors.
________________


Core Concepts
1. Cutscene Timeline
A cutscene is an ordered timeline composed of tracks, each controlling a subsystem:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Camera Track
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actor Track
                                                                                                                                                                                                                                                                                                                                                                                                                           * Dialogue Track
                                                                                                                                                                                                                                                                                                                                                                                                                           * Animation Track
                                                                                                                                                                                                                                                                                                                                                                                                                           * Audio Track
                                                                                                                                                                                                                                                                                                                                                                                                                           * FX/Filters Track
                                                                                                                                                                                                                                                                                                                                                                                                                           * UI/Letterbox Track
                                                                                                                                                                                                                                                                                                                                                                                                                           * Script/Event Track
                                                                                                                                                                                                                                                                                                                                                                                                                           * Lighting Track
Timelines may branch or skip segments based on conditions.
2. Director Controller
A global CutsceneDirector manages:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Starting and ending sequences
                                                                                                                                                                                                                                                                                                                                                                                                                           * Layer priority (cutscenes override gameplay)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Skipping logic
                                                                                                                                                                                                                                                                                                                                                                                                                           * Camera takeover
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actor locking/unlocking
________________


Cutscene States
Cutscenes transition through several states:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Queued – registered but not started
                                                                                                                                                                                                                                                                                                                                                                                                                           * Starting – fading, locking input
                                                                                                                                                                                                                                                                                                                                                                                                                           * Running – timeline executing
                                                                                                                                                                                                                                                                                                                                                                                                                           * Awaiting Input – dialogue choices, hold-to-skip prompts
                                                                                                                                                                                                                                                                                                                                                                                                                           * Ending – restoring player control
                                                                                                                                                                                                                                                                                                                                                                                                                           * Completed – normal gameplay resumes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Interrupted – forced shutdown (debug or error)
________________


Actor Control During Cutscenes
Cutscenes need full control over:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actor locomotion
                                                                                                                                                                                                                                                                                                                                                                                                                           * FSM state overrides
                                                                                                                                                                                                                                                                                                                                                                                                                           * Pose staging
                                                                                                                                                                                                                                                                                                                                                                                                                           * Animation playback
                                                                                                                                                                                                                                                                                                                                                                                                                           * Teleportation, pathing
                                                                                                                                                                                                                                                                                                                                                                                                                           * Visibility, shadow toggles
Actors can be instanced, preloaded, or dynamically spawned for cutscenes.
________________


________________
Camera System Integration
Cutscenes can:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Move the camera along a spline
                                                                                                                                                                                                                                                                                                                                                                                                                           * Snap to predefined nodes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Apply zoom, tilt, shake
                                                                                                                                                                                                                                                                                                                                                                                                                           * Override player camera input
                                                                                                                                                                                                                                                                                                                                                                                                                           * Switch to cinematic aspect ratios
                                                                                                                                                                                                                                                                                                                                                                                                                           * Use depth-of-field or filters (if supported)
Camera tracks are keyframed in the editor.
________________


Dialogue Integration
Cutscenes use the localization & dialogue system:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Dialogue bubbles
                                                                                                                                                                                                                                                                                                                                                                                                                           * Full-screen dialogue windows
                                                                                                                                                                                                                                                                                                                                                                                                                           * Branching choices
                                                                                                                                                                                                                                                                                                                                                                                                                           * Voice stingers or barks
Dialogue steps can block or continue in parallel with animation.
________________


Audio Integration
Cutscenes may:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Trigger music transitions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Play stingers or ambience
                                                                                                                                                                                                                                                                                                                                                                                                                           * Control fade-in/out of layers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Sync sound effects with animation
The audio pipeline (Section 13) handles all spatial and 2D sound logic.
________________


________________
UI Behavior
Cutscenes may suppress UI:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Full hide
                                                                                                                                                                                                                                                                                                                                                                                                                           * Partial hide
                                                                                                                                                                                                                                                                                                                                                                                                                           * Replace with letterbox bars
                                                                                                                                                                                                                                                                                                                                                                                                                           * Display cinematic subtitles
                                                                                                                                                                                                                                                                                                                                                                                                                           * Show quick prompts (e.g., Skip)
Letterboxing is optional and customizable.
________________


Cutscene Triggers
A cutscene can begin from:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Entering a region
                                                                                                                                                                                                                                                                                                                                                                                                                           * A quest stage
                                                                                                                                                                                                                                                                                                                                                                                                                           * Dialogue choices
                                                                                                                                                                                                                                                                                                                                                                                                                           * Boss fight start
                                                                                                                                                                                                                                                                                                                                                                                                                           * Object interaction
                                                                                                                                                                                                                                                                                                                                                                                                                           * Temporal anomaly resolution
                                                                                                                                                                                                                                                                                                                                                                                                                           * Special sequences (opening, ending)
________________


Branching & Conditions
Cutscene steps can branch based on:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Player choices
                                                                                                                                                                                                                                                                                                                                                                                                                           * Inventory
                                                                                                                                                                                                                                                                                                                                                                                                                           * Completed anomalies
                                                                                                                                                                                                                                                                                                                                                                                                                           * Relationship metrics with key NPCs
                                                                                                                                                                                                                                                                                                                                                                                                                           * World-state flags
Branches can change entire sequences or minor beats.
________________


________________
Cutscene Data Format
Stored similarly to events:
/cutscenes
hirogawa_intro.json
seigetsu_raiders_arrival.json
okashira_dimensional_rift.json
ending_perfect_future.json
Each file contains:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Timeline tracks
                                                                                                                                                                                                                                                                                                                                                                                                                           * Camera paths
                                                                                                                                                                                                                                                                                                                                                                                                                           * Node references
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actor bindings
                                                                                                                                                                                                                                                                                                                                                                                                                           * Conditions for execution
________________


Editing Tools
The editor offers:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Timeline scrubber
                                                                                                                                                                                                                                                                                                                                                                                                                           * Track-based layout
                                                                                                                                                                                                                                                                                                                                                                                                                           * Keyframe editor
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actor preview staging
                                                                                                                                                                                                                                                                                                                                                                                                                           * Camera path editor
                                                                                                                                                                                                                                                                                                                                                                                                                           * Audio preview hooks
                                                                                                                                                                                                                                                                                                                                                                                                                           * Live testing inside the scene
Cutscenes can be played back without entering the game.
________________


Skipping Logic
Cutscenes can be:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Skippable – hold button for 1s
                                                                                                                                                                                                                                                                                                                                                                                                                           * Locked – unskippable (only for key narrative moments)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Auto-skip if previously seen – NG+ or repeat runs
Skipping yields safe fallback states ensuring no progression breaks.
________________


Runtime Debugging
Tools include:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Cutscene timeline debugger
                                                                                                                                                                                                                                                                                                                                                                                                                           * Track inspector
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actor binding validator
                                                                                                                                                                                                                                                                                                                                                                                                                           * Skip-to-step commands
                                                                                                                                                                                                                                                                                                                                                                                                                           * Error logs showing missing assets
________________


Summary
The Cutscene System provides:
                                                                                                                                                                                                                                                                                                                                                                                                                           * A robust cinematic framework
                                                                                                                                                                                                                                                                                                                                                                                                                           * Modular timeline authoring
                                                                                                                                                                                                                                                                                                                                                                                                                           * Deep integration with all gameplay systems
                                                                                                                                                                                                                                                                                                                                                                                                                           * Safe, reversible control of actors, camera, audio, and UI
It ensures Densetsu can deliver impactful storytelling while maintaining full designer freedom and stable runtime execution.






________________


35. Dialogue/Cinematics Integration
Overview
The Dialogue–Cinematics Integration Layer ensures seamless interplay between the Dialogue System, Cutscene System, and Event Scripting System. While each system is modular and self-contained, Densetsu requires them to coordinate tightly—dialogue influences cutscenes, cutscenes trigger dialogue, and player choices change branching outcomes.
This layer standardizes communication between systems so designers never need to implement glue logic manually.
________________


Goals
                                                                                                                                                                                                                                                                                                                                                                                                                           * Merge dialogue flow with cinematic presentation.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Ensure branching choices modify cutscenes and vice versa.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Provide safe coordination between actor animation, camera work, UI, and narration.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Allow mid-cutscene dialogue, interactive dialogue, and contextualized responses.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Maintain non-blocking, reversible behavior (cutscene skip protection, state-safe exit).
________________


Core Responsibilities
1. Synchronize Dialogue Steps with Timeline Tracks
Dialogue nodes automatically:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Pause timeline progression
                                                                                                                                                                                                                                                                                                                                                                                                                           * Hold camera positions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Hold actor animations if required
                                                                                                                                                                                                                                                                                                                                                                                                                           * Await player choice
                                                                                                                                                                                                                                                                                                                                                                                                                           * Resume cutscene tracks when complete
2. Context-Aware Delivery
Dialogue adapts based on:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actor emotional state
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actor position/look direction
                                                                                                                                                                                                                                                                                                                                                                                                                           * Temporal anomaly influence
                                                                                                                                                                                                                                                                                                                                                                                                                           * NPC’s loop or restoration state
                                                                                                                                                                                                                                                                                                                                                                                                                           * Regional or world flags
This creates organic storytelling.
3. Multi-Modal Display
Dialogue can appear in several styles depending on the cinematic context:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Speech bubbles (exploration mode)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Cinematic subtitles (cutscene mode)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Fullscreen dialogue panels (story-critical scenes)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Integrated choice prompts (branching moments)
The system switches automatically.
________________


Integration Points
With the Event System (Section 33)
Events may:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Initiate dialogue
                                                                                                                                                                                                                                                                                                                                                                                                                           * Pause execution until dialogue ends
                                                                                                                                                                                                                                                                                                                                                                                                                           * Branch based on dialogue choices
                                                                                                                                                                                                                                                                                                                                                                                                                           * Update global flags from dialogue outcomes
With the Cutscene System (Section 34)
Cutscenes may:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Trigger dialogue tracks within timelines
                                                                                                                                                                                                                                                                                                                                                                                                                           * Switch to dialogue UI mode
                                                                                                                                                                                                                                                                                                                                                                                                                           * Sync actor lip-sync (if used)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Control camera framing around speakers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Animate emotional states during responses
With the Localization System (Section 32)
                                                                                                                                                                                                                                                                                                                                                                                                                           * All dialogue keys map cleanly to localized strings.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Context variants (formal/informal, regional dialects) supported.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Dynamic insertion of player name or world-state references.
________________


________________
Branching Logic
Dialogue choices may:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Switch to entirely different timeline branches
                                                                                                                                                                                                                                                                                                                                                                                                                           * Change the outcome of a cutscene
                                                                                                                                                                                                                                                                                                                                                                                                                           * Influence NPC relationship parameters
                                                                                                                                                                                                                                                                                                                                                                                                                           * Trigger or cancel quests
                                                                                                                                                                                                                                                                                                                                                                                                                           * Affect temporal anomaly resolution
Branching is handled through the integration layer—designers do not manually wire gameplay logic into dialogue scripts.
________________


Actor Behavior Integration
Dialogue steps can command actors to:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Turn toward speakers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Change expression or emotion tags
                                                                                                                                                                                                                                                                                                                                                                                                                           * Play idle or gesture animations
                                                                                                                                                                                                                                                                                                                                                                                                                           * Walk into framing positions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Sit/stand/pose as required
These commands run as parallel tracks in the cutscene.
________________


Timing & Pacing
The integration layer manages:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Auto-advance timings (e.g., subtitle mode)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Manual advance (press button)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Logic for skipping lines if the cutscene is skipped
                                                                                                                                                                                                                                                                                                                                                                                                                           * Safety guards so branching state remains consistent even if the player skips
________________


Dynamic Dialogue Injection
During a cutscene or scripted moment, temporary or conditional lines may be injected:
                                                                                                                                                                                                                                                                                                                                                                                                                           * NPC reacts to low HP
                                                                                                                                                                                                                                                                                                                                                                                                                           * NPC reacts to player wearing specific gear
                                                                                                                                                                                                                                                                                                                                                                                                                           * World-state comments
                                                                                                                                                                                                                                                                                                                                                                                                                           * Time anomaly corruption lines
This allows richer role-playing without rewriting core dialogue files.
Debugging & Tools
Tools include:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Dialogue–cutscene sync visualizer
                                                                                                                                                                                                                                                                                                                                                                                                                           * Branch preview map
                                                                                                                                                                                                                                                                                                                                                                                                                           * Dialogue key validator (localization)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Cutscene interruption tester
                                                                                                                                                                                                                                                                                                                                                                                                                           * Skipping integrity checker
________________


Summary
This integration layer ensures that:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Dialogue, cutscenes, and events behave as a unified storytelling tool.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Player choices directly influence cinematic outcomes.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Designers do not need manual glue scripting.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Complex branching and reactive storytelling remain safe and manageable.
Together, this system forms the narrative backbone of Densetsu, ensuring every story moment flows smoothly and dynamically within gameplay.
________________


36. World Streaming & Scene Loading
Overview
The World Streaming & Scene Loading System defines how Densetsu loads, unloads, streams, and transitions between areas without visible loading screens. Due to the Metroidvania structure and semi-open world flow, this subsystem must be stable, memory-efficient, and tightly integrated with actors, save data, and anomaly states.
This system controls zone streaming, transitions, subscene composition, background loading, and runtime cleanup, ensuring consistent performance on modest hardware.
________________


Goals
                                                                                                                                                                                                                                                                                                                                                                                                                           * Enable seamless traversal between rooms, zones, and overworld sections.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Minimize loading screens (use only in rare, justified cases).
                                                                                                                                                                                                                                                                                                                                                                                                                           * Use memory efficiently by unloading out-of-scope scenes.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Provide deterministic actor, quest, and anomaly persistence across loads.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Allow designers to build content as modular scenes.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Ensure safe, crash-resistant loading and unloading.
________________


Core Concepts
1. Zone-Based World Structure
The world is built from Zones, each containing:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Tilemaps / parallax backgrounds
                                                                                                                                                                                                                                                                                                                                                                                                                           * Region-specific actors
                                                                                                                                                                                                                                                                                                                                                                                                                           * Soundscape data
                                                                                                                                                                                                                                                                                                                                                                                                                           * Environmental FX
                                                                                                                                                                                                                                                                                                                                                                                                                           * Area triggers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Subscenes and detail geometry
Zones are grouped by Region → Continent for macro-organization.
________________
2. Subscenes
Reusable components such as:
                                                                                                                                                                                                                                                                                                                                                                                                                           * NPC clusters
                                                                                                                                                                                                                                                                                                                                                                                                                           * Puzzle rooms
                                                                                                                                                                                                                                                                                                                                                                                                                           * Environmental props
                                                                                                                                                                                                                                                                                                                                                                                                                           * Lighting rigs
                                                                                                                                                                                                                                                                                                                                                                                                                           * Temporal anomaly nodes
These can be instanced multiple times across zones.
3. Streaming Boundaries
Special trigger volumes determine when to:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Begin loading the next zone
                                                                                                                                                                                                                                                                                                                                                                                                                           * Fade assets in/out
                                                                                                                                                                                                                                                                                                                                                                                                                           * Preload enemy AI
                                                                                                                                                                                                                                                                                                                                                                                                                           * Spawn necessary actors
                                                                                                                                                                                                                                                                                                                                                                                                                           * Unload far-away zones
________________


Loading Model
Asynchronous Loading
All zone loading occurs in the background:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Preloads assets
                                                                                                                                                                                                                                                                                                                                                                                                                           * Initializes navmeshes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Creates actor placeholders
                                                                                                                                                                                                                                                                                                                                                                                                                           * Prepares audio layers
Synchronous Snap (Rare)
Used only for:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Major region changes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Story transitions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Fast travel
                                                                                                                                                                                                                                                                                                                                                                                                                           * Entering minilevels in Varthum
Provides a controlled fade-to-black transition.
________________


Actor Streaming Rules
Actors follow:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Activation distance (FSM enters Active/Semi-Active)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Despawn rules when far enough
                                                                                                                                                                                                                                                                                                                                                                                                                           * State freezing to preserve progress
                                                                                                                                                                                                                                                                                                                                                                                                                           * Quest binding to avoid unintended resets
Bosses, NPCs, and story-critical actors use persistence anchors.
________________


Physics & Navigation
Physics and navigation assets are streamed alongside scene data:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Collision layers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Navigation meshes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Physics triggers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Soft bodies (rare)
Optimized per zone to avoid unnecessary global physics load.
________________


Temporal Anomalies Integration
Streaming must preserve:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Resolved anomalies
                                                                                                                                                                                                                                                                                                                                                                                                                           * Partially solved anomaly states
                                                                                                                                                                                                                                                                                                                                                                                                                           * Rifts and temporal distortions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Region-level stability metrics
Anomalies may modify zone loading by:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Changing layout
                                                                                                                                                                                                                                                                                                                                                                                                                           * Altering NPC spawns
                                                                                                                                                                                                                                                                                                                                                                                                                           * Triggering alternate versions of the same zone
________________


________________
Save & Persistence Integration
On unload, the system records:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actor states
                                                                                                                                                                                                                                                                                                                                                                                                                           * Puzzle solutions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Quest flags
                                                                                                                                                                                                                                                                                                                                                                                                                           * Zone-specific variables
                                                                                                                                                                                                                                                                                                                                                                                                                           * Player position (if checkpoint)
On load, it restores:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Layout
                                                                                                                                                                                                                                                                                                                                                                                                                           * NPC loops (Varthum)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Anomaly versions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Destructible states
________________


Audio Integration
Each zone defines:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Ambient layers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Spatial emitters
                                                                                                                                                                                                                                                                                                                                                                                                                           * Music triggers
Audio fades between zones smoothly, synced with visual transitions.
________________


Editor Tools
Designers can:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Preview streaming boundaries
                                                                                                                                                                                                                                                                                                                                                                                                                           * Simulate player traversal
                                                                                                                                                                                                                                                                                                                                                                                                                           * See memory impact estimates
                                                                                                                                                                                                                                                                                                                                                                                                                           * View the zone dependency graph (which zones load next)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Auto-generate subscene stubs
________________


________________
Performance Considerations
The system:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Caches frequently visited neighboring zones
                                                                                                                                                                                                                                                                                                                                                                                                                           * Unloads hidden zones immediately
                                                                                                                                                                                                                                                                                                                                                                                                                           * Clips high-cost FX outside camera range
                                                                                                                                                                                                                                                                                                                                                                                                                           * Reduces update frequency of distant systems
Memory budgets are enforced globally.
________________


Debug Tools
                                                                                                                                                                                                                                                                                                                                                                                                                           * Live zone map (loaded/unloaded states)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Actor footprint visualizer
                                                                                                                                                                                                                                                                                                                                                                                                                           * Streaming profiler (load times, memory spikes)
                                                                                                                                                                                                                                                                                                                                                                                                                           * Forced reload commands
________________


Summary
The World Streaming & Scene Loading System ensures:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Smooth, seamless exploration
                                                                                                                                                                                                                                                                                                                                                                                                                           * Consistent performance
                                                                                                                                                                                                                                                                                                                                                                                                                           * Modular content creation
                                                                                                                                                                                                                                                                                                                                                                                                                           * Reliable integration with persistence, anomalies, audio, and AI
This system provides the structural backbone for all level traversal and world cohesion in Densetsu.
________________
________________


37 – Camera System
Overview
The Camera System defines how visual framing, player tracking, cinematic presentation, environmental emphasis, and gameplay readability are achieved in Densetsu. As a hybrid of Metroidvania exploration and action-heavy combat, the camera must be responsive, intelligent, unobtrusive, and extensible.
The system supports gameplay camera modes, cinematic camera tracks, dynamic framing rules, and context-sensitive behavior, all integrated with cutscenes, dialogue, anomalies, and multiplayer.
________________


Goals
                                                                                                                                                                                                                                                                                                                                                                                                                           * Maintain clarity and readability during exploration and combat.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Support cinematic framing without breaking gameplay control.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Smoothly adapt to player movement, speed, and verticality.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Prevent camera obstruction or jitter.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Provide tools for designers to script customized camera paths.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Support split modes or shared tracking for local multiplayer.
________________


Core Camera Modes
1. Gameplay Follow Camera
Primary exploration/combat camera:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Tracks the player with predictive smoothing.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Offsets dynamically based on movement direction.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Zooms subtly during sprinting or fast traversal.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Anchors during precise platforming.
2. Combat Framing Mode
Engages when:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Enemies enter aggro range
                                                                                                                                                                                                                                                                                                                                                                                                                           * Boss arenas are entered
                                                                                                                                                                                                                                                                                                                                                                                                                           * Multi-enemy encounters occur
________________


Behavior:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Slightly zooms out for battlefield awareness.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Keeps all active threats within safe margins.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Uses weight-based centroid tracking.
3. Point-of-Interest Focus
Temporarily shifts focus to:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Environmental reveals
                                                                                                                                                                                                                                                                                                                                                                                                                           * Important NPCs
                                                                                                                                                                                                                                                                                                                                                                                                                           * Anomaly distortions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Interactive objects
Trigger-based and optional (does not override player input for long).
4. Cinematic & Cutscene Camera
Fully controlled by the Cutscene Director:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Keyframed motion
                                                                                                                                                                                                                                                                                                                                                                                                                           * Splines and bezier curves
                                                                                                                                                                                                                                                                                                                                                                                                                           * Camera shakes, zooms, filters
                                                                                                                                                                                                                                                                                                                                                                                                                           * Aspect ratio changes (letterbox)
Overrides gameplay camera until cutscene concludes.
5. Puzzle Camera
Used in:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Varthum loop puzzles
                                                                                                                                                                                                                                                                                                                                                                                                                           * Gadgets exploring sound lines, memory echoes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Precision minilevels
Can lock camera zoom or pivot within defined bounds.
6. Debug Camera
Editor-only free cam for testing.
________________


________________
Camera Composition Rules
Soft Framing
Camera maintains soft zones around the player:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Horizontal drift
                                                                                                                                                                                                                                                                                                                                                                                                                           * Vertical elasticity
                                                                                                                                                                                                                                                                                                                                                                                                                           * Deadzone inside which the player can move freely
Hard Limits
Camera never moves beyond:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Scene bounds
                                                                                                                                                                                                                                                                                                                                                                                                                           * Major occlusion hazards
                                                                                                                                                                                                                                                                                                                                                                                                                           * Region-specific framing rules
Verticality Handling
                                                                                                                                                                                                                                                                                                                                                                                                                           * Multi-level rooms
                                                                                                                                                                                                                                                                                                                                                                                                                           * Cliffs, waterfalls, towers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Smooth transitions between height layers
________________


Multiplayer Camera Behavior
Local multiplayer supports two modes:
1. Shared Camera
Camera tracks a bounding box containing all players.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Zoom out gracefully as players separate
                                                                                                                                                                                                                                                                                                                                                                                                                           * Apply soft leash limits
                                                                                                                                                                                                                                                                                                                                                                                                                           * Teleport lagging players using smoke puff effect when too far
2. Dynamic Split Camera (If specifically needed, not a priority)
If distance exceeds threshold:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Screen splits vertically or horizontally
                                                                                                                                                                                                                                                                                                                                                                                                                           * Camera tracks each player independently
                                                                                                                                                                                                                                                                                                                                                                                                                           * Re-merges when players reunite
Designed to be smooth and non-jarring.
Camera Collision & Occlusion Handling
Camera performs raycasts against solids:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Avoids foreground tiles
                                                                                                                                                                                                                                                                                                                                                                                                                           * Avoids dense particle regions
                                                                                                                                                                                                                                                                                                                                                                                                                           * Adjusts zoom to preserve visibility
Foreground elements fade dynamically if they block the player.
________________


Integration With Other Systems
With Events & Cutscenes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Full control transfer to cinematic camera
                                                                                                                                                                                                                                                                                                                                                                                                                           * Timeline-based keyframes
                                                                                                                                                                                                                                                                                                                                                                                                                           * Conditional branch framing
With Dialogue
                                                                                                                                                                                                                                                                                                                                                                                                                           * Auto-pans to speakers
                                                                                                                                                                                                                                                                                                                                                                                                                           * Applies zoom for emotional emphasis
With Anomalies
                                                                                                                                                                                                                                                                                                                                                                                                                           * When distortions occur, camera may:
                                                                                                                                                                                                                                                                                                                                                                                                                           * wobble subtly
                                                                                                                                                                                                                                                                                                                                                                                                                           * desync vignette
                                                                                                                                                                                                                                                                                                                                                                                                                           * reveal hidden objects using zoom or focus effects
With Gadgets
                                                                                                                                                                                                                                                                                                                                                                                                                           * Gramoflower and others may temporarily shift framing
                                                                                                                                                                                                                                                                                                                                                                                                                           * Pulse Reed may visualize rift pathways with guided panning
________________


Editor Tools
                                                                                                                                                                                                                                                                                                                                                                                                                           * Camera path editor
                                                                                                                                                                                                                                                                                                                                                                                                                           * Deadzone visualizer
                                                                                                                                                                                                                                                                                                                                                                                                                           * Multiplayer split preview
                                                                                                                                                                                                                                                                                                                                                                                                                           * Occlusion tester
                                                                                                                                                                                                                                                                                                                                                                                                                           * Shake/FX preview
Debugging Tools
                                                                                                                                                                                                                                                                                                                                                                                                                           * Real-time camera boundary display
                                                                                                                                                                                                                                                                                                                                                                                                                           * Tracking mode visual overlay
                                                                                                                                                                                                                                                                                                                                                                                                                           * Camera behavior logs
                                                                                                                                                                                                                                                                                                                                                                                                                           * Manual mode switch
________________


Summary
The Camera System ensures:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Smooth, readable gameplay framing
                                                                                                                                                                                                                                                                                                                                                                                                                           * Dynamic combat awareness
                                                                                                                                                                                                                                                                                                                                                                                                                           * Powerful cinematic control
                                                                                                                                                                                                                                                                                                                                                                                                                           * Intelligent adaptation to exploration, traversal, and anomalies
                                                                                                                                                                                                                                                                                                                                                                                                                           * Robust multiplayer support
It is a foundational layer of moment-to-moment gameplay clarity and narrative presentation in Densetsu.


________________
________________


38. Accessibility Framework
(Engine-level systems ensuring Densetsu is playable, readable, and comfortable for a wide range of players, without compromising artistic intent.)
38.1 Goals & Philosophy
Densetsu’s accessibility design aims to:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Reduce friction without reducing challenge.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Offer options, not shortcuts.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Ensure readability and comfort across long play sessions.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Keep all accessibility features modular and actor-agnostic.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Make all UI contrast, size, and input settings adjustable at runtime.
We do not tone down mechanics—players remain fully responsible for mastering combat and timing—but we make sure input, UI, and sensory feedback are customizable.
________________


38.2 Modular Accessibility Systems
Each accessibility subsystem is built as an independent module inside the engine:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Input Assist Module
                                                                                                                                                                                                                                                                                                                                                                                                                           * Visual Clarity & UI Scaling Module
                                                                                                                                                                                                                                                                                                                                                                                                                           * Color & Contrast Module
                                                                                                                                                                                                                                                                                                                                                                                                                           * Audio Accessibility Module
                                                                                                                                                                                                                                                                                                                                                                                                                           * Difficulty Transparency (not difficulty reduction) Module
Modules expose signals and parameters to the rest of the engine but never rely on gameplay logic to function.
________________


________________
38.3 Input Accessibility
38.3.1 Rebinding System
                                                                                                                                                                                                                                                                                                                                                                                                                           * Full remapping of keyboard, mouse, and controller input.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Save/load profiles.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Per-player profiles for local multiplayer.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Soft conflict detection (“two actions share a key, proceed?”).
38.3.2 Input Buffering Assist
Adjustable features:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Input grace window (0–150ms).
                                                                                                                                                                                                                                                                                                                                                                                                                           * Coyote time toggles.
                                                                                                                                                                                                                                                                                                                                                                                                                           * Jump input buffering (helpful for platforming).
                                                                                                                                                                                                                                                                                                                                                                                                                           * Dash/roll buffering.
38.3.3 Hold vs Tap
Actions can be configured per-player as:
                                                                                                                                                                                                                                                                                                                                                                                                                           * Tap
                                                                                                                                                                                                                                                                                                                                                                                                                           * Hold
                                                                                                                                                                                                                                                                                                                                                                                                                           * Press + direction
                                                                                                                                                                                                                                                                                                                                                                                                                           * Double-tap
Useful for gadgets, menus, advanced combat techniques.

38.3.4 Reduced Rapid Input Requirements
Optional toggle:
                                                                                                                                                                                                                                                                                                                                                                                                                              * Converts mash sequences into sustained presses.
Used for accessibility, not gameplay advantage.

________________


________________
38.4 Visual Accessibility
38.4.1 UI Scaling
Runtime scaling:
                                                                                                                                                                                                                                                                                                                                                                                                                                 * 0.75x → 2.0x

                                                                                                                                                                                                                                                                                                                                                                                                                                 * Independent scaling for:

                                                                                                                                                                                                                                                                                                                                                                                                                                    * HUD
                                                                                                                                                                                                                                                                                                                                                                                                                                    * Menus
                                                                                                                                                                                                                                                                                                                                                                                                                                    * Dialogue text
                                                                                                                                                                                                                                                                                                                                                                                                                                    * Subtitles
                                                                                                                                                                                                                                                                                                                                                                                                                                    * Item popups

38.4.2 Font & Text Settings
Includes:
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Font size presets
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Dyslexia-friendly font toggle
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Adjustable line spacing
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Adjustable dialogue text speed
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Auto-advance option with adjustable delay
38.4.3 High-Contrast Mode
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Bold outlines on characters
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Higher contrast on interactables
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Clearer enemy telegraphs
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Visibility filters for low-light regions
38.4.4 Screen Shake & Flash Controls
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Toggle screen shake
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Toggle damage flashes
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Reduce screen effects intensity (0–100%)
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Fully remove white flashes during time anomalies
________________


________________
38.5 Color Accessibility
38.5.1 Colorblind Presets
Engine-provided LUTs for:
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Protanopia
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Deuteranopia
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Tritanopia
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Monochromacy
38.5.2 Element-specific Filters
Because Densetsu uses nine elemental types, we provide options to adjust:
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Elemental particle hue shifts
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Color-coded attack warnings
                                                                                                                                                                                                                                                                                                                                                                                                                                       * UI color themes
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Gadget glow indicators
All presets are editable and can be exported/imported.
________________


38.6 Audio Accessibility
38.6.1 Subtitles & Sound Descriptions
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Subtitles for cutscenes, dialogue, ambient narration
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Optional sound-event captions (“[Footsteps approaching]”, “[Anomaly hum rising]”)
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Adjustable caption opacity and background
38.6.2 Independent Volume Categories
Separate sliders for:
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Master
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Music
                                                                                                                                                                                                                                                                                                                                                                                                                                       * SFX
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Dialogue
                                                                                                                                                                                                                                                                                                                                                                                                                                       * Environment
                                                                                                                                                                                                                                                                                                                                                                                                                                       * UI sounds

________________
38.6.3 Visual Sound Indicators
Integrates with Section 13 (Audio System):
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Directional visualizer for important sounds
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Distinct indicators for stealth-critical audio
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Toggle for intensity-based cue size
________________


38.7 Gameplay Comfort Options
38.7.1 Motion & Camera
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Toggle camera sway
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Reduce parallax effect
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Disable camera focus shifts during cutscenes
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Reduce or disable depth-of-field blur
38.7.2 Platforming Assistance
These do not change physics or difficulty—only comfort:
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Toggle auto-ledge grab
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Toggle auto-climb for small steps
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Adjustable camera dead zone
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Toggle “sticky walls” for wall-jumping (reduces slipping)
________________


38.8 Multiplayer Accessibility (Local)
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Per-player accessibility profiles
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Color-coded outlines for each player
                                                                                                                                                                                                                                                                                                                                                                                                                                          * UI scaling per player in shared-screen mode
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Accessibility overrides allowed for one player without affecting others
________________


________________
38.9 Compatibility & Performance
High accessibility settings must not break performance.
Guidelines:
                                                                                                                                                                                                                                                                                                                                                                                                                                          * No shader-based setting can exceed safe GPU usage on low requirements hardware
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Heavy filters replaced with LUT-based swaps wherever possible
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Subtitle and caption systems must remain lightweight even in high-density events
________________


38.10 Data & Save Integration
All accessibility settings are:
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Saved in global config
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Not tied to save files
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Synced across all modes
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Exportable for QA and UI testing


________________


39. Debug & Development Tools
39.1 Overview
The Debug & Development Tools subsystem provides essential runtime and in-editor utilities that enable rapid iteration, profiling, testing, and validation across all game systems. These tools must work both in Godot Editor and in exported builds (when enabled), supporting programmers, designers, artists, QA testers, and automation.
All tools follow these principles:
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Modular, non-intrusive, and safe to disable.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Never bundled in release builds unless explicitly allowed.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Able to inspect any Actor, State, System, or Runtime Module.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Logically grouped and deeply documented for internal studio usage.
________________


39.2 Debug Console
A unified in-game console offering direct access to engine commands.
Features
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Toggleable via configurable hotkey.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Supports command autocompletion.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Supports variables, flags, and live evaluation.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Command categories: Actor, FSM, Combat, Audio, Gadgets, AI, Camera, World, UI, Multiplayer.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Direct access to Runtime logs.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Command history and bookmarking.
Example Commands
                                                                                                                                                                                                                                                                                                                                                                                                                                          * actor.list
                                                                                                                                                                                                                                                                                                                                                                                                                                          * actor.tp <id> <x> <y>
                                                                                                                                                                                                                                                                                                                                                                                                                                          * fsm.force_state <actor_id> <state>
                                                                                                                                                                                                                                                                                                                                                                                                                                          * world.time_scale 0.2
                                                                                                                                                                                                                                                                                                                                                                                                                                          * audio.mute sfx
                                                                                                                                                                                                                                                                                                                                                                                                                                          * camera.set_mode debug_free
________________


________________
39.3 On-Screen Debug Overlay
Overlay providing real-time feedback.
Display Layers
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Performance: FPS, frametime, draw calls, object counts.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Gameplay: Player stats, hitboxes, hurtboxes, stamina, MP, current state, active skills.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * World: Region name, anomaly density, time-of-day, environmental states.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * AI: States, threat levels, targeting vectors.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Multiplayer: Input readings and desync warnings.
Overlay must support toggles per category.
________________


39.4 Hitbox & Physics Visualizers
Features
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Show/hide collision shapes.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Distinguish hurtboxes, hitboxes, grabboxes, trigger boxes.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Frame-by-frame playback of combat sequences.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Weapon arcs and predicted trajectories.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * RigidBody/CharacterBody velocity indicators.
This integrates with the FSM’s frame-event hooks.
________________


39.5 Runtime Inspector
A full in-engine inspector panel (similar to Unreal’s) allowing live inspection and modification.
Inspectable Categories
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Actors
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Actor Components
                                                                                                                                                                                                                                                                                                                                                                                                                                          * FSM State Machines
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Stats & Skills
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Buffs / Debuffs
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Audio Emitters
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Gadgets
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Projectiles
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Environmental Zones
                                                                                                                                                                                                                                                                                                                                                                                                                                          * UI Nodes
Capabilities
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Modify fields while running.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Spawn/despawn actors.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Trigger scripted events.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Override animations.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Attach/detach components.
________________


39.6 Logging & Telemetry
Logging Standards
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Structured JSON logs for automation and AI testing.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Console logs for debugging.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Error-level logs mirrored to a crash-report panel.
Telemetry Metrics
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Damage taken per encounter.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Death causes.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Player movement patterns.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Gadget usage.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * AI performance snapshots.
Logs must be exportable via an engine command.
________________


39.7 Automated Testing Tools
Supported Tests
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Unit tests (GDScript/C#).
                                                                                                                                                                                                                                                                                                                                                                                                                                          * FSM integrity checks.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Navigation map tests.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Combat sandbox tests.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Regression testing for Actor behaviors.
Includes a Simulation Mode where time accelerates 10x for stress testing.
________________


________________
39.8 Sandbox Mode
A dedicated environment where designers and QA can:
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Spawn any actor, enemy, creature, projectile, gadget.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Load any FSM state.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Test any skill or animation.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Toggle environmental presets.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Validate elemental interactions.
Sandbox Mode can run inside the editor or as an isolated executable.
________________


39.9 Frame Advance & Capture
Frame-control tools:
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Pause
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Step forward/backward by 1 frame
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Lock input for precise testing
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Capture frame buffer
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Automatic GIF/WEBM export for debugging combat and animation
________________


39.10 Localization Debugger
Even before full localization is implemented, the tools include:
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Placeholder replacement viewer
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Missing string finder
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Overflow/ellipsis detector
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Pseudolanguage generator (e.g., extra-long strings)
________________


39.11 Accessibility Test Panel
Integrates with Section 38 to rapidly test:
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Colorblind filters
                                                                                                                                                                                                                                                                                                                                                                                                                                          * UI scaling
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Sound captions
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Camera shake reduction
Automatically stresstests combinations for UI overlaps.
________________


39.12 Build Modes
The engine supports multiple build modes:
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Developer
                                                                                                                                                                                                                                                                                                                                                                                                                                          * QA
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Demo
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Showcase
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Release
Each mode enables/disables specific debugging layers.
________________


39.13 Safety & Cleanup
                                                                                                                                                                                                                                                                                                                                                                                                                                          * All debug code must be safely removable.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Debug shaders must not ship in release builds.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Commands that affect save data require confirmation.
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Dangerous commands trigger warnings.
________________


39.14 Documentation & Training
Each tool must include:
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Usage documentation
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Example scenarios
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Keyboard shortcuts
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Troubleshooting
Internal training material will be maintained for new team members.
________________


39.15 Future Extensions
Potential expansions:
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Automated AI combat benchmarking
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Replay system
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Branching scenario visualizer
                                                                                                                                                                                                                                                                                                                                                                                                                                          * Timeline debugger for cutscenes
These are not required for v1 of the engine but remain desirable stretch goals.
________________


40. Error Handling, Failsafe Architecture
Ensuring stability, predictability, and graceful recovery across all engine subsystems.
________________


40.1 Purpose & Philosophy
Error handling in the Densetsu Engine must follow three core design rules:
                                                                                                                                                                                                                                                                                                                                                                                                                                          1. Fail Safe, Not Hard
 No single system failure should crash gameplay unless absolutely unavoidable (e.g., corrupted save file loading).

                                                                                                                                                                                                                                                                                                                                                                                                                                          2. Detect Early, Recover Instantly
 Errors should be identified as soon as they occur, and the system should either repair itself or switch to a fallback mode seamlessly.

                                                                                                                                                                                                                                                                                                                                                                                                                                          3. Communicate Clearly to Developers
 Players never see internal errors, but developers always receive structured, actionable reports.

The goal is not to hide defects — it is to ensure stability during development and resilience at runtime.
________________


40.2 Categories of Errors
All errors fall into specific standardized classes:
Minor Errors (Recoverable Immediately)
Examples:
                                                                                                                                                                                                                                                                                                                                                                                                                                             * Missing sprite frame; fallback to placeholder frame
                                                                                                                                                                                                                                                                                                                                                                                                                                             * Unexpected null reference in optional behavior
                                                                                                                                                                                                                                                                                                                                                                                                                                             * Non-critical failure in AI decision branch
Engine response:
                                                                                                                                                                                                                                                                                                                                                                                                                                             * Replace with fallback
                                                                                                                                                                                                                                                                                                                                                                                                                                             * Log with warning level
                                                                                                                                                                                                                                                                                                                                                                                                                                             * Continue execution

Moderate Errors (Recoverable, but Affects Functionality)
Examples:
                                                                                                                                                                                                                                                                                                                                                                                                                                                * Gadget failing to load one of its modes
                                                                                                                                                                                                                                                                                                                                                                                                                                                * Missing sound file that prevents event playback
                                                                                                                                                                                                                                                                                                                                                                                                                                                * FSM state enters invalid transition
                                                                                                                                                                                                                                                                                                                                                                                                                                                * Actor fails to spawn particle effect
Engine response:
                                                                                                                                                                                                                                                                                                                                                                                                                                                * Use stub behaviors
                                                                                                                                                                                                                                                                                                                                                                                                                                                * Show a non-blocking in-game fallback (i.e., item behaves in “safe mode”)
                                                                                                                                                                                                                                                                                                                                                                                                                                                * Log with error level
________________


Critical Errors (Require Reset or Safe Exit)
Examples:
                                                                                                                                                                                                                                                                                                                                                                                                                                                * Corrupted save data
                                                                                                                                                                                                                                                                                                                                                                                                                                                * Failed scene initialization
                                                                                                                                                                                                                                                                                                                                                                                                                                                * Continuous recursion in FSM
                                                                                                                                                                                                                                                                                                                                                                                                                                                * Landmark node for scene streaming missing

Engine response options:
                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Force-safe reload of current scene
                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Soft reset to nearest checkpoint
                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Redirect to safe fallback screen (e.g., Infinitree root)
                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Log with fatal level and generate dump
________________


________________
40.3 Failsafe Layers
Error handling is distributed across three layers:
Layer 1 — Local System Failsafes
Each subsystem (FSM, Audio, Combat, Actor, Particles, World Streaming, etc.) must:
                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Validate parameters when receiving them
                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Fall back to defaults if values are invalid
                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Expose a is_safe_mode flag to other systems
                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Continue functioning with reduced behavior
Example:
If a combat hitbox fails to register its shape, the system spawns a generic circular hitbox instead.
________________


Layer 2 — Engine-Level Failsafe Manager
A global Failsafe Manager executes:
                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Centralized error dispatching
                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Auto-triggering corrective routines
                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Monitoring error frequency
                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Escalation logic:

                                                                                                                                                                                                                                                                                                                                                                                                                                                      * 1 minor error → log
                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Repeat of same minor error → mark subsystem unstable
                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Excessive error count → elevate to critical
This system also provides communication with the Debug / Instrumentation Framework (Section 39).
________________


Layer 3 — Player-Facing Safety Layer
In release builds:
                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Never show raw errors
                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Replace critical errors with in-world explanations (e.g., “the timeline is flawed”)
                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Auto-correct broken states
                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Apply narrative-flavored justification when possible
                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Always avoid player data loss

________________


In dev builds:
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * An unobtrusive console provides diagnostics
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Optional overlays display subsystem status
________________


40.4 Unified Error Logging Format
All errors follow a strict schema for readability and filtering:
[Timestamp] [Severity] [Subsystem]  
Message: <human readable>  
Context: <scene, actor, state>  
Values: <serialized parameters>  
Trace: <optional stack trace>


Supported severities:
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * INFO
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * WARNING
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * ERROR
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * FATAL
________________


40.5 Error Recovery Mechanisms
Auto-Correction Examples
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Missing Gadget component → replace with inert component
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * NPC stuck in navigation → teleport to nearest navmesh node
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Timer fails → approximate duration based on last known tick
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Audio file missing → use silent placeholder
________________


________________
Safe Mode Behavior
If a subsystem repeatedly fails, it enters safe mode:
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * AI uses reduced decision tree
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Combat skips advanced hitbox logic
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Physics relies on simplified solver
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Audio disables advanced sync or dynamic layers
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * World streaming halts distant chunks
The game continues smoothly, albeit with reduced fidelity.
________________


Scene Reload on Corruption
If detection finds the scene topology invalid:
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Freeze player
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Quick-save volatile data (inventory, flags)
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Reload scene in <0.5s> using lightweight transition
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Restore critical actors with safe-mode attributes
________________


40.6 Tools for Developers
Error Heatmaps
Visualization of:
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Where errors occur most
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Which actors/subsystems cause them
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Frequency over time
________________


Stress Test Modes
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * NPC saturation
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Particle overload
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Corrupted state injection
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Lost-reference mode
These allow QA to evaluate robustness.
________________


Unit Test Harness for Subsystems
Part of the Procedural Testing Harness (Section 38), specializing in:
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * FSM state transition validity
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Combat hitbox registration
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Sound playback sequences
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Streaming node consistency
________________


40.7 Integration With Other Sections
This system must interface with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * FSM System (error-safe transitions; default states)
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Actor System (safe-mode for any corrupted actors)
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Audio Pipeline (fallback tracks/sounds)
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * World Streaming (detection of missing segments)
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Persistence System (save data validation & repair)
                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Debug Framework (section 39 integration)
________________


40.8 Implementation Roadmap
                                                                                                                                                                                                                                                                                                                                                                                                                                                         1. Define error classes & enums
                                                                                                                                                                                                                                                                                                                                                                                                                                                         2. Implement subsystem-level fallback functions
                                                                                                                                                                                                                                                                                                                                                                                                                                                         3. Build central Failsafe Manager singleton
                                                                                                                                                                                                                                                                                                                                                                                                                                                         4. Integrate logging pipeline
                                                                                                                                                                                                                                                                                                                                                                                                                                                         5. Create developer UI overlays
                                                                                                                                                                                                                                                                                                                                                                                                                                                         6. Add stress-test and injection tools
                                                                                                                                                                                                                                                                                                                                                                                                                                                         7. Produce documentation & templates
                                                                                                                                                                                                                                                                                                                                                                                                                                                         8. Conduct full-engine chaos testing
________________
41. Configuration & Tuning Architecture
Unified system for defining, modifying, and hot-loading parameters across engine modules.
________________


41.1 Purpose
The Configuration & Tuning system defines all adjustable gameplay, engine, balancing, and runtime parameters in a centralized, structured, and safe manner.
It must allow:
                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Designers to tweak values without coding
                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Programmers to bind configuration to systems
                                                                                                                                                                                                                                                                                                                                                                                                                                                            * AI agents to generate or adjust configs safely
                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Debuggers to test alternate configurations instantly
                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Runtime hot-reload during development
This system acts as the “knobs and levers” that control the entire Densetsu Engine.
________________


41.2 Core Principles
                                                                                                                                                                                                                                                                                                                                                                                                                                                            1. Single Source of Truth
 All tunable values come from centralized config assets.

                                                                                                                                                                                                                                                                                                                                                                                                                                                            2. Modular and Namespaced
 Every system has its own config file:

                                                                                                                                                                                                                                                                                                                                                                                                                                                               * combat
                                                                                                                                                                                                                                                                                                                                                                                                                                                               * movement
                                                                                                                                                                                                                                                                                                                                                                                                                                                               * actors
                                                                                                                                                                                                                                                                                                                                                                                                                                                               * gadgets
                                                                                                                                                                                                                                                                                                                                                                                                                                                               * audio
                                                                                                                                                                                                                                                                                                                                                                                                                                                               * UI
                                                                                                                                                                                                                                                                                                                                                                                                                                                               * world streaming
                                                                                                                                                                                                                                                                                                                                                                                                                                                               * camera
                                                                                                                                                                                                                                                                                                                                                                                                                                                               * etc.

________________


                                                                                                                                                                                                                                                                                                                                                                                                                                                                  3. Strict Typing & Validation
 Configs must:

                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * enforce types (float, int, bool, vector, enum)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * define acceptable ranges
                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * reject invalid values
This protects against breaking the engine through incorrect tuning.

                                                                                                                                                                                                                                                                                                                                                                                                                                                                        4. Fail-safe Defaults
 Each configuration file has built-in defaults that load when:

                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * file is missing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * data is malformed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * conflicts occur

                                                                                                                                                                                                                                                                                                                                                                                                                                                                              5. Runtime Hot-Reloading
 In development builds, any config file can be reloaded immediately without restarting:

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * tuning movement speed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * changing sound falloff
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * adjusting enemy stats
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * debugging jump height
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * modifying gadget cooldowns

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    6. Versioned
 Config files include:

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * version metadata
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * last modified timestamp
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * change logs
________________


41.3 Configuration File Types
Global Config
Cross-system values:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * world scale (pixels-per-meter)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * collision layer mappings
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * day/night cycle speed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * environmental constants
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * debug settings

Subsystem Configs
Each major system has a dedicated file:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * actor_config.tres
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * fsm_config.tres
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * combat_config.tres
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * movement_config.tres
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * audio_config.tres
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * camera_config.tres
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * ui_config.tres
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * world_streaming_config.tres
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * gadget_config.tres
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * creature_config.tres
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * dialogue_config.tres
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * quest_system_config.tres
Per-Object / Per-Actor Configs
Overrides for:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * specific NPCs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * enemies
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * creatures
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * weapons
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * boss fights
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * gadgets
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * hazards
Handled via inheritance:
enemy_base.tres → bandit.tres → bandit_elite.tres
________________


________________
41.4 Parameter Categories
Common parameter categories across systems:
Physics Tuning
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * gravity
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * friction
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * drag
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * jump curves
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * knockback curves
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * projectile speeds
Combat Tuning
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * attack cooldowns
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * hitbox sizes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * stamina costs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * damage scaling
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * poise / stagger resistance
AI Tuning
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * detection ranges
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * reaction delays
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * aggression levels
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * stealth sensitivity thresholds
Audio Tuning
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * sound propagation radius
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * music transition timings
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * dynamic layer crossfades
Camera Tuning
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * smoothing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * dead zones
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * zoom ranges
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * shake intensities
________________
Gadget Tuning
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * cooldowns
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * sensing radius
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * interaction time
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * charge costs
UI Tuning
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * animation speeds
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * fade durations
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * cursor sensitivity
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * icon spacing
________________


41.5 Access & Integration
Systems access config values using:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * cached references
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * singleton ConfigManager access
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * dependency injection on initialization
Example:
var speed := config.movement.player_run_speed
________________


41.6 Validation System
Each config declares validation constraints:
min_value = 0
max_value = 100
step = 0.1
allowed_enum_values = ["walk", "run", "climb"]
When configs are loaded:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * validator checks every value
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * creates error logs for invalid entries
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * reverts invalid values to defaults
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * marks subsystem safe-mode if needed

Connects directly to Section 40 (Failsafe Architecture).
________________


41.7 Developer Tools
Config Editor (In-Engine GUI)
A visual editor with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * collapsible categories
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * sliders for numeric values
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * dropdowns for enums
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * color pickers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * file-load buttons
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * search filter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * live preview
Diff Viewer
Shows:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * differences between current and default
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * differences between working file and saved file
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * commit messages (optional)
Preset System
Designers can save presets:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * “Fast Movement Prototype”
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * “High Aggression AI”
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * “Alpha Demo Tuning”
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * “Boss Fight Prototype”
Presets can be applied or reverted instantly.
________________


41.8 Hot-Load Pipeline
Pipeline Flow:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             1. Config file modified
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             2. Engine detects timestamp change
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             3. Reload request queued
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             4. Subsystems receive update
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             5. Subsystems reinitialize parameters
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             6. Debug overlay confirms reload

Zero interruption to gameplay.
- In some cases (FSM), safest reload may defer to next frame.
41.9 Hierarchical Overrides
Overrides follow this order:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                1. Default Engine Config
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                2. Global Project Config
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                3. Subsystem Config
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                4. Level/Scene Overrides
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                5. Actor-Specific Config
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                6. Runtime Overrides (temporary)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                7. Scripted Overrides (highest authority)
Example:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Designers override enemy aggression for a specific boss stage
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Level script temporarily overrides gravity for dream sequence
________________


41.10 How It Supports AI-Assisted Development
This system is specifically structured so AI can safely:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * read existing configs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * propose new values
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * generate new config files
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * modify values within constraints
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * avoid producing unsafe or engine-breaking parameters
________________


41.11 Integration With Other Sections
This system integrates tightly with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Section 20 (Modular Subsystems)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Section 21 (Actor System)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Section 22 (FSM Architecture)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Section 24–25 (Combat & Stats)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Section 34 (Procedural Systems)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Section 38 (Automated Testing & Stress Tools)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Section 40 (Failsafe Architecture)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Section 39 (Debug Tools)
Every engine subsystem both uses and defines configuration.
________________


41.12 Implementation Roadmap
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                1. Define config file format (.tres/.cfg/.json hybrid where needed)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                2. Build ConfigManager core singleton
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                3. Create default configuration library
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                4. Create validation & fallback pipeline
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                5. Add hot-reload detection
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                6. Build Editor GUI tools
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                7. Add presets & diff viewer
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                8. Integrate with every subsystem
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                9. Document all config usage



________________
42. Cross-System Event Bus & Messaging Layer
Purpose
A unified communication backbone that allows all engine modules (Actors, FSMs, Combat, Audio, Gadgets, UI, Procedural Systems, etc.) to broadcast, listen, and react to events without direct dependencies.
________________


42.1 Design Goals
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Decoupling: Systems shouldn’t need to know each other’s internal logic.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Scalability: Must handle thousands of events per frame when needed.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Deterministic Ordering: Clear rules for priority and event flow.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Low Overhead: Lightweight data packets with minimal allocations.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Safe Multithreading: Future-proofing for multithreaded tasks.
________________


42.2 Event Types
Global Engine Events
Used for major engine-wide notifications:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * scene_loaded
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * scene_unloaded
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * pause_state_changed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * save_requested
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * config_hot_reload
Gameplay Events
For interactions, combat, physics, gadgets, etc.:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * actor_spawned
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * actor_despawned
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * stat_changed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * hit_registered
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * projectile_fired
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * gadget_activated
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * time_anomaly_detected
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * sound_emitted
UI Events
For menus, HUD feedback, dialogue signals:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * hud_update
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * notification_pushed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * dialogue_started
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * dialogue_ended
________________


42.3 Event Structure
Each event is a lightweight object containing:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * id: string or enum identifying the event
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * payload: dictionary or packed struct
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * emitter: reference to sender (optional)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * timestamp: engine time of emission
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * priority: defines ordering
Payload must avoid heavy or cyclic references.
________________


42.4 Event Dispatching Models
Immediate Dispatch
For critical events requiring instant delivery:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * hit_detected
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * animation_event
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * fsm_transition
Queued Dispatch
Events are stored and processed at frame boundaries:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * world state updates
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * audio triggers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * UI transitions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * anomaly scanning
________________
Batched Dispatch
Several events merged to reduce noise or overhead:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * multiple small stat changes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * cluster of sound propagation checks
________________


42.5 Listener Registration
Listeners can register with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * event id
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * category
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * wildcard patterns
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * priority layers (0–10)
Example layers:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   1. Engine Core (priority 10)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   2. Actor Lifecycle (priority 8)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   3. FSM (priority 6)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   4. Combat (priority 5)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   5. UI (priority 3)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   6. Audio (priority 2)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   7. Scripting (priority 1)
________________


42.6 Thread Safety Notes
Even though Godot 4 is partially multithreaded, the initial implementation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * processes all events on the main thread
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * prohibits engine-mutating operations in background threads
Future upgrade path:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * allow worker-thread listeners for read-only event data
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * permit async event categories (e.g., procedural generation)
________________


________________
42.7 Debugging & Visualization Tools
A built-in Event Monitor provides:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * real-time event log
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * filtering by category, id, or emitter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * heatmap of event frequency
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * warnings for excessive spam
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * detection of recursion loops (event feedback explosions)
________________


42.8 Common Event Use Cases
FSM Integration
FSM transitions trigger events such as:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * enter_state
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * exit_state
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * animation_event
Combat System
Registers:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * hit_registered
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * block_success
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * enemy_alerted
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * poise_broken
Stealth & Sound Model
Stealth logic listens for:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * sound_emitted
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * propagation_polygon_ready
Gadgets
Each gadget may dispatch:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * anomaly_detected
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * chronobloom_update
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * memory_echo_seen
UI
UI updates triggered by:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * player_stat_changed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * item_acquired
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * xp_gained
________________


42.9 Error Handling & Failsafes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Invalid events logged but not fatal.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Unhandled events reported in debug.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Infinite event loops detected by counters.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Payload validation performed during debug builds.
________________


42.10 Implementation Roadmap
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   1. Define EventBus singleton.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   2. Implement event struct (lightweight dictionary + metadata).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   3. Create listener registration system.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   4. Implement immediate + queued dispatch.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   5. Add batching logic.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   6. Integrate with major systems (Actors, FSM, Combat).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   7. Build Event Monitor for debugging.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   8. Add profiling hooks.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   9. Document all event ids and payload schemas.
________________


43 — Team Workflow & Collaboration Model
43.1 Overview
Defines how Retraissance structures daily work, cross-disciplinary communication, and development flows.
Supports a hybrid team with varying availability, experience, and overlapping responsibilities.
43.2 Core Principles
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Modularity First: Every system, asset, and tool must be isolated and replaceable.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Low-Friction Collaboration: Reduce dependencies between roles.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Transparency: Every team member understands the current project state.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Documentation Before Implementation: Everything begins written or drawn.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * AI as an Assistant, Not an Author: AI supports workflow but does not override human creative direction.
43.3 Roles & Responsibilities
(Flexible; members may fill multiple roles)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Creative Director / Lore Architect:
 Owns narrative, worldbuilding, characters, timeline, canonical consistency.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Game Designer(s):
 Creates gameplay systems, mechanics, balancing documents, encounter design.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Programmer(s):
 Implements systems in the Densetsu Engine; maintains code guidelines.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Artist(s):
 Handles concept art, sprites, animation, environment tiles, VFX.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Audio Composer / Sound Designer:
 Music loops, soundscapes, dynamic layers, SFX, audio implementation guidelines.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Marketing / PR:
 Social presence, campaigns, devlogs, press kit, pitch decks.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Prototypers:
 Quick proof-of-concept builders using experimental mechanics.

43.4 Collaboration Workflow
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Idea > Concept > Approval > Production > Review > Integration > Testing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Ideas must be written in a shared document or discussed in a meeting.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Approved features receive a Feature File (minimum spec).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Programmers create or update modules based on specs.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Artists and composers work asynchronously with placeholders.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Integration happens in short cycles to avoid divergence.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * QA or internal testers validate each integration checkpoint.

43.5 Communication Structure
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Primary Channels:
 Discord, dedicated project chat, Notion/Obsidian (or equivalent local wiki).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Meeting Cadence:
 Flexible; typically weekly or bi-weekly sync-ups.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Pipeline Bridge:
 After every milestone, a short review to update documentation and adjust scope.
43.6 Documentation Standards
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Each subsystem must have:

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               * Overview
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               * Responsibilities
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               * Inputs/Outputs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               * Dependencies
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               * Data Format

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Documentation must remain synchronized with engine implementation.
43.7 Task Management Structure
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Use simple Kanban boards or linear task lists.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Work is split into:

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Must-Have
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Should-Have
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Could-Have
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Stretch Goals
43.8 Collaboration with AI Systems
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * AI can:

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        * Draft structure, plans, prototypes.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        * Fix bugs or generate boilerplate.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        * Assist with large-scale refactors.

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * AI cannot:

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Finalize story.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Autonomously generate assets for production.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Implement major systems without human review.
________________
43.9 Cross-Discipline Integration
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Designers create system specs.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Programmers implement the spec.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Artists build visual assets based on the implemented version.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Composers adapt audio to dynamic cues in the code.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * All iteration is reviewed by the Creative Director for narrative and stylistic cohesion.
43.10 Milestone-Driven Collaboration
Each milestone contains:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Goals
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Deliverables
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Deadlines
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Risk notes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Dependencies
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Testing criteria


________________


44. Version Control Integration Strategy
44.1 Overview
Even though version control is not fully adopted in current development workflow, a future-proof plan is required to stabilize collaboration, prevent data loss, and support modular development at scale.
This section outlines how version control will be integrated once the team is ready, with minimal disruption to ongoing work.
________________


44.2 Goals of Version Control
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Prevent project corruption or overwritten progress.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Enable safe parallel work between programmers, designers, and artists.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Support modular feature branches for isolated system development.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Provide historical tracking and rollback safety.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Allow automated builds and QA checkpoints.
________________


44.3 Recommended Platform
Git (with optional GUI clients) such as:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * GitHub
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * GitLab
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Bitbucket
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Local Git server (for offline-first teams)
GUI clients for non-programmers:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * GitKraken
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Sourcetree
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * GitHub Desktop
________________


________________
44.4 Repository Structure
A proposed structure:
/ProjectRoot
/engine
/game
/assets
/art
/audio
/fonts
/docs
/tools
/build
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * engine/ → Densetsu Engine core modules
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * game/ → Gameplay scripts, content loaders, encounter logic
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * assets/ → Version-tracked lightweight assets; large binaries handled separately
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * docs/ → GDD, Universe Document, specs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * tools/ → Internal pipelines, automation scripts
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * build/ → Ignored by Git
________________


44.5 Git Ignore Strategy
Exclude:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * build output
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * temporary files
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * logs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * local environment configs
Example:
/build/
/.godot/
*.tmp
*.import
________________


________________
44.6 Branching Model
A lightweight model suited for a small team:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * main – stable builds
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * dev – integration branch
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * feature/* – isolated work (FSM, AI, gadgets, etc.)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * hotfix/* – emergency fixes
Workflow:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              1. Create a feature/ branch.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              2. Commit small, descriptive changes.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              3. Merge into dev after review.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              4. Merge dev into main after stability testing.
________________


44.7 Asset Versioning Strategy
Art and audio assets can be large. Two methods:
Option A — Git LFS (Large File Storage)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Good for binary art resources
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Allows full version history
Option B — External Drive + Reference Repository
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Git tracks placeholder meta-files
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Actual PNGs/OGGs stored in a synced shared drive (Google Drive, Mega, etc.)
________________


44.8 Designer-Friendly Workflow
For designers, writers, and artists who don’t write code:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Use GUI clients for simple commit/pull operations.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Only touch folders relevant to their discipline.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Avoid merging; let tech staff handle merge conflicts.
________________


________________
44.9 Backup Policy
Even with Git, full backups remain required:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Weekly full zip of project folder
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Monthly offline archive
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Autosave versions every major milestone
________________


44.10 Adoption Plan
Since team experience varies, adoption will be phased:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              1. Phase 1: Programmers adopt Git for engine modules.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              2. Phase 2: Designers begin versioning scriptable data + docs.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              3. Phase 3: Artists use Git LFS or external sync.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              4. Phase 4: Full project moves under unified repository.
________________


44.11 Stretch Goals
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Automated build pipeline (CI/CD)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Branch-based preview builds
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Shared code review dashboard
________________


44.12 Conclusion
Even though Git is not used yet, defining this structure ensures that when adoption begins, the team transitions smoothly into a safe, scalable, and professional workflow.
________________


45. Testing & QA Process
45.1 Overview
This section defines how Densetsu is tested, validated, and stabilized throughout development. It establishes workflows for internal QA, automated tools, bug reporting, feature validation, and playtesting. The goal is to ensure quality despite limited manpower.
________________


45.2 Testing Principles
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Iterative: Test every feature as soon as it is functional.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Modular: Systems (FSM, Combat, AI, Gadgets, UI, etc) must be testable in isolation.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Reusable Tools: Debug overlays, state inspectors, and console commands are central to QA.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Minimal Redundancy: Tests focus on actual risk areas, not exhaustive coverage.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Documentation-Integrated: Every bug links back to the system spec.
________________


45.3 Types of Testing
Unit Testing (Engine-Level)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * FSM transitions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Actor lifecycle
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Stat calculations
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Combat math (hit detection, damage formulas)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Procedural systems (loot, anomalies)
Integration Testing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Actor + FSM
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * FSM + Combat
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Gadgets + Anomaly Systems
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * UI + Localization
Gameplay Testing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Movement feel
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Combat responsiveness
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Level flow
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Puzzles and anomaly loops
Performance Testing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Scene streaming
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * NPC counts
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Input latency
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Physics stress
Regression Testing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * After major merges
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * After refactors
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * After save/load system changes
________________


45.4 QA Tools (Required Engine Features)
The Densetsu Engine must include:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Debug Console: spawn actors, give items, force states
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Overlay Inspector: show hitboxes, state names, timers, AI targets
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Log Viewer: real-time logs sorted by category
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * State Tracker: visualize FSM transitions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Performance Graph: FPS, memory, GC, draw calls
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Audio Debugger: inspect propagation, volume, occlusion
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Localization Previewer: switch languages mid-game
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Quest/Dialogue Tester: fast-skip to nodes
________________


45.5 Bug Reporting Structure
Every bug report must include:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Title
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * System (FSM, AI, Dialogue, Rendering…)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Reproduction steps
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Expected result
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Actual result
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Severity
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Screenshots or video
Severity levels:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * S1 — Critical: crashes, softlocks, save corruption
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * S2 — Major: broken features, progression blockers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * S3 — Minor: visual/audio glitches
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * S4 — Cosmetic: typos, minor offsets
45.6 Playtesting Phases
Internal Playtests
Conducted by team members. Focus on:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Core feel (movement, combat)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Early levels
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * UI flow
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Stability
Closed Playtests
Small group of trusted players. Focus on:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Difficulty curve
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Understanding of mechanics
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Narrative clarity
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Puzzle complexity
Public Playtests (Optional)
Demo or early access builds. Focus on:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Hardware compatibility
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Large-scale feedback
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Balance tuning
________________


45.7 Automated Testing (Stretch Goal)
Automated tests may include:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Scripted playback of input recordings
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Automated pathfinding tests
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Unit tests for math-heavy modules
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Load/unload stress cycles
________________


________________
45.8 QA Milestones
Testing milestones align with production:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Prototype Validation → Movement/Combat tested
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Vertical Slice → All core systems tested
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Alpha → Content complete, feature tests
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Beta → Bug fixes, regression testing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Launch → Final certification and polish
________________


45.9 Post-Launch QA
Support includes:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Patch regression tests
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Stability analysis from player logs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Hotfix pipeline
________________


45.10 Conclusion
The testing & QA process ensures Densetsu remains stable, responsive, and enjoyable even with a small team. The tools and workflows defined here are essential foundations of the development pipeline.
________________


46. Release Management & Deployment
46.1 Overview
This section defines how Densetsu moves from internal development to public distribution. It establishes a stable and predictable release pipeline suitable for a small indie team, balancing flexibility with structure.
The goal is to minimize risk, ensure consistency between builds, and prepare the project for eventual public-facing releases.
________________


46.2 Release Objectives
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Deliver stable builds at predictable milestones.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Support internal testing, closed playtests, and demo releases.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Ensure all builds are reproducible and documented.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Provide guidelines for packaging and distribution on multiple platforms.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Plan for long-term update cycles and patches.
________________


46.3 Build Types
Internal Development Build
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Updated daily or per-commit.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Used by programmers, designers, and artists.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Contains debug tools and experimental features.
Milestone Builds
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Prototype, Vertical Slice, Alpha, Beta.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Feature-complete per milestone requirements.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Documented release notes.
Testing Builds
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Prepared for internal or closed playtesting.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Debug tools hidden unless needed.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Includes data-gathering logs.
________________
Public Demo Build
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Small, curated content showcase.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Highly stable, lightweight, well-presented.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Sometimes includes dynamic music or alternate UI.
Release Candidate (RC)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Candidate for final launch.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Stability and performance must match release standards.
Final Release Build
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Public version of the game.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Includes legal notices, credits, OSS licensing, and platform metadata.
________________


46.4 Platform Deployment Strategy
Primary Targets
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Windows
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Linux
Secondary Targets (Stretch Goal)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * macOS
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Steam Deck optimization
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Consoles (Switch, PlayStation, Xbox) via porting partners
Deployment must consider input abstraction, save compatibility, and performance limitations.
________________


46.5 Build Automation (Stretch Goal)
A simple automated pipeline (CI/CD) may:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Build game on every commit to dev
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Lint/validate scripts
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Run automated tests
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Package builds into versioned folders
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Upload builds to testing channels
________________


Platforms:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * GitHub Actions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * GitLab CI
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Jenkins (self-hosted)
________________


46.6 Pre-Release Checklist
Before any testing or public build:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Disable debug overlays
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Remove placeholder assets
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Ensure correct version number
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Verify save/load compatibility
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Test localization switching
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Validate inputs (keyboard, controller)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Confirm dynamic music events
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Check packaging (folder structure, DLLs, PCK files)
________________


46.7 Release Notes & Documentation
Each release must include:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Version number and build date
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Summary of changes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Known issues
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * System requirements
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Special instructions (if any)
Release notes should be:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Clear
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Concise
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Non-technical when intended for players
________________


________________
46.8 Patch Management
Patches follow semantic versioning:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Major Update: New content, major systems, or expansions.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Minor Update: Improvements, new features, small additions.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Hotfix: Urgent fixes for crashes, broken quests, or critical bugs.
Patch workflow:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              1. Issue identified.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              2. Fix developed in a hotfix branch.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              3. Tested internally.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              4. Rolled out as a standalone patch or integrated into the next minor update.
________________


46.9 Distribution Platforms
Potential release channels:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Steam (primary target)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * itch.io (secondary target)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * GOG (optional)
Each requires:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Metadata
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Screenshots
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Trailer
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Tags and categories
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Demo slot (optional)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Community guidelines
________________


46.10 Post-Release Support Strategy
After launch:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Monitor crash logs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Gather player feedback
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Issue hotfixes quickly
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Maintain transparent communication
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Plan long-term content updates based on community needs and team capacity
________________


46.11 Long-Term Version Roadmap
A flexible post-launch path may include:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Content packs (regions, modes)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * New abilities or enemies
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Quality-of-life updates
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Performance improvements
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Localization expansions
________________


46.12 Conclusion
This strategy ensures Densetsu can move through development, testing, release, and post-launch support in a structured, sustainable manner while accommodating the limitations and goals of Retraissance.
________________


47 — Production Timeline Framework
47.1 Overview
This section defines a flexible, scalable production timeline for Densetsu, accounting for Retraissance’s limited manpower, mixed expertise levels, and modular development philosophy. Rather than rigid deadlines, this framework focuses on milestones, priorities, and sequences.
The timeline is meant to serve as a guiding structure, adaptable to real-world constraints.
________________


47.2 Production Philosophy
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Modularity: Systems and content are built independently and plugged together.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Vertical Slices: Prioritize building small, complete gameplay sections over massive incomplete ones.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Iterative Development: Build, test, refine.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Parallel Pipelines: Art, audio, narrative, and code progress semi-independently.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Documentation-Driven: Every major feature requires a design spec before implementation.
________________


47.3 High-Level Milestones
Milestone 0 — Foundations (Engine & Tools)
Establish the core of the Densetsu Engine.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Actor system
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * FSM
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Combat fundamentals
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Animation system
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Input framework
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Audio pipeline
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * UI framework
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Resource & scene management
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Save/load system
Output: First interactive prototype with placeholder assets.
________________


Milestone 1 — Prototype Gameplay Loop
Implement core gameplay in a single test level.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Movement + combat fully functional
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Two enemy types
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * One anomaly puzzle
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Basic gadgets prototype
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Checkpoints + rest system
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Barebones UI
Output: Playable demo room proving the core feel.
________________


Milestone 2 — Vertical Slice
A polished segment representing final game quality.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Refined combat
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Finalized art direction for environments
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Fully implemented dynamic audio
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * One complete region’s micro-loop (Hirogawa opening)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * One major boss encounter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Fully storyboarded intro & early narrative beats
Output: Vertical Slice Build for internal review and potential pitching.
________________


Milestone 3 — Core Content Production
Main development phase.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Build all major regions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Add enemies, NPCs, anomaly loops
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Implement gadgets progressively
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Populate world with quests and discoverables
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Finalize combat trees & abilities
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Implement all UI and UX flows
Output: Content complete game with placeholder polish gaps.
________________


________________
Milestone 4 — Alpha
Focus on system stability.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * All regions playable from start to finish
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * All anomalies in place (solutions may be WIP)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * All narrative paths integrated
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Combat, AI, and gadgets finalized
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Save/load fully stable
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Localization framework functional
Output: First full-game build.
________________


Milestone 5 — Beta
Focus on polish.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Bug fixing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Optimization
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Art polish
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * SFX pass
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Dynamic music refinement
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Cutscene cleanup
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * UI smoothing
Output: Near-release build.
________________


Milestone 6 — Release Candidate (RC)
Final pass before launch.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Stability testing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Regression testing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Localization QA
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Packaging & distribution setup
Output: Public launch-ready build.
________________


Milestone 7 — Launch & Post-Launch Support
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Hotfixes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Balance patches
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Additional content (if feasible)
Output: Stable public release.
________________


47.4 Task Prioritization Model
All tasks fall under:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * P0 — Must Have: Core systems; game cannot function without.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * P1 — Should Have: Essential content or polish.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * P2 — Could Have: Optional enhancements.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * P3 — Stretch Goals: Future updates; not required for launch.
This structure prevents feature creep and keeps development realistic.
________________


47.5 Cross-Discipline Sync Points
Certain tasks require teams to sync:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * FSM + Animation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Combat + AI
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Gadgets + UI
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Audio + Event triggers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Narrative + Quest system
Scheduled sync points occur at the end of each milestone.
________________


47.6 Time Estimation Philosophy
Due to unpredictable availability, estimates follow:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Conservative timing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Flexible scope
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Weekly review of priorities
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Monthly review of milestone schedule
________________


47.7 Agile/Hybrid Approach
Development follows a hybrid style:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Agile: Iterative cycles, weekly goals
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Kanban: Continuous prioritized tasks
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Waterfall for Macro Milestones: Clear sequences for major deliverables
This ensures structure without rigidity.
47.8 Risk Buffering
The timeline includes buffers for:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Illness / burnout
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Missing art or audio
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Bug blocks
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Technical refactors
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Changing design needs
Every milestone incorporates a buffer window.
________________


47.9 Documentation Milestones
Every major feature must include:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Design outline
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Technical spec
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Test plan
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Implementation notes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Update to GDD and Engine docs
Documentation cannot lag behind implementation.
________________


47.10 Conclusion
This lightweight timeline provides Retraissance with a clear, modular production structure that adapts to manpower limits while keeping Densetsu on track toward a stable, polished release.
________________


48. Technical Risk Register
48.1 Overview
This section identifies the major technical, structural, and production risks for Densetsu, evaluates their severity, and outlines mitigation strategies. As an indie team with limited manpower, Retraissance must anticipate potential blockers early and design systems around avoiding or minimizing them.
Risks fall under four categories:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Technical Risks
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Production Risks
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Tooling & Pipeline Risks
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * External Risks
________________


48.2 Risk Severity Levels
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Critical (C): Will halt development or break the project.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * High (H): Significant disruption; requires rework or delays.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Medium (M): Manageable issues; may slow development.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Low (L): Minor impact.
________________


48.3 Technical Risks
1. Engine Architecture Overcomplexity
Severity: H
Risk: Systems may become too interconnected, making changes expensive or dangerous.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Strict modularization (Actors, FSM, Combat, AI, etc.)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Code guidelines and interface boundaries
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Consistent documentation
________________


________________
2. FSM or Actor System Instability
Severity: C
Risk: Bugs in the core runtime break every character, enemy, gadget, and system.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Extensive unit tests
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Debug state visualizers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Incremental integration
________________


3. Performance Bottlenecks in Animation/AI
Severity: H
Risk: High-density scenes may cause frame drops.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Early profiling
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Object pooling
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * LOD for background actors
________________


4. Physics or Collision Issues
Severity: M/H
Risk: Unpredictable physics collisions break platforming or combat.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Minimal reliance on Godot built-in physics
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Custom lightweight collision checks
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Continuous testing during movement development
________________


________________
5. Save/Load System Corruption
Severity: C
Risk: Broken saves can softlock progression.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Versioned save schema
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Validation checks before loading
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Auto-fallback backups
________________


6. Audio System Overhead
Severity: M
Risk: Dynamic looping and sound propagation may exceed CPU budgets.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Spatial culling
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Limit simultaneous layers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Pre-mixed fallbacks
________________


7. Procedural Generation Instability
Severity: M
Risk: PCG systems (e.g., Simulation Mode or VR Missions) generate invalid or broken levels.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Seed validation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Modular room sets
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Automated test passes
________________


________________
8. Dialogue or Quest System Logic Conflicts
Severity: H
Risk: Broken branching paths, inconsistent flags, softlocks.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Unified flag tracking
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Automated QA scripts
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Clear writer/programmer integration
________________


48.4 Production Risks
1. Severe Manpower Limitations
Severity: C
Risk: Core systems take longer, content production bottlenecks.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Reduce scope where needed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Reuse modular tools and systems
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Focus on quality over quantity
________________


2. Expertise Gaps
Severity: H
Risk: Some areas (PR/marketing/programming) rely heavily on one member.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Cross-training
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * External freelancers when feasible
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * AI assistance for drafting and technical clarity
________________


________________
3. Burnout Risk
Severity: H
Risk: Small team with high workload increases burnout probability.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Rotating responsibilities
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Flexible timelines
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Avoid crunch
________________


4. Unclear Feature Boundaries
Severity: M/H
Risk: Scope creep or feature confusion.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Strict spec documents
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Feature freeze phases
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Regular reviews
________________


48.5 Tooling & Pipeline Risks
1. Lack of Version Control
Severity: C
Risk: Data loss or overwritten work.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Section 44 outlines adoption plan
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Interim manual backups
________________


2. Missing Debug Tools
Severity: H
Risk: Bug fixing becomes exponentially harder.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Build debug tools in parallel with gameplay systems
3. Asset Pipeline Bottlenecks
Severity: M
Risk: Art or audio assets not ready for integration.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Placeholder-friendly design
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Early asset blockouts
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Modular VFX systems
________________


48.6 External Risks
1. Funding Limitations
Severity: H
Risk: Slowdowns in development, inability to outsource critical work.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Budget planning
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Crowdfunding consideration
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Minimalist feature prioritization
________________


2. Platform Policy Changes
Severity: M
Risk: Changes in Steam/GOG requirements or Godot engine updates cause delays.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Maintain versioned backups of Godot
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Test on LTS versions
________________


________________
3. Hardware Variability
Severity: L/M
Risk: Player machines vary widely.
Mitigation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Early performance optimization
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Scalable graphics settings
________________


48.7 Risk Monitoring Plan
Risk evaluation occurs:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * At the end of each milestone
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * During feature planning
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * After major technical changes
Risk log is updated with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Status (active/mitigated)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Owner
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Deadlines
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Notes
________________


48.8 Conclusion
This register helps Retraissance anticipate and counteract threats to the stability, timeline, and feasibility of Densetsu. By identifying risks early, the team can adapt without sacrificing quality or sustainability.
________________


49. Debug, Diagnostic & Developer Tools
49.1 Overview
This section outlines all internal debugging, instrumentation, and development-focused tools required to efficiently test, profile, inspect, and validate the Densetsu Engine. These systems increase development speed, ensure stability, and provide a unified, structured approach for all contributors.
A robust debugging and diagnostics suite is mandatory due to the engine’s modular architecture, high system interdependence, and multi-actor runtime complexity.
________________


49.2 Debug Overlay (In-Engine HUD)
The debug overlay is a toggleable (F1) in-engine interface that displays:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * FPS, frametime, delta smoothing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Memory usage (RAM, VRAM)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Active actors by category (character, creature, enemy, utility, projectile, item)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Active states and state transitions for selected actors
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * FSM graph snapshot (in text form)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Physics step data (velocity, forces, collisions)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Script errors and warnings
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Active timers, signals, and pending deferred calls
Overlay Architecture
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Modular panels, each independently toggled
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Drawn using Godot’s CanvasLayer to ensure UI priority
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Editable via config file to enable/disable expensive diagnostics
________________


49.3 Hitbox & Hurtbox Visualizer
Toggleable (F2) runtime visualization that outlines:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Hurtboxes (blue)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Hitboxes (red)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Interaction zones (green)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Soft triggers and sensors (yellow)
________________
Features
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Frame-by-frame stepping
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Overlay of animation frame index
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Real-time display of hitbox/hurtbox names and metadata
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Visibility per actor or per actor category
________________


49.4 Actor Inspector Tool
An in-engine inspector that appears when selecting an actor in debug mode.
Displays
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Actor metadata (type, ID, tags, flags)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Active State + substate information
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Current stats and modifiers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Active effects/buffs/debuffs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Inventory or gadget parameters
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Collision layers & masks
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * AI decision trace (if enabled)
Functions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Force state change (dropdown — development only)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Apply damage/heal
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Teleport
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Spawn/destroy actor
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Toggle behavior modules
________________


49.5 Logging System
Unified logging with hierarchy:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Info
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Warning
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Error
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Critical
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * System
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Debug (toggleable)
________________
Logging Rules
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Each system registers a logger with a unique prefix
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Logs may be routed to: console, file, network (future), in-game overlay
Crash Reports
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Automated generation of stack trace, active actor list, and last known state machine transitions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Optionally exportable to text file
________________


49.6 Event Trace Recorder
Records sequences of events to replay later.
Captures
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Inputs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * FSM transitions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * AI decisions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Actor spawns/destructions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Sound/musical events
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Physics interactions
Use cases
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Reproducing bugs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Unit-test style validation of scripted events
________________


49.7 Profiler Integration
Hooks into Godot’s profiler with custom categories:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Actor System update time
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * FSM processing time
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Combat system overhead
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Audio graph overhead
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * VFX / particle cost
Displays per-frame and average timings.
________________


49.8 Sandbox Mode
Internal developer test map allowing:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Hot-loading actors, items, gadgets
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Stress tests (spawn X enemies every Y seconds)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Physics experiments
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Time anomaly simulations
Includes UI for spawning entities with parameters.
________________


49.9 Command Console
Developer-only command interface (opened with F12).
Example Commands
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * spawn <actor> <x> <y>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * set_state <actor> <state>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * give_item <item>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * tp <x> <y>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * toggle_ai <actor>
Implementation Notes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Command registry auto-populated from scripts
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Autocomplete support
________________


49.10 Hot Reloading (Where Safe)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Reload scripts for FSM modules, AI behaviors, and VFX
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Reload resources (JSON configs, tables, gadgets definitions)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Avoid hot reloading core engine modules unless safe
________________


________________
49.11 Automated Testing Framework
Test Types
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Unit tests: Stats, math libraries, data tables
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Integration tests: Actor spawns, state flows
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Scenario tests: Time anomaly puzzles, quest chains
Execution
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * CLI or in-editor
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Exportable reports
________________


49.12 Error Handling & Recovery
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Graceful fallback if non-critical system fails
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Actors isolated to prevent cascading failures
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * If a state misbehaves, engine forces fallback state and logs incident
________________


49.13 Developer UX Philosophy
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Everything toggleable
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Everything inspectable
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Everything logged or traceable
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Everything reproducible
All tools must support low-overhead mode to avoid hindering normal gameplay.
________________


49.14 Summary
This toolkit forms the backbone of testing, debugging, and validation for the Densetsu Engine. It ensures stability and clarity across all modules and systems, enabling both human developers and AI agents to work with precision and confidence.
________________


50. Testing & Quality Assurance
Overview
A structured QA framework ensures every system in the Densetsu Engine remains stable, deterministic, and scalable as features are added. Testing applies equally to gameplay logic, engine modules, editor tooling, and cross-system interactions.
1. Testing Pillars
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Unit Testing: Validate isolated functions and modules (math helpers, FSM transitions, stat calculations, serialization).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Integration Testing: Validate interactions between subsystems (actor+FSM, actor+combat, core runtime+scene layering).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Behavioral Testing: Validate deterministic outcomes of gameplay actions (attacks, collisions, platforming interactions, AI patterns).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Performance Testing: Ensure frame budgets remain stable under maximum expected load.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Playtesting: Human validation of feel, responsiveness, UX, and emergent issues.
2. Automated Test Harness
Purpose
A small internal test runner allowing rapid verification of engine modules.
Features
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Registers test cases via a simple API.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Logs pass/fail with structured reports.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Supports headless mode for CI.
Required Capabilities
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Run deterministic replay scenarios (see Replay System).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Mock Actors, FSM States, Hitboxes, and Terrain.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Time acceleration and freeze-step for debugging logic.
________________
3. Deterministic Replay-Based Testing
Concept
A replay captures input, RNG seeds, and world state deltas. Replaying the same data must produce identical results.
Use Cases
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Regression testing for combat.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * FSM transition verification.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Movement feel validation.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Network rollback simulation (future stretch goal).
4. Debug Layers & Visualizers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Hitbox visualizer (active hitboxes, hurtboxes, collision boxes).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Audio propagation polygons (for stealth testing).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * FSM state machine inspector (current state, queued events, transitions).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Physics visualizer (rays, contacts, velocity vectors).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * AI intent overlay (patrol paths, targets, threat levels).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Memory usage panel (texture VRAM, audio buffers, instance count).
All visualizers toggleable independently.
5. Stability Matrix
Each system must define its stability requirements:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Core Runtime: Must never crash. 60 FPS minimum.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Actor System: Deterministic updating order.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * FSM System: Guaranteed exit/enter integrity, no dead states.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Collision System: Determinism at fixed timestep.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Audio System: No desync between layers.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * UI System: Must remain frame-safe during scene transitions.
6. Error & Exception Handling
Errors must never cascade. Implement:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Centralized error logger.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Graceful fallback behaviors.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Red error banners for critical failures.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Yellow warnings for recoverable issues.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Automatic screenshot + log dump for critical failures.
7. QA Workflow
Developer Guidelines
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Each new feature must include minimal tests.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Changes to core systems require replay-based regression tests.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Breaking changes must be documented.
Tester Guidelines
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Weekly milestone builds.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Scenario checklists (combat sets, traversal rooms, anomaly puzzles).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Bug classification (critical, high, medium, cosmetic).
8. Build Verification
Before any internal release:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Run automated tests.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Verify determinism of all core loops.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Memory leak check after 30–60 minutes of runtime.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Confirm stable framerate in heavy-load stress maps.
9. Documentation Requirements
Every system must contain:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Summary of testing approach.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Known edge cases.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Tools used to test.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Expected deterministic behaviors.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Fail-recovery strategies.
10. Future Expansion
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Possible integration with Git-based CI.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Automated replay fuzzing.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Automated input generation for stress testing.


[a]O que falamos sobre os bugs que estava a dizer que iria testar assim sendo já só é por rotina, aqui esta o principio de como evitar o bug.
[b]This is important!!
[c]IMPORTANT!